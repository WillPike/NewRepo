"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();window.app={};var ALERT_REQUEST_SUBMIT_ERROR=1,ALERT_REQUEST_ASSISTANCE_SENT=10,ALERT_REQUEST_ASSISTANCE_RECEIVED=11,ALERT_REQUEST_CLOSEOUT_SENT=20,ALERT_REQUEST_CLOSEOUT_RECEIVED=21,ALERT_REQUEST_ORDER_SENT=30,ALERT_REQUEST_ORDER_RECEIVED=31,ALERT_SIGNIN_REQUIRED=40,ALERT_TABLE_RESET=50,ALERT_TABLE_ASSISTANCE=51,ALERT_TABLE_CLOSEOUT=52,ALERT_GENERIC_ERROR=100,ALERT_DELET_CARD=200,ALERT_PASSWORD_RESET_COMPLETE=210,ALERT_SOFTWARE_OUTDATED=220,ALERT_CARDREADER_ERROR=310,ALERT_ERROR_NO_SEAT=410;!function(){var ActivityMonitor=function($rootScope,$timeout){this.$$rootScope=$rootScope,this.$$timeout=$timeout,this._timeout=1e4,this._activeChanged=new signals.Signal,this.enabled=!0;var self=this;this.$$rootScope.$on("$locationChangeSuccess",function(){self.enabled&&self.activityDetected()}),this.activityDetected()};ActivityMonitor.prototype={},Object.defineProperty(ActivityMonitor.prototype,"timeout",{get:function(){return this._timeout},set:function(value){value>0&&(this._timeout=value,this.activityDetected())}}),Object.defineProperty(ActivityMonitor.prototype,"enabled",{get:function(){return this._enabled},set:function(value){this._enabled=value}}),Object.defineProperty(ActivityMonitor.prototype,"active",{get:function(){return null!=this._timer}}),Object.defineProperty(ActivityMonitor.prototype,"activeChanged",{get:function(){return this._activeChanged}}),ActivityMonitor.prototype.activityDetected=function(){var changed;this._timer?this.$$timeout.cancel(this._timer):null===this._timer&&(changed=!0);var self=this,onTimeout=function(){self._timer=null,self.$$rootScope.$apply(function(){self.enabled&&self.activeChanged.dispatch(self.active)})};this._timer=this.$$timeout(onTimeout,this._timeout),changed&&this.enabled&&this.activeChanged.dispatch(this.active)},window.app.ActivityMonitor=ActivityMonitor}(),window.app.AnalyticsData=function(){function AnalyticsData(name,storageProvider,defaultValue){_classCallCheck(this,AnalyticsData),this._defaultValue=defaultValue||function(){return[]},this._name=name,this._data=this._defaultValue(),this._store=storageProvider("snap_analytics_"+name),this._store.read().then(function(data){return self._data=data||self._data})}return _createClass(AnalyticsData,[{key:"push",value:function(item){this._data.push(item),store()}},{key:"reset",value:function(){this._data=this._defaultValue(),store()}},{key:"store",value:function(){this._store.write(this._data)}},{key:"name",get:function(){return this._name}},{key:"data",get:function(){return this._data},set:function(value){this._data=value,store()}},{key:"length",get:function(){return this._data.length}},{key:"last",get:function(){return this._data[this.length-1]}}]),AnalyticsData}(),window.app.AnalyticsManager=function(){function AnalyticsManager(TelemetryService,AnalyticsModel,Logger){_classCallCheck(this,AnalyticsManager),this._TelemetryService=TelemetryService,this._AnalyticsModel=AnalyticsModel,this._Logger=Logger}return _createClass(AnalyticsManager,[{key:"submit",value:function(){this._Logger.debug("Submitting analytics data with "+(this._AnalyticsModel.sessions.length+" seat sessions, ")+(this._AnalyticsModel.answers.length+" answers, ")+(this._AnalyticsModel.chats.length+" chats, ")+(this._AnalyticsModel.comments.length+" comments, ")+(this._AnalyticsModel.clicks.length+" clicks, ")+(this._AnalyticsModel.pages.length+" pages, ")+(this._AnalyticsModel.advertisements.length+" advertisements and ")+(this._AnalyticsModel.urls.length+" URLs."));var self=this;return new Promise(function(resolve,reject){self._TelemetryService.submitTelemetry({sessions:self._AnalyticsModel.sessions.data,advertisements:self._AnalyticsModel.advertisements.data,answers:self._AnalyticsModel.answers.data,chats:self._AnalyticsModel.chats.data,comments:self._AnalyticsModel.comments.data,clicks:self._AnalyticsModel.clicks.data,pages:self._AnalyticsModel.pages.data,urls:self._AnalyticsModel.urls.data}).then(function(){self._AnalyticsModel.clear(),resolve()},function(e){self._Logger.warn("Unable to submit analytics data: "+e.message),reject(e)})})}}]),AnalyticsManager}(),window.app.AnalyticsModel=function(){function AnalyticsModel(storageProvider,heatmap){_classCallCheck(this,AnalyticsModel);var self=this;this._data=[new app.AnalyticsData("sessions",storageProvider),new app.AnalyticsData("advertisements",storageProvider),new app.AnalyticsData("answers",storageProvider),new app.AnalyticsData("chats",storageProvider),new app.AnalyticsData("comments",storageProvider),new app.AnalyticsData("clicks",storageProvider),new app.AnalyticsData("pages",storageProvider),new app.AnalyticsData("urls",storageProvider)].reduce(function(result,item){return result[item.name]=item,result},{}),heatmap.clicked.add(function(click){self._logClick(click)})}return _createClass(AnalyticsModel,[{key:"logSession",value:function(session){this._data.sessions.push(session)}},{key:"logNavigation",value:function(destination){this._data.pages.push({time:new Date,destination:destination}),this._data.clicks.store()}},{key:"logAdvertisement",value:function(advertisement){this._data.advertisements.push({time:new Date,advertisement:advertisement})}},{key:"logAnswer",value:function(answer){this._data.answers.push({time:new Date,answer:answer})}},{key:"logChat",value:function(chat){this._data.chats.push({time:new Date,chat:chat})}},{key:"logComment",value:function(comment){this._data.comments.push({time:new Date,comment:comment})}},{key:"logUrl",value:function(url){this._data.urls.push({time:new Date,url:url})}},{key:"clear",value:function(){for(var k in this._data)this._data[k].reset()}},{key:"_logClick",value:function(click){click.time=new Date,this._data.clicks.data.push(click)}},{key:"sessions",get:function(){return this._data.sessions}},{key:"pages",get:function(){return this._data.pages}},{key:"advertisements",get:function(){return this._data.advertisements}},{key:"answers",get:function(){return this._data.answers}},{key:"chats",get:function(){return this._data.chats}},{key:"comments",get:function(){return this._data.comments}},{key:"urls",get:function(){return this._data.urls}},{key:"clicks",get:function(){return this._data.clicks.store(),this._data.clicks}}]),AnalyticsModel}(),function(){var AppCache=function(Logger){this._Logger=Logger,this._cache=window.applicationCache,this._appCacheEvents=["cached","checking","downloading","cached","noupdate","obsolete","updateready","progress"];var status=this._getCacheStatus();this._Logger.debug("Cache status: "+status),this.complete=new signals.Signal,this._isComplete=!1,this._isUpdated=!1,this._hadErrors=!1,"UNCACHED"===status&&(this._isComplete=!0,this.complete.dispatch(!1));var self=this;this._errorHandler=function(e){self._handleCacheError(e)},this._eventHandler=function(e){self._handleCacheEvent(e)},this._addEventListeners()};Object.defineProperty(AppCache.prototype,"isComplete",{get:function(){return this._isComplete}}),Object.defineProperty(AppCache.prototype,"isUpdated",{get:function(){return this._isUpdated}}),Object.defineProperty(AppCache.prototype,"hadErrors",{get:function(){return this._hadErrors}}),AppCache.prototype._getCacheStatus=function(){switch(this._cache.status){case this._cache.UNCACHED:return"UNCACHED";case this._cache.IDLE:return"IDLE";case this._cache.CHECKING:return"CHECKING";case this._cache.DOWNLOADING:return"DOWNLOADING";case this._cache.UPDATEREADY:return"UPDATEREADY";case this._cache.OBSOLETE:return"OBSOLETE";default:return"UKNOWN CACHE STATUS"}},AppCache.prototype._result=function(error,updated){this._isComplete=!0,this._isUpdated=updated,this._hadErrors=null!=error,this.complete.dispatch(updated)},AppCache.prototype._addEventListeners=function(){var self=this;this._cache.addEventListener("error",this._errorHandler),this._appCacheEvents.forEach(function(e){self._cache.addEventListener(e,self._eventHandler)})},AppCache.prototype._removeEventListeners=function(){var self=this;this._cache.removeEventListener("error",this._errorHandler),this._appCacheEvents.forEach(function(e){self._cache.removeEventListener(e,self._eventHandler)})},AppCache.prototype._handleCacheEvent=function(e){return"progress"!==e.type&&(this._Logger.debug("Cache event: "+e.type),this._Logger.debug("Cache status: "+this._getCacheStatus())),"updateready"===e.type?(this._Logger.debug("Caching complete. Swapping the cache."),this._removeEventListeners(),this._cache.swapCache(),void this._result(null,!0)):void("cached"===e.type?(this._Logger.debug("Caching complete. Cache saved."),this._removeEventListeners(),this._result(null,!1)):"noupdate"===e.type&&(this._Logger.debug("Caching complete. No updates."),this._removeEventListeners(),this._result(null,!1)))},AppCache.prototype._handleCacheError=function(e){console.error("Cache update error: "+e.message),this._removeEventListeners(),this._result(e,!1)},window.app.AppCache=AppCache}(),window.app.BackendApi=function BackendApi(Hosts,SessionProvider){function businessTokenProvider(){return self._SessionProvider.getBusinessToken()}function customerTokenProvider(){return self._SessionProvider.getCustomerToken()}_classCallCheck(this,BackendApi),this._SessionProvider=SessionProvider;var self=this;for(var key in DtsApiClient){var config={host:{domain:Hosts.api.host,secure:"true"===Hosts.api.secure}},provider=businessTokenProvider;"snap"===key?config.host.domain=Hosts.content.host:"customer"===key&&(provider=customerTokenProvider),this[key]=new DtsApiClient[key](config,provider)}},function(){var CardReader=function(ManagementService){this._ManagementService=ManagementService,this.onReceived=new signals.Signal,this.onError=new signals.Signal};CardReader.prototype.received=function(card){this.onReceived.dispatch(card)},CardReader.prototype.error=function(e){this.onError.dispatch(e)},CardReader.prototype.start=function(){this._active||(this._ManagementService.startCardReader(),this._active=!0)},CardReader.prototype.stop=function(){this._active&&(this._ManagementService.stopCardReader(),this._active=!1)},window.app.CardReader=CardReader}(),window.app.CartItem=function(){function CartItem(item,quantity,name,modifiers,request){_classCallCheck(this,CartItem),this.item=item,this.quantity=quantity,this.name=name,this.request=request,this.hasModifiers?modifiers?this.modifiers=modifiers:this.modifiers=item.modifiers.map(function(category){return new app.CartModifierCategory(category,category.items.map(function(modifier){return new app.CartModifier(modifier)}))}):this.modifiers=[]}return _createClass(CartItem,[{key:"clone",value:function(count){return new app.CartItem(this.item,this.quantity,this.name,this.modifiers.map(function(category){return category.clone()}),this.request)}},{key:"cloneMany",value:function(count){count=count||this.quantity;for(var result=[],i=0;count>i;i++)result.push(new app.CartItem(this.item,1,this.name,this.modifiers.map(function(category){return category.clone()}),this.request));return result}},{key:"restore",value:function(data){return new app.CartItem(data.item,data.quantity,data.name,data.modifiers.map(app.CartModifierCategory.prototype.restore),data.request)}},{key:"hasModifiers",get:function(){return null!=this.item.modifiers&&this.item.modifiers.length>0}},{key:"selectedModifiers",get:function(){return this.modifiers.reduce(function(previousCategory,category,i,array){return array.concat(category.items.filter(function(modifier){return modifier.isSelected}))},[])}}]),CartItem}(),window.app.CartModel=function(){function CartModel(){_classCallCheck(this,CartModel),this.STATE_CART="cart",this.STATE_HISTORY="history",this._isCartOpen=!1,this.isCartOpenChanged=new signals.Signal,this._cartState=this.STATE_CART,this.cartStateChanged=new signals.Signal,this._editableItem=null,this.editableItemChanged=new signals.Signal}return _createClass(CartModel,[{key:"openEditor",value:function(item,isNew){this._editableItem!==item&&(this._editableItemNew=isNew||!1,this._editableItem=item,this.editableItemChanged.dispatch(item))}},{key:"closeEditor",value:function(){this._editableItemNew=!1,this._editableItem=null,this.editableItemChanged.dispatch(null)}},{key:"isCartOpen",get:function(){return this._isCartOpen},set:function(value){this._isCartOpen!==value&&(this._isCartOpen=value,this.isCartOpenChanged.dispatch(value))}},{key:"cartState",get:function(){return this._cartState},set:function(value){this._cartState!==value&&(this._cartState=value,this.cartStateChanged.dispatch(value))}},{key:"editableItem",get:function(){return this._editableItem}},{key:"editableItemNew",get:function(){return this._editableItemNew}}]),CartModel}(),function(){var CartModifier=function(data,isSelected){this.data=data,this.isSelected=isSelected||!1};CartModifier.prototype.clone=function(){return new app.CartModifier(this.data,this.isSelected)},CartModifier.prototype.restore=function(data){return new app.CartModifier(data.data,data.isSelected)},window.app.CartModifier=CartModifier;var CartModifierCategory=function(data,modifiers){this.data=data,this.modifiers=modifiers};CartModifierCategory.prototype.clone=function(){var modifiers=this.modifiers.map(function(modifier){return modifier.clone()});return new app.CartModifierCategory(this.data,modifiers)},CartModifierCategory.prototype.restore=function(data){return new app.CartModifierCategory(data.data,data.modifiers.map(CartModifier.prototype.restore))},window.app.CartModifierCategory=CartModifierCategory}(),window.app.ChatManager=function(){function ChatManager(AnalyticsModel,ChatModel,CustomerModel,LocationModel,SocketClient){_classCallCheck(this,ChatManager);var self=this;this.MESSAGE_TYPES={LOCATION:"location",DEVICE:"device"},this.MESSAGE_STATUSES={CHAT_REQUEST:"chat_request",CHAT_REQUEST_ACCEPTED:"chat_request_accepted",CHAT_REQUEST_DECLINED:"chat_request_declined",GIFT_REQUEST:"gift_request",GIFT_REQUEST_ACCEPTED:"gift_request_accepted",GIFT_REQUEST_DECLINED:"gift_request_declined",CHAT_CLOSED:"chat_closed"},this.OPERATIONS={CHAT_MESSAGE:"chat_message",STATUS_REQUEST:"status_request",STATUS_UPDATE:"status_update"},this.ROOMS={LOCATION:"location_",DEVICE:"device_"},this._AnalyticsModel=AnalyticsModel,this._ChatModel=ChatModel,this._CustomerModel=CustomerModel,this._LocationModel=LocationModel,this._SocketClient=SocketClient,this._ChatModel.isEnabledChanged.add(function(){return self._sendStatusUpdate()}),this._ChatModel.isPresentChanged.add(function(){return self._sendStatusUpdate()}),this._CustomerModel.profileChanged.add(function(){return self._sendStatusUpdate()}),this._LocationModel.seatChanged.add(function(){return self._sendStatusUpdate()}),this._SocketClient.isConnectedChanged.add(function(isConnected){self.model.isConnected=isConnected,self._sendStatusUpdate(),self._sendStatusRequest()}),this._SocketClient.subscribe(this.ROOMS.LOCATION+this._LocationModel.location,function(message){switch(message.operation){case self.OPERATIONS.CHAT_MESSAGE:self._onMessage(message);break;case self.OPERATIONS.STATUS_REQUEST:self._onStatusRequest(message);break;case self.OPERATIONS.STATUS_UPDATE:self._onStatusUpdate(message)}}),this._SocketClient.subscribe(this.ROOMS.DEVICE+this._LocationModel.device,function(message){switch(message.operation){case self.OPERATIONS.CHAT_MESSAGE:self._onMessage(message);break;case self.OPERATIONS.STATUS_UPDATE:self._onStatusUpdate(message)}})}return _createClass(ChatManager,[{key:"reset",value:function(){return this.model.reset(),Promise.resolve()}},{key:"sendMessage",value:function(message){message.device=this._LocationModel.device,message.operation=this.OPERATIONS.CHAT_MESSAGE,message.type=message.to_device?this.MESSAGE_TYPES.DEVICE:this.MESSAGE_TYPES.LOCATION,this._addMessageID(message),this.model.addHistory(message);var topic=this._getTopic(message);this._SocketClient.send(topic,message),this._AnalyticsModel.logChat(message)}},{key:"approveDevice",value:function(token){var device=this._LocationModel.getDevice(token);this.model.setLastRead(token,moment().unix()),this.model.isPendingDevice(device)?(this.model.removePendingDevice(device),this.sendMessage({status:this.MESSAGE_STATUSES.CHAT_REQUEST_ACCEPTED,to_device:device.token})):this.sendMessage({status:this.MESSAGE_STATUSES.CHAT_REQUEST,to_device:device.token}),this.model.isActiveDevice(device)||this.model.addActiveDevice(device)}},{key:"declineDevice",value:function(token){var device=this._LocationModel.getDevice(token);this.model.isActiveDevice(device)?(this.model.removeActiveDevice(device),this.sendMessage({status:this.MESSAGE_STATUSES.CHAT_CLOSED,to_device:device.token})):this.sendMessage({status:this.MESSAGE_STATUSES.CHAT_REQUEST_DECLINED,to_device:device.token})}},{key:"getMessageName",value:function(message){return this._LocationModel.device===message.device?"Me":message.username||this.getDeviceName(message.device)}},{key:"getDeviceName",value:function(token){var device=this._LocationModel.getDevice(token);if(device){if(this._LocationModel.device===device.token)return"Me";if(device.username)return device.username;for(var p in this._LocationModel.seats)if(this._LocationModel.seats[p].token===device.seat)return this._LocationModel.seats[p].name}return"Guest"}},{key:"checkIfUnread",value:function(device_token,message){var lastRead=this.model.getLastRead(device_token);return lastRead?message?moment.unix(message.received).isAfter(moment.unix(lastRead)):this.getUnreadCount(device_token)>0:!1}},{key:"getUnreadCount",value:function(device_token){var lastRead=this.model.getLastRead(device_token);if(!lastRead)return 0;var self=this,fromDate=moment.unix(lastRead);return this.model.history.filter(function(message){return message.type===self.MESSAGE_TYPES.DEVICE&&message.device===device_token}).filter(function(message){return moment.unix(message.received).isAfter(fromDate)}).length}},{key:"markAsRead",value:function(device_token){this.model.setLastRead(device_token,moment().unix())}},{key:"sendGift",value:function(items){this.model.giftDevice&&this.sendMessage({status:this.MESSAGE_STATUSES.GIFT_REQUEST,to_device:this.model.giftDevice,text:items.reduce(function(result,item){return""!==result&&(result+=", "),result+=item.item.title},"")})}},{key:"acceptGift",value:function(device){this.sendMessage({status:this.MESSAGE_STATUSES.GIFT_REQUEST_ACCEPTED,to_device:device.token})}},{key:"declineGift",value:function(device){this.sendMessage({status:this.MESSAGE_STATUSES.GIFT_REQUEST_DECLINED,to_device:device.token})}},{key:"startGift",value:function(device_token){var device=this._LocationModel.getDevice(device_token);this.model.giftDevice=device_token,this.model.giftSeat=device.seat}},{key:"endGift",value:function(){this.model.giftDevice=null,this.model.giftSeat=null}},{key:"_onMessage",value:function(message){if(message.id&&!(this.model.history.filter(function(msg){return msg.id===message.id}).length>0)){message.received=moment().unix();var device=this._LocationModel.getDevice(message.device),giftDevice=this.model.giftDevice;this._LocationModel.seat.token;device&&(message.status!==this.MESSAGE_STATUSES.CHAT_REQUEST||this.model.isPendingDevice(device)||this.model.isActiveDevice(device)||(this.model.addPendingDevice(device),this.model.chatRequestReceived.dispatch(device.token)),message.status===this.MESSAGE_STATUSES.GIFT_REQUEST&&this.model.isActiveDevice(device)&&this.model.giftRequestReceived.dispatch(device,message.text),message.to_device&&(message.status===this.MESSAGE_STATUSES.GIFT_REQUEST_ACCEPTED?giftDevice&&giftDevice===message.device&&(this.model.giftAccepted.dispatch(!0),this.model.giftDevice=null):message.status===this.MESSAGE_STATUSES.GIFT_REQUEST_DECLINED?giftDevice&&giftDevice===message.device&&(this.model.giftAccepted.dispatch(!1),this.model.giftDevice=null):message.status===this.MESSAGE_STATUSES.CHAT_REQUEST_DECLINED&&this.declineDevice(device)),message.operation===this.OPERATIONS.CHAT_MESSAGE&&(message.username=this.getDeviceName(device),this.model.addHistory(message)),this.model.messageReceived.dispatch(message))}}},{key:"_onStatusRequest",value:function(message){message.device!==this._LocationModel.device&&this._sendStatusUpdate(message.device)}},{key:"_onStatusUpdate",value:function(message){if(message.device!==this._LocationModel.device){var device=this._LocationModel.getDevice(message.device);if(device||(device={token:message.device},this._LocationModel.addDevice(device)),!message.is_available&&device.is_available){var _history={operation:this.OPERATIONS.CHAT_MESSAGE,type:this.MESSAGE_TYPES.DEVICE,device:device.token,status:this.MESSAGE_STATUSES.CHAT_CLOSED,to_device:this._LocationModel.device};this._addMessageID(_history),this.model.addHistory(_history)}device.is_available=Boolean(message.is_available),device.is_present=Boolean(message.is_present),device.seat=message.seat,device.username=message.username,this._LocationModel.devicesChanged.dispatch(this._LocationModel.devices)}}},{key:"_sendStatusRequest",value:function(){if(this.model.isConnected){var message={operation:this.OPERATIONS.STATUS_REQUEST,device:this._LocationModel.device};this._SocketClient.send(this._getTopic(message),message)}}},{key:"_sendStatusUpdate",value:function(device){if(this.model.isConnected){var profile=this._CustomerModel.profile,username=void 0;profile&&profile.first_name&&(username=profile.first_name+" "+profile.last_name);var message={operation:this.OPERATIONS.STATUS_UPDATE,to_device:device,device:this._LocationModel.device,seat:this._LocationModel.seat.token,is_available:this.model.isEnabled,is_present:this.model.isPresent,username:username};this._SocketClient.send(this._getTopic(message),message)}}},{key:"_getTopic",value:function(message){return message.to_device?this.ROOMS.DEVICE+message.to_device:this.ROOMS.LOCATION+this._LocationModel.location}},{key:"_addMessageID",value:function(message){message.id=message.id||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"===c?r:3&r|8;return v.toString(16)})}},{key:"model",get:function(){return this._ChatModel}}]),ChatManager}(),window.app.ChatModel=function(){function ChatModel(SNAPConfig,SNAPEnvironment,storageProvider){_classCallCheck(this,ChatModel);var self=this;this._preferencesStore=storageProvider("snap_chat_preferences"),this._historyStore=storageProvider("snap_chat_history"),this.isConnectedChanged=new signals.Signal,this.isEnabledChanged=new signals.Signal,this.isPresentChanged=new signals.Signal,this.activeDevicesChanged=new signals.Signal,this.pendingDevicesChanged=new signals.Signal,this.chatRequestReceived=new signals.Signal,this.historyChanged=new signals.Signal,this.messageReceived=new signals.Signal,this.giftRequestReceived=new signals.Signal,this.giftAccepted=new signals.Signal,this._giftSeat=null,this.giftSeatChanged=new signals.Signal,this._giftDevice=null,this.giftDeviceChanged=new signals.Signal,this.giftReady=new signals.Signal,this.giftAccepted=new signals.Signal,this._isEnabled=SNAPConfig.chat,this._pendingDevices=[],this._activeDevices=[],this._lastReads={},this._preferencesStore.read().then(function(prefs){prefs&&(self._isEnabled=Boolean(prefs.is_enabled),self._activeDevices=prefs.active_devices||[],self._pendingDevices=prefs.pending_devices||[],self._lastReads=prefs.last_reads||{})}),this._historyStore.read().then(function(history){self._history=history||[]})}return _createClass(ChatModel,[{key:"isActiveDevice",value:function(device){return-1!==this.activeDevices.indexOf(device.token||device)}},{key:"isPendingDevice",value:function(device){return-1!==this.pendingDevices.indexOf(device.token||device)}},{key:"addActiveDevice",value:function(device){this._activeDevices.push(device.token||device),this.activeDevices=this._activeDevices}},{key:"addPendingDevice",value:function(device){this._pendingDevices.push(device.token||device),this.pendingDevices=this._pendingDevices}},{key:"removeActiveDevice",value:function(device){var index=this.activeDevices.indexOf(device.token||device);this._activeDevices.splice(index,1),this.activeDevices=this._activeDevices}},{key:"removePendingDevice",value:function(device){var index=this.pendingDevices.indexOf(device.token||device);this._pendingDevices.splice(index,1),this.pendingDevices=this._pendingDevices}},{key:"addHistory",value:function(message){this._history.push(message),this.history=this._history}},{key:"getLastRead",value:function(device){var token=device.token||device;return this._lastReads[token]||null}},{key:"setLastRead",value:function(device,value){var token=device.token||device;this._lastReads[token]=value,this._updatePreferences()}},{key:"save",value:function(){this._updateHistory(),this._updatePreferences()}},{key:"reset",value:function(){this._isConnected=this._isEnabled=this._isPresent=!1,this._history=[],this._activeDevices=[],this._pendingDevices=[],this._historyStore.clear(),this._preferencesStore.clear()}},{key:"_updateHistory",value:function(){this._historyStore.write(this.history)}},{key:"_updatePreferences",value:function(){this._preferencesStore.write({is_enabled:this.isEnabled,active_devices:this.activeDevices,pending_devices:this.pendingDevices,last_reads:this._lastReads})}},{key:"isConnected",get:function(){return this._isConnected},set:function(value){this._isConnected!==value&&(this._isConnected=Boolean(value),this.isConnectedChanged.dispatch(this._isConnected))}},{key:"isEnabled",get:function(){return this._isEnabled},set:function(value){this._isEnabled!==value&&(this._isEnabled=Boolean(value),this.isEnabledChanged.dispatch(this._isEnabled),this._updatePreferences())}},{key:"isPresent",get:function(){return this._isPresent},set:function(value){this._isPresent!==value&&(this._isPresent=Boolean(value),this.isPresentChanged.dispatch(this._isPresent))}},{key:"giftDevice",get:function(){return this._giftDevice},set:function(value){this._giftDevice!==value&&(this._giftDevice=value,this.giftDeviceChanged.dispatch(this._giftDevice))}},{key:"giftSeat",get:function(){return this._giftSeat},set:function(value){this._giftSeat!==value&&(this._giftSeat=value,this.giftSeatChanged.dispatch(this._giftSeat))}},{key:"pendingDevices",get:function(){return this._pendingDevices},set:function(value){this._pendingDevices=value||[],this.pendingDevicesChanged.dispatch(this.pendingDevices)}},{key:"activeDevices",get:function(){return this._activeDevices},set:function(value){this._activeDevices=value||[],this.activeDevicesChanged.dispatch(this.activeDevices)}},{key:"history",get:function(){return this._history},set:function(value){this._history=value||[],this.historyChanged.dispatch(this._history),this._updateHistory()}}]),ChatModel}(),window.app.CustomerManager=function(){function CustomerManager(Config,Environment,DtsApi,CustomerModel){_classCallCheck(this,CustomerManager),this._api=DtsApi,this._CustomerModel=CustomerModel,this._customerAppId=Environment.customer_application.client_id}return _createClass(CustomerManager,[{key:"logout",value:function(){var self=this;return new Promise(function(resolve){self._CustomerModel.profile=null,resolve()})}},{key:"guestLogin",value:function(){var self=this;return new Promise(function(resolve){self._CustomerModel.profile="guest",resolve()})}},{key:"login",value:function(credentials){var self=this;return new Promise(function(resolve,reject){self._api.oauth2.getTokenWithCredentials(self._customerAppId,credentials.login,credentials.password).then(function(result){if(!result)return reject();if(result.error||!result.access_token)return reject(result.error);var session={access_token:result.access_token};result.expires_in&&(session.expires=moment().add(result.expires_in,"seconds").unix()),self._CustomerModel.session=session,self._loadProfile().then(resolve,function(e){self._CustomerModel.session=null,reject(e)})},reject)})}},{key:"loginSocial",value:function(token){var self=this;return new Promise(function(resolve,reject){var session={access_token:token.access_token};token.expires_in&&(session.expires=moment().add(token.expires_in,"seconds").unix()),self._CustomerModel.session=session,self._loadProfile().then(resolve,function(e){self._CustomerModel.session=null,reject(e)})})}},{key:"signUp",value:function(registration){var self=this;return new Promise(function(resolve,reject){registration.client_id=self._customerAppId,self._api.customer.signUp(registration).then(function(){self.login({login:registration.username,password:registration.password}).then(resolve,reject)},reject)})}},{key:"updateProfile",value:function(profile){var self=this;return new Promise(function(resolve,reject){self._api.customer.updateProfile(profile).then(function(){self._CustomerModel.profile=profile,resolve()},reject)})}},{key:"changePassword",value:function(request){var self=this;return new Promise(function(resolve,reject){self._api.customer.changePassword(request).then(function(){self.login({login:self._CustomerModel.email,password:request.new_password}).then(resolve,reject)},reject)})}},{key:"resetPassword",value:function(request){var self=this;return new Promise(function(resolve,reject){self._api.customer.resetPassword(request).then(function(){resolve()},reject)})}},{key:"_loadProfile",value:function(){var self=this;return new Promise(function(resolve,reject){self._api.customer.getProfile().then(function(profile){self._CustomerModel.profile=profile,resolve()},reject)})}},{key:"model",get:function(){return this._CustomerModel}},{key:"customerName",get:function(){if(this.model.isEnabled&&this.model.isAuthenticated&&!this.model.isGuest){var name="";return CustomerManager.model.profile.first_name&&(name+=CustomerManager.model.profile.first_name),CustomerManager.model.profile.last_name&&(name+=" "+CustomerManager.model.profile.last_name),name}return"Guest"}}]),CustomerManager}(),window.app.CustomerModel=function(){function CustomerModel(Config,storageProvider){_classCallCheck(this,CustomerModel);var self=this;this._accountStore=storageProvider("snap_customer"),this._sessionStore=storageProvider("snap_customer_accesstoken"),this._profile=null,this._session=null,this._isGuest=!1,this._isEnabled=Boolean(Config.accounts),this.profileChanged=new signals.Signal,this._accountStore.read().then(function(account){self._isGuest=account&&account.is_guest,!account||account.is_guest?self._profile=null:self._profile=account.profile,self.profileChanged.dispatch(self._profile)})}return _createClass(CustomerModel,[{key:"isEnabled",get:function(){return Boolean(this._isEnabled)}},{key:"isAuthenticated",get:function(){return this.isEnabled&&(Boolean(this.profile)||this.isGuest)}},{key:"isGuest",get:function(){return this.isEnabled&&Boolean(this._isGuest)}},{key:"hasCredentials",get:function(){return Boolean(this.isAuthenticated&&!this.isGuest&&1===this.profile.type)}},{key:"profile",get:function(){return this._profile},set:function(value){var self=this;this._profile=value||null,this._isGuest="guest"===value,value?this._accountStore.write({profile:this._profile,is_guest:this._isGuest}).then(function(){self.profileChanged.dispatch(self._profile),(!value||self._isGuest)&&(self.session=null)}):this._accountStore.clear().then(function(){self._isGuest=!1,self.profileChanged.dispatch(self._profile),self.session=null})}},{key:"session",get:function(){return this._session},set:function(value){this._session=value||null,value?this._sessionStore.write(this._session):this._sessionStore.clear()}}]),CustomerModel}(),window.app.DataManager=function(){function DataManager(DataProvider,Logger,SNAPEnvironment){_classCallCheck(this,DataManager),this._DataProvider=DataProvider,
this._Logger=Logger,this._SNAPEnvironment=SNAPEnvironment,this.homeChanged=new signals.Signal,this.menuChanged=new signals.Signal,this.categoryChanged=new signals.Signal,this.itemChanged=new signals.Signal,this._CACHEABLE_MEDIA_KINDS=[41,51,58,61]}return _createClass(DataManager,[{key:"initialize",value:function(){var self=this;this._cache={menu:{},category:{},item:{},media:{}},this._Logger.debug("Initializing data manager."),this.provider.digest().then(function(digest){var menuSets=digest.menu_sets.map(function(menu){return new Promise(function(resolve,reject){self.provider.menu(menu.token).then(function(data){return self._cache.menu[menu.token]=self._filterMenu(data)}).then(resolve,resolve)})}),menuCategories=digest.menu_categories.map(function(category){return new Promise(function(resolve,reject){self.provider.category(category.token).then(function(data){return self._cache.category[category.token]=self._filterCategory(data)}).then(resolve,resolve)})}),menuItems=digest.menu_items.map(function(item){return new Promise(function(resolve,reject){self.provider.item(item.token).then(function(data){return self._cache.item[item.token]=data}).then(resolve,resolve)})}),medias=digest.media.filter(function(media){return-1!==self._CACHEABLE_MEDIA_KINDS.indexOf(media.kind)}).map(function(media){var width,height;switch(media.kind){case 41:case 51:width=370,height=370;break;case 58:width=600,height=600;break;case 61:width=100,height=100}return media.width=width,media.height=height,media}).map(function(media){return new Promise(function(resolve,reject){self.provider.media(media).then(function(img){return self._cache.media[media.token]=img}).then(resolve,resolve)})});self._Logger.debug("Digest contains "+menuSets.length+" menus, "+(menuCategories.length+" categories, ")+(menuItems.length+" items and ")+(medias.length+" files."));var tasks=[].concat(menuSets).concat(menuCategories).concat(menuItems);Promise.all(tasks).then(function(){Promise.all(medias)})})}},{key:"_cached",value:function(group,id){return this._cache?id&&this._cache[group]&&this._cache[group][id]?this._cache[group][id]:!id&&this._cache[group]?this._cache[group]:null:null}},{key:"_filterHome",value:function(data){var self=this;return data.menus=data.menus.filter(function(menu){return"desktop"===self._SNAPEnvironment.platform||3!==menu.type}),data}},{key:"_filterMenu",value:function(data){return data}},{key:"_filterCategory",value:function(data){var self=this;return data.items=data.items.filter(function(item){return"desktop"===self._SNAPEnvironment.platform||3!==item.type}),data}},{key:"provider",get:function(){return this._DataProvider}},{key:"home",get:function(){return this._home},set:function(value){if(this._home!==value)if(value){var self=this;this._home=value,this.provider.home().then(function(home){self._home&&(home=self._filterHome(home),self.homeChanged.dispatch(home))})}else this._home=void 0,this.homeChanged.dispatch(void 0)}},{key:"menu",get:function(){return this._menu},set:function(value){if(this._menu!==value)if(value){var self=this;this._menu=value;var data=this._cached("menu",value);if(data)return this.menuChanged.dispatch(data);this.provider.menu(value).then(function(menu){self._menu&&(menu=self._filterMenu(menu),self.menuChanged.dispatch(menu))})}else this._menu=void 0,this.menuChanged.dispatch(void 0)}},{key:"category",get:function(){return this._category},set:function(value){if(this._category!==value)if(value){var self=this;this._category=value;var data=this._cached("category",value);if(data)return this.categoryChanged.dispatch(data);this.provider.category(value).then(function(category){self._category&&(category=self._filterCategory(category),self.categoryChanged.dispatch(category))})}else this._category=void 0,this.categoryChanged.dispatch(void 0)}},{key:"item",get:function(){return this._item},set:function(value){if(this._item!==value)if(value){var self=this;this._item=value;var data=this._cached("item",value);if(data)return this.itemChanged.dispatch(data);this.provider.item(value).then(function(item){self._item&&self.itemChanged.dispatch(item)})}else this._item=void 0,this.itemChanged.dispatch(void 0)}}]),DataManager}(),window.app.DataProvider=function(){function DataProvider(config,service){_classCallCheck(this,DataProvider),this._config=config,this._service=service,this._cache={}}return _createClass(DataProvider,[{key:"clear",value:function(){var self=this;return new Promise(function(resolve,reject){self._cache={},resolve()})}},{key:"digest",value:function(){return this._getSnapData("digest","getDigest")}},{key:"home",value:function(){return this._getSnapData("home","getMenus")}},{key:"advertisements",value:function(){return this._getSnapData("advertisements","getAdvertisements")}},{key:"backgrounds",value:function(){return this._getSnapData("backgrounds","getBackgrounds")}},{key:"elements",value:function(){return this._getSnapData("elements","getElements")}},{key:"menu",value:function(id){return this._getSnapData("menu","getMenu",id)}},{key:"category",value:function(id){return this._getSnapData("category","getMenuCategory",id)}},{key:"item",value:function(id){return this._getSnapData("item","getMenuItem",id)}},{key:"surveys",value:function(){return this._getSnapData("surveys","getSurveys")}},{key:"seats",value:function(){var self=this;return this._cached("seats")||this._service.location.getSeats().then(function(data){return data=data||[],self._store(data,"seats"),data},this._onError)}},{key:"media",value:function(_media){var self=this,token=_media.token+"_"+_media.width+"_"+_media.height;return this._cached("media",token)||new Promise(function(resolve,reject){if(_media.width&&_media.height){var img=new Image;img.onload=function(){return resolve(img)},img.onerror=function(e){return reject(e)},img.src=self._getMediaUrl(_media,_media.width,_media.height,_media.extension),self._store(img,"media",token),img.complete&&resolve(img)}else reject("Missing image dimensions")},this._onError)}},{key:"_getSnapData",value:function(name,method,id){var self=this;return this._cached(name,id)||this._service.snap[method](this._config.location,id).then(function(data){return data=data||[],self._store(data,name,id),data},this._onError)}},{key:"_onError",value:function(e){return console.error(e.message),e}},{key:"_cached",value:function(group,id){return id&&this._cache[group]&&this._cache[group][id]?Promise.resolve(this._cache[group][id]):!id&&this._cache[group]?Promise.resolve(this._cache[group]):null}},{key:"_store",value:function(data,group,id){id?(this._cache[group]||(this._cache[group]={}),this._cache[group][id]=data):this._cache[group]=data}},{key:"_getMediaUrl",value:function(){}}]),DataProvider}(),window.app.DialogManager=function(){function DialogManager(){_classCallCheck(this,DialogManager),this.alertRequested=new signals.Signal,this.notificationRequested=new signals.Signal,this.confirmRequested=new signals.Signal,this.jobStarted=new signals.Signal,this.jobEnded=new signals.Signal,this.modalStarted=new signals.Signal,this.modalEnded=new signals.Signal,this._jobs=0,this._modals=0}return _createClass(DialogManager,[{key:"alert",value:function(message,title){this.alertRequested.dispatch(message,title)}},{key:"notification",value:function(message){this.notificationRequested.dispatch(message)}},{key:"confirm",value:function(message){var self=this;return new Promise(function(resolve,reject){self.confirmRequested.dispatch(message,resolve,reject)})}},{key:"startJob",value:function(){return this._jobs++,1===this._jobs&&this.jobStarted.dispatch(),this._jobs}},{key:"endJob",value:function(id){this._jobs--,0===this._jobs&&this.jobEnded.dispatch()}},{key:"startModal",value:function(){return this._modals++,1===this._modals&&this.modalStarted.dispatch(),this._modals}},{key:"endModal",value:function(id){this._modals--,0===this._modals&&this.modalEnded.dispatch()}}]),DialogManager}(),window.app.HeatMap=function(){function HeatMap(element){_classCallCheck(this,HeatMap);var self=this;this._listener=function(e){self._onClick(e)},this._element=element,this._element.addEventListener("click",this._listener),this.clicked=new signals.Signal}return _createClass(HeatMap,[{key:"dispose",value:function(){this._element.removeEventListener("click",this._listener)}},{key:"_onClick",value:function(e){var data={x:e.layerX/this._element.clientWidth,y:e.layerY/this._element.clientHeight};data.x<0||data.y<0||data.x>1||data.y>1||this.clicked.dispatch(data)}}]),HeatMap}(),window.app.LocationModel=function(){function LocationModel(SNAPEnvironment,storageProvider){_classCallCheck(this,LocationModel);var self=this;this._location=SNAPEnvironment.location,this._seatStore=storageProvider("snap_seat"),this._seat={},this.seatChanged=new signals.Signal,this._seats=[],this.seatsChanged=new signals.Signal,this._device=SNAPEnvironment.device,this._devices=[],this.devicesChanged=new signals.Signal,this._seatStore.read().then(function(seat){self._seat=seat,seat&&self.seatChanged.dispatch(self._seat)})}return _createClass(LocationModel,[{key:"addDevice",value:function(device){this._devices.push(device),this.devices=this._devices}},{key:"getSeat",value:function(token){return this.seats.filter(function(seat){return seat.token===token})[0]||null}},{key:"getDevice",value:function(device){return this.devices.filter(function(d){return(device.token||device)===d.token})[0]||null}},{key:"location",get:function(){return this._location}},{key:"seat",get:function(){return this._seat},set:function(value){var self=this,oldSeat=this._seat||{};this._seat=value||{},value?this._seatStore.write(this._seat).then(function(){self.seatChanged.dispatch(self._seat)},function(){self._seat=oldSeat}):this._seatStore.clear().then(function(){self.seatChanged.dispatch(self._seat)},function(){self._seat=oldSeat})}},{key:"seats",get:function(){return this._seats},set:function(value){this._seats!==value&&(this._seats=value||[],this.seatsChanged.dispatch(this._seats))}},{key:"device",get:function(){return this._device}},{key:"devices",get:function(){return this._devices},set:function(value){this._devices!==value&&(this._devices=value||[],this.devicesChanged.dispatch(this._devices))}}]),LocationModel}(),window.app.Logger=function(){function _class(SNAPEnvironment){_classCallCheck(this,_class),this._SNAPEnvironment=SNAPEnvironment,this._log=log4javascript.getLogger();var ajaxAppender=new log4javascript.AjaxAppender("/snap/log");ajaxAppender.setWaitForResponse(!0),ajaxAppender.setLayout(new log4javascript.JsonLayout),ajaxAppender.setThreshold(log4javascript.Level.ERROR),this._log.addAppender(ajaxAppender),this._log.addAppender(new log4javascript.BrowserConsoleAppender)}return _createClass(_class,[{key:"debug",value:function(){var _log;(_log=this._log).debug.apply(_log,arguments)}},{key:"info",value:function(){var _log2;(_log2=this._log).info.apply(_log2,arguments)}},{key:"warn",value:function(){var _log3;(_log3=this._log).warn.apply(_log3,arguments)}},{key:"error",value:function(){var _log4;(_log4=this._log).error.apply(_log4,arguments)}},{key:"fatal",value:function(){var _log5;(_log5=this._log).fatal.apply(_log5,arguments)}}]),_class}(),window.app.ManagementService=function(){function ManagementService($resource,SNAPEnvironment){_classCallCheck(this,ManagementService),this._api={rotateScreen:$resource("/management/rotate-screen",{},{query:{method:"GET"}}),openBrowser:$resource("/management/open-browser",{},{query:{method:"GET"}}),closeBrowser:$resource("/management/close-browser",{},{query:{method:"GET"}}),startCardReader:$resource("/management/start-card-reader",{},{query:{method:"GET"}}),stopCardReader:$resource("/management/stop-card-reader",{},{query:{method:"GET"}}),reset:$resource("/management/reset",{},{query:{method:"GET"}}),getSoundVolume:$resource("/management/volume",{},{query:{method:"GET"}}),setSoundVolume:$resource("/management/volume",{},{query:{method:"GET"}}),getDisplayBrightness:$resource("/management/brightness",{},{query:{method:"GET"}}),setDisplayBrightness:$resource("/management/brightness",{},{query:{method:"GET"}})},this._SNAPEnvironment=SNAPEnvironment}return _createClass(ManagementService,[{key:"rotateScreen",value:function(){this._api.rotateScreen.query()}},{key:"openBrowser",value:function(url){this._api.openBrowser.query({url:url})}},{key:"closeBrowser",value:function(){this._api.closeBrowser.query()}},{key:"startCardReader",value:function(){this._api.startCardReader.query()}},{key:"stopCardReader",value:function(){this._api.stopCardReader.query()}},{key:"reset",value:function(){var self=this;return new Promise(function(resolve,reject){self._api.reset.query().$promise.then(resolve,function(){window.location.assign("/snap/"+encodeURIComponent(self._SNAPEnvironment.platform))})})}},{key:"getSoundVolume",value:function(){return this._api.getSoundVolume.query().$promise}},{key:"setSoundVolume",value:function(value){return this._api.setSoundVolume.query({value:value}).$promise}},{key:"getDisplayBrightness",value:function(){return this._api.getDisplayBrightness.query().$promise}},{key:"setDisplayBrightness",value:function(value){return this._api.setDisplayBrightness.query({value:value}).$promise}}]),ManagementService}(),function(){function MediaStarter(id){var flashvars={},params={menu:"false",wmode:"direct",allowFullScreen:"false"},attributes={id:id,name:id};swfobject.embedSWF(this._getQueryParameter("url"),id,this._getQueryParameter("width"),this._getQueryParameter("height"),"16.0.0","expressInstall.swf",flashvars,params,attributes,function(res){res.success!==!0&&console.error(res)})}MediaStarter.prototype._getQueryParameter=function(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\#&]"+name+"=([^&#]*)"),results=regex.exec(location.hash);return null===results?void 0:decodeURIComponent(results[1].replace(/\+/g," "))},window.app.MediaStarter=MediaStarter}(),window.app.NavigationManager=function(){function NavigationManager($rootScope,$location,$window,AnalyticsModel){_classCallCheck(this,NavigationManager),this.$$location=$location,this.$$window=$window,this._AnalyticsModel=AnalyticsModel,this.locationChanging=new signals.Signal,this.locationChanged=new signals.Signal;var self=this;$rootScope.$on("$locationChangeSuccess",function(){var path=self.$$location.path();return path===self._path?void self.locationChanged.dispatch(self._location):(self._path=path,self._location=self.getLocation(path),self.locationChanging.dispatch(self._location),void self.locationChanged.dispatch(self._location))}),this.locationChanged.add(function(location){return self._AnalyticsModel.logNavigation(location)})}return _createClass(NavigationManager,[{key:"getPath",value:function(location){return location?location.token?"/"+location.type+"/"+location.token:location.url?"/"+location.type+"/"+encodeURIComponent(location.url):"home"===location.type?"/":"/"+location.type:null}},{key:"getLocation",value:function(path){var match=/\/(\w+)?(\/(.+))?/.exec(path);if(match&&match.length>1){var type=match[1],param=match[3];if(void 0!==param)switch(type){case"url":return{type:type,url:decodeURIComponent(param)};default:return{type:type,token:param}}return type||(type="home"),{type:type}}return{}}},{key:"goBack",value:function(){"home"!==this.location.type&&"signin"!==this.location.type&&this.$$window.history.back()}},{key:"path",get:function(){return this._path},set:function(value){var i=value.indexOf("#"),path=-1!==i?value.substring(i+1):value;this.location=this.getLocation(path)}},{key:"location",get:function(){return this._location},set:function(value){this._location=value,this.locationChanging.dispatch(this._location);var path=this._path=this.getPath(this._location);this.$$location.path(path)}}]),NavigationManager}(),window.app.OrderManager=function(){function OrderManager(ChatModel,CustomerModel,DataProvider,DtsApi,LocationModel,OrderModel){_classCallCheck(this,OrderManager);var self=this;this._DtsApi=DtsApi,this._ChatModel=ChatModel,this._CustomerModel=CustomerModel,this._DataProvider=DataProvider,this._LocationModel=LocationModel,this._OrderModel=OrderModel,this._ChatModel.giftSeatChanged.add(function(giftSeat){0===self.model.orderCartStash.length&&(self.model.orderCartStash=self.model.orderCart,self.model.orderCart=[]),giftSeat||(self.model.orderCart=self.model.orderCartStash)}),this._DataProvider.seats().then(function(seats){self._LocationModel.seats=seats,self._DtsApi.location.getCurrentSeat().then(function(seat){self._LocationModel.seat=seat})})}return _createClass(OrderManager,[{key:"reset",value:function(){var self=this;return new Promise(function(resolve){self.model.clearWatcher(self.model.REQUEST_KIND_ORDER),self.model.clearWatcher(self.model.REQUEST_KIND_ASSISTANCE),self.model.clearWatcher(self.model.REQUEST_KIND_CLOSEOUT),self.clearCart(),self.clearCheck(),self.model.orderTicket={},resolve()})}},{key:"addToCart",value:function(item){return this.model.orderCart.push(item),this.model.orderCartChanged.dispatch(this.model.orderCart),this._ChatModel.giftSeat&&this._ChatModel.giftReady.dispatch(),this.model.orderCart}},{key:"removeFromCart",value:function(item){return this.model.orderCart=this.model.orderCart.filter(function(entry){return entry!==item}),this.model.orderCart}},{key:"clearCart",value:function(){this.model.orderCart=[],this.model.orderCartStash=[],this._ChatModel.giftSeat=null}},{key:"clearCheck",value:function(items){var result=[];if(items)for(var i=0;i<this.model.orderCheck.length;i++){for(var found=!1,j=0;j<items.length;j++)if(this.model.orderCheck[i]===items[j]){found=!0;break}found||result.push(this.model.orderCheck[i])}this.model.orderCheck=result}},{key:"submitCart",value:function(options){if(0!==this.model.orderCart.length){options=options||0,this._ChatModel.giftSeat&&(options|=4);var self=this,request={kind:this.model.REQUEST_KIND_ORDER,items:this.model.orderCart.map(function(entry){return{token:entry.item.order.token,quantity:entry.quantity,modifiers:entry.modifiers.reduce(function(result,category){return result.concat(category.modifiers.reduce(function(result,modifier){return modifier.isSelected&&result.push(modifier.data.token),result},[]))},[]),note:entry.name||""}}),ticket_token:self.model.orderTicket.token,seat_token:self._ChatModel.giftSeat,options:options};return new Promise(function(resolve,reject){self._DtsApi.waiter.placeOrder(request).then(function(response){if(response.item_tokens)for(var i=0;i<response.item_tokens.length;i++)self.model.orderCart[i].request=response.item_tokens[i];self.model.orderTicket={token:response.ticket_token},self.model.orderCheck=self.model.orderCheck.concat(self.model.orderCart),self.clearCart(),self._ChatModel.giftSeat=null;var watcher=self._createWatcher(self.model.REQUEST_KIND_ORDER,response);resolve(watcher)},reject)})}}},{key:"requestCloseout",value:function(){var self=this,request={kind:this.model.REQUEST_KIND_CLOSEOUT,ticket_token:this.model.orderTicket.token};return this._DtsApi.waiter.placeRequest(request).then(function(response){return self.model.orderTicket={token:response.ticket_token},self._createWatcher(self.model.REQUEST_KIND_CLOSEOUT,response)})}},{key:"requestAssistance",value:function(){var self=this,request={kind:this.model.REQUEST_KIND_ASSISTANCE,ticket_token:this.model.orderTicket.token};return this._DtsApi.waiter.placeRequest(request).then(function(response){return self._saveTicket(response),self._createWatcher(self.model.REQUEST_KIND_ASSISTANCE,response)})}},{key:"calculatePrice",value:function(entry){var modifiers=entry.modifiers.reduce(function(total,category){return total+category.modifiers.reduce(function(total,modifier){return total+(modifier.isSelected&&modifier.data.price>0?modifier.data.price:0)},0)},0);return entry.quantity*(modifiers+entry.item.order.price)}},{key:"calculateTotalPrice",value:function(entries){return entries?entries.reduce(function(total,entry){return total+OrderManager.prototype.calculatePrice(entry)},0):0}},{key:"calculateTax",value:function(entries){return this.calculateTotalPrice(entries)*this.model.tax}},{key:"uploadSignature",value:function(data){return this._DtsApi.upload.uploadTemp(data,"image/png","signature.png").then(function(response){return response.token})}},{key:"generatePaymentToken",value:function(){var self=this;return this._CustomerModel.isAuthenticated&&!this._CustomerModel.isGuest?this._DtsApi.customer.initializePayment().then(function(response){self._savePaymentToken(response)}):this._DtsApi.waiter.initializePayment().then(function(response){self._savePaymentToken(response)})}},{key:"payOrder",value:function(request){return request.ticket_token=this.model.orderTicket.token,request.payment_token=this.model.orderTicket.payment_token,this._DtsApi.waiter.submitCheckoutPayment(request)}},{key:"requestReceipt",value:function(request){return request.ticket_token=this.model.orderTicket.token,this._DtsApi.waiter.requestReceipt(request)}},{key:"_saveTicket",value:function(response){this.model.orderTicket={token:response.ticket_token,payment_token:this.model.orderTicket.payment_token}}},{key:"_savePaymentToken",value:function(response){this.model.orderTicket={token:this.model.orderTicket.token,payment_token:response.token}}},{key:"_createWatcher",value:function(kind,ticket){var watcher=new app.RequestWatcher(ticket,this._DtsApi);return this.model.addWatcher(kind,watcher),watcher}},{key:"model",get:function(){return this._OrderModel}}]),OrderManager}(),window.app.OrderModel=function(){function OrderModel(storageProvider){function prepareCartData(items){return items}function restoreCartData(items){return items.map?items.map(app.CartItem.prototype.restore):[]}_classCallCheck(this,OrderModel);var self=this;this.REQUEST_KIND_ORDER=1,this.REQUEST_KIND_ASSISTANCE=2,this.REQUEST_KIND_CLOSEOUT=3,this.priceFormat="{0}",this.tax=0,this._orderCart=[],this._orderCartStash=[],this._orderCheck=[],this._orderTicket={},this._requestWatchers={},this.orderCartChanged=new signals.Signal,this.orderCartStashChanged=new signals.Signal,this.orderCheckChanged=new signals.Signal,this.orderTicketChanged=new signals.Signal,this.orderRequestChanged=new signals.Signal,this.assistanceRequestChanged=new signals.Signal,this.closeoutRequestChanged=new signals.Signal,this._orderCartStorage=storageProvider("snap_order_cart"),this._orderCartStorage.read().then(function(value){self.orderCart=restoreCartData(value||[]),self.orderCartChanged.dispatch(self.orderCart),self.orderCartChanged.add(function(items){self._orderCartStorage.write(prepareCartData(items))})}),this._orderCartStashStorage=storageProvider("snap_order_cart_stash"),this._orderCartStashStorage.read().then(function(value){self.orderCartStash=restoreCartData(value||[]),self.orderCartStashChanged.dispatch(self.orderCartStash),self.orderCartStashChanged.add(function(items){self._orderCartStashStorage.write(prepareCartData(items))})}),this._orderCheckStorage=storageProvider("snap_order_check"),this._orderCheckStorage.read().then(function(value){self.orderCheck=restoreCartData(value||[]),self.orderCheckChanged.dispatch(self.orderCheck),self.orderCheckChanged.add(function(items){self._orderCheckStorage.write(prepareCartData(items))})}),this._orderTicketStorage=storageProvider("snap_order_ticket"),this._orderTicketStorage.read().then(function(value){self.orderTicket=value||{},self.orderTicketChanged.dispatch(self.orderTicket),self.orderTicketChanged.add(function(data){self._orderTicketStorage.write(data)})})}return _createClass(OrderModel,[{key:"getWatcher",value:function(kind){return this._requestWatchers[kind]}},{key:"addWatcher",value:function(kind,watcher){this.clearWatcher(kind);var self=this;watcher.promise.then(function(){self.getWatcher(kind)===watcher&&self.clearWatcher(kind)}),this._requestWatchers[kind]=watcher,this._notifyChange(kind)}},{key:"clearWatcher",value:function(kind){var watcher=this.getWatcher(kind);watcher&&watcher.dispose(),delete this._requestWatchers[kind],this._notifyChange(kind)}},{key:"_notifyChange",value:function(kind){var signal;switch(kind){case this.REQUEST_KIND_ORDER:signal=this.orderRequestChanged;break;case this.REQUEST_KIND_ASSISTANCE:signal=this.assistanceRequestChanged;break;case this.REQUEST_KIND_CLOSEOUT:signal=this.closeoutRequestChanged}signal&&signal.dispatch(this.getWatcher(kind))}},{key:"orderCart",get:function(){return this._orderCart},set:function(value){this._orderCart=value||[],this.orderCartChanged.dispatch(this.orderCart)}},{key:"orderCartStash",get:function(){return this._orderCartStash},set:function(value){this._orderCartStash=value||[],this.orderCartStashChanged.dispatch(this.orderCartStash)}},{key:"orderCheck",get:function(){return this._orderCheck},set:function(value){this._orderCheck=value||[],this.orderCheckChanged.dispatch(this.orderCheck)}},{key:"orderTicket",get:function(){return this._orderTicket},set:function(value){this._orderTicket=value||{},this.orderTicketChanged.dispatch(this.orderTicket)}},{key:"orderRequest",get:function(){return this.getWatcher(this.REQUEST_KIND_ORDER)}},{key:"assistanceRequest",get:function(){return this.getWatcher(this.REQUEST_KIND_ASSISTANCE)}},{key:"closeoutRequest",get:function(){return this.getWatcher(this.REQUEST_KIND_CLOSEOUT)}}]),OrderModel}(),window.app.RequestWatcher=function(){function RequestWatcher(ticket,DtsApi){_classCallCheck(this,RequestWatcher),this._token=ticket.token,this._remote=DtsApi,this.POLLING_INTERVAL=5e3,this.REQUEST_STATUS_PENDING=1,this.REQUEST_STATUS_RECEIVED=2,this.REQUEST_STATUS_ACCEPTED=3,this.REQUEST_STATUS_EXPIRED=255;var self=this;this._promise=new Promise(function(resolve,reject){self._statusUpdateResolve=resolve,self._statusUpdateReject=reject}),this._ticket={status:0},this._watchStatus()}return _createClass(RequestWatcher,[{key:"dispose",value:function(){this._timeoutId&&window.clearTimeout(this._timeoutId),this._ticket.status<this.REQUEST_STATUS_ACCEPTED&&this._statusUpdateReject()}},{key:"_watchStatus",value:function(){var self=this;self._timeoutId&&window.clearTimeout(self._timeoutId);var onTimeout=function(){self._remote.waiter.getStatus(self._token).then(function(response){self._setTicket(response),self._watchStatus()},function(){self._watchStatus()})};self._ticket.status===self.REQUEST_STATUS_ACCEPTED?self._statusUpdateResolve():self._ticket.status!==self.REQUEST_STATUS_EXPIRED&&(self._timeoutId=window.setTimeout(onTimeout,this.POLLING_INTERVAL))}},{key:"_setTicket",value:function(value){var self=this;self._ticket.status!==value.status&&(self._ticket=value,self._watchStatus())}},{key:"token",get:function(){return this._token}},{key:"ticket",get:function(){return this._ticket}},{key:"promise",get:function(){return this._promise}}]),RequestWatcher}(),window.app.SessionManager=function(){function SessionManager(SNAPEnvironment,AnalyticsModel,CustomerModel,LocationModel,OrderModel,SurveyModel,storageProvider,Logger){var _this=this;_classCallCheck(this,SessionManager);var self=this;this.sessionStarted=new signals.Signal,this.sessionEnded=new signals.Signal,this._SNAPEnvironment=SNAPEnvironment,this._AnalyticsModel=AnalyticsModel,this._CustomerModel=CustomerModel,this._LocationModel=LocationModel,this._OrderModel=OrderModel,this._SurveyModel=SurveyModel,this._Logger=Logger,this._store=storageProvider("snap_seat_session"),this._store.read().then(function(data){self._session=data,data||self._startSession()}),this._CustomerModel.profileChanged.add(function(customer){self._session&&customer&&(self._session.customer=customer.token,self._store.write(_this._session))}),this._LocationModel.seatChanged.add(function(seat){self._session&&seat&&(self._session.seat=seat.token,self._store.write(_this._session))}),this._OrderModel.orderTicketChanged.add(function(ticket){self._session&&ticket&&ticket.token&&(self._session.ticket=ticket.token,self._store.write(_this._session))})}return _createClass(SessionManager,[{key:"endSession",value:function(){if(this._session){this._Logger.debug("Seat session "+this._session.id+" ended.");var s=this._session;s.ended=new Date,this._session=null,this._store.clear(),this._AnalyticsModel.logSession(s),this.sessionEnded.dispatch(s)}}},{key:"_startSession",value:function(){var seat=this._LocationModel.seat;this._session={id:this._generateID(),seat:seat?seat.token:void 0,platform:this._SNAPEnvironment.platform,started:new Date},this._Logger.debug("Seat session "+this._session.id+" started."),this._store.write(this._session),this.sessionStarted.dispatch(this._session)}},{key:"_generateID",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"===c?r:3&r|8;return v.toString(16)})}},{key:"session",get:function(){return this._session}},{key:"guestCount",get:function(){return this._session.guest_count||1},set:function(value){this._session.guest_count!==value&&(this._session.guest_count=value,this._store.write(this._session))}},{key:"specialEvent",get:function(){return this._session.special_event},set:function(value){this._session.special_event!==value&&(this._session.special_event=value,this._store.write(this._session))}}]),SessionManager}(),window.app.SessionProvider=function(){function SessionProvider(SessionService,storageProvider){_classCallCheck(this,SessionProvider),this._SessionService=SessionService,this._BusinessSessionStore=storageProvider("snap_accesstoken"),this._CustomerSessionStore=storageProvider("snap_customer_accesstoken"),this.businessSessionExpired=new signals.Signal,this.customerSessionExpired=new signals.Signal,this._businessToken=null;var self=this;this._BusinessSessionStore.read().then(function(token){if(token&&token.access_token)if(token.expires){var expires=moment.unix(token.expires);expires.isAfter(moment())&&(self._businessToken=token.access_token)}else self._businessToken=token.access_token})}return _createClass(SessionProvider,[{key:"getBusinessToken",value:function(){if(this._pendingPromise)return this._pendingPromise;var self=this;return this._pendingPromise=new Promise(function(resolve,reject){self._BusinessSessionStore.read().then(function(token){if(token&&token.access_token){if(!token.expires)return self._pendingPromise=null,resolve(token.access_token);var expires=moment.unix(token.expires-120);if(expires.isAfter(moment()))return self._pendingPromise=null,resolve(token.access_token)}self._SessionService.getSession().then(function(data){self._pendingPromise=null,self._BusinessSessionStore.write(data),resolve(data.access_token)},function(e){self._pendingPromise=null,401===e.status&&(self._BusinessSessionStore.clear(),self.businessSessionExpired.dispatch()),reject({code:e.status})})})}),this._pendingPromise}},{key:"getCustomerToken",value:function(){var self=this;return new Promise(function(resolve,reject){self._CustomerSessionStore.read().then(function(token){if(!token||!token.access_token)return resolve();if(token.expires){var expires=moment.unix(token.expires);if(!expires.isAfter(moment()))return self._CustomerSessionStore.clear(),self.customerSessionExpired.dispatch(),resolve()}resolve(token.access_token)},reject)})}},{key:"businessToken",get:function(){var token=this._businessToken;if(token&&token.access_token&&token.expires){var expires=moment.unix(token.expires);expires.isBefore(moment())&&(this._businessToken=token=null,this.businessSessionExpired.dispatch())}return token}}]),SessionProvider}(),window.app.SessionService=function(){function SessionService($resource){_classCallCheck(this,SessionService),this._api={session:$resource("/oauth2/snap/session",{},{query:{method:"GET"}})}}return _createClass(SessionService,[{key:"getSession",value:function(){return this._api.session.query().$promise}}]),SessionService}(),window.app.ShellManager=function(){function ShellManager($sce,DataProvider,ShellModel,Config,Environment,Hosts){_classCallCheck(this,ShellManager),this.$$sce=$sce,this._DataProvider=DataProvider,this._ShellModel=ShellModel,this._Config=Config,this._Environment=Environment,this._Hosts=Hosts,this.locale=Config.locale}return _createClass(ShellManager,[{key:"initialize",value:function(){var self=this;
this._DataProvider.backgrounds().then(function(response){self._ShellModel.backgrounds=response.main.map(function(item){return{media:item.src}}),self._ShellModel.screensavers=response.screensaver.map(function(item){return{media:item.src}}),self._ShellModel.pageBackgrounds=response.pages.map(function(item){return{media:item.background.src,destination:item.destination}})}),this._DataProvider.elements().then(function(response){var layout=self._Config.theme.layout,elements={};switch(layout){case"classic":elements={button_home:self.getAssetUrl("images/button-home.png"),button_back:self.getAssetUrl("images/button-back.png"),button_cart:self.getAssetUrl("images/button-cart.png"),button_rotate:self.getAssetUrl("images/button-rotate.png"),button_waiter:self.getAssetUrl("images/button-assistance.png"),button_check:self.getAssetUrl("images/button-closeout.png"),button_survey:self.getAssetUrl("images/button-survey.png"),button_chat:self.getAssetUrl("images/button-chat.png")};break;case"galaxies":elements={button_back:self.getAssetUrl("images/button-back.png"),button_rotate:self.getAssetUrl("images/button-rotate.png"),button_settings:self.getAssetUrl("images/button-settings.png"),location_logo:self.getAssetUrl("images/button-logo.png")}}for(var i=0;i<response.elements.length;i++){var element=response.elements[i];elements[element.slot]=element.src}self._ShellModel.elements=elements})}},{key:"formatPrice",value:function(price){return this._ShellModel.priceFormat.replace(/{(\d+)}/g,function(){return price.toFixed(2)})}},{key:"getPageBackgrounds",value:function(location){return this._ShellModel.pageBackgrounds.filter(function(item){return item.destination.type===location.type&&(item.destination.token===location.token&&location.token||item.destination.url===location.url&&location.url)})}},{key:"getAssetUrl",value:function(file){var host=this._Hosts["static"].host?"//"+this._Hosts["static"].host+this._Hosts["static"].path:"";return this.$$sce.trustAsResourceUrl(host+"/assets/"+this._Config.theme.layout+"/"+file)}},{key:"getPartialUrl",value:function(name){return this.getAssetUrl("partials/"+name+".html")}},{key:"getMediaUrl",value:function(media,width,height,extension){if(!media)return null;if("string"==typeof media||media instanceof String)return"http"!==media.substring(0,4)&&"//"!==media.substring(0,2)?(extension=extension||"jpg",this.$$sce.trustAsResourceUrl(window.location.protocol+"//"+this._Hosts.media.host+("/media/"+media+"_"+width+"_"+height+"."+extension))):media;if(!media.token)return media;var type=this.getMediaType(media),url=window.location.protocol+"//"+this._Hosts.media.host+"/media/"+media.token;if(!type)return null;if("video"===type)url+=".webm";else if("flash"===type)url+=".swf";else if("image"===type)if(width&&height&&(url+="_"+width+"_"+height),extension)url+="."+extension;else{if(!media||!media.mime_type)return void 0;switch(media.mime_type){case"image/png":url+=".png";break;default:url+=".jpg"}}return this.$$sce.trustAsResourceUrl(url)}},{key:"getMediaType",value:function(media){return media&&media.mime_type?"image"===media.mime_type.substring(0,5)?"image":"video"===media.mime_type.substring(0,5)?"video":"application/x-shockwave-flash"===media.mime_type?"flash":void 0:void 0}},{key:"locale",get:function(){return this._locale},set:function(value){if(this._locale!==value){this._locale=value;var format="{0}",currency="";switch(this._locale){case"ro_MD":format="{0} Lei",currency="";break;case"zh_MO":format="MOP$ {0}",currency="";break;case"en_US":format="${0}",currency="USD"}this._ShellModel.priceFormat=format,this._ShellModel.currency=currency}}},{key:"model",get:function(){return this._ShellModel}},{key:"tileStyle",get:function(){var style="tile";switch(this._Config.theme.tiles_style){case"regular":style+=" tile-regular"}return style}},{key:"predicateEven",get:function(){var index=0;return function(){return index++%2===1}}},{key:"predicateOdd",get:function(){var index=0;return function(){return index++%2===0}}}]),ShellManager}(),window.app.ShellModel=function(){function ShellModel(){_classCallCheck(this,ShellModel),this._backgrounds=[],this.backgroundsChanged=new signals.Signal,this._screensavers=[],this.screensaversChanged=new signals.Signal,this._pageBackgrounds=[],this.pageBackgroundsChanged=new signals.Signal,this._elements=[],this.elementsChanged=new signals.Signal,this._priceFormat="{0}",this.priceFormatChanged=new signals.Signal,this._currency="",this.currencyChanged=new signals.Signal}return _createClass(ShellModel,[{key:"backgrounds",get:function(){return this._backgrounds},set:function(value){this._backgrounds=value,this.backgroundsChanged.dispatch(value)}},{key:"screensavers",get:function(){return this._screensavers},set:function(value){this._screensavers=value,this.screensaversChanged.dispatch(value)}},{key:"pageBackgrounds",get:function(){return this._pageBackgrounds},set:function(value){this._pageBackgrounds=value,this.pageBackgroundsChanged.dispatch(value)}},{key:"elements",get:function(){return this._elements},set:function(value){this._elements=value,this.elementsChanged.dispatch(value)}},{key:"priceFormat",get:function(){return this._priceFormat},set:function(value){this._priceFormat=value,this.priceFormatChanged.dispatch(value)}},{key:"currency",get:function(){return this._currency},set:function(value){this._currency=value,this.currencyChanged.dispatch(value)}}]),ShellModel}(),function(){var SocialManager=function(SNAPEnvironment,DtsApi,WebBrowser,Logger){this._SNAPEnvironment=SNAPEnvironment,this._DtsApi=DtsApi,this._WebBrowser=WebBrowser,this._Logger=Logger};window.app.SocialManager=SocialManager,SocialManager.prototype.loginFacebook=function(){var self=this,facebookApp=this._SNAPEnvironment.facebook_application,customerApp=this._SNAPEnvironment.customer_application;return new Promise(function(resolve,reject){function dispose(){self._WebBrowser.onNavigated.remove(onNavigated),self._WebBrowser.close()}function onNavigated(url){if(0===url.indexOf(facebookApp.redirect_url)){var facebookAuth=URI("?"+URI(url).fragment()).search(!0);if(facebookAuth.error||!facebookAuth.access_token)return self._Logger.debug("Facebook callback error: "+facebookAuth.error),reject(facebookAuth.error);self._Logger.debug("Facebook callback received."),self._DtsApi.customer.signUpFacebook({access_token:facebookAuth.access_token,client_id:customerApp.client_id}).then(function(ticket){self._Logger.debug("Facebook signin complete.");var url=self._DtsApi.oauth2.getAuthConfirmUrl(ticket.ticket_id,{client_id:customerApp.client_id,response_type:"token",redirect_uri:customerApp.callback_url});self._WebBrowser.open(url)},reject)}else if(0===url.indexOf(customerApp.callback_url)){var customerAuth=URI("?"+URI(url).fragment()).search(!0);if(customerAuth.error||!customerAuth.access_token)return self._Logger.debug("Facebook customer callback error: "+customerAuth.error),reject(customerAuth.error);self._Logger.debug("Facebook customer login complete."),resolve(customerAuth)}}var _reject=reject,_resolve=resolve;reject=function(e){self._Logger.debug("Unable to login with Facebook: "+e),dispose(),_reject(e)},resolve=function(data){self._Logger.debug("Facebook login complete."),dispose(),_resolve(data)},self._WebBrowser.onNavigated.add(onNavigated),self._Logger.debug("Logging in with Facebook.");var url=URI("https://www.facebook.com/dialog/oauth").addSearch("client_id",facebookApp.client_id).addSearch("redirect_uri",facebookApp.redirect_url).addSearch("response_type","token").addSearch("scope","public_profile,email").toString();self._WebBrowser.open(url)})},SocialManager.prototype.loginGooglePlus=function(){var self=this,googleplusApp=this._SNAPEnvironment.googleplus_application,customerApp=this._SNAPEnvironment.customer_application;return new Promise(function(resolve,reject){function dispose(){self._WebBrowser.onNavigated.remove(onNavigated),self._WebBrowser.close()}function onNavigated(url){if(0===url.indexOf(googleplusApp.redirect_url)){var googleplusAuth=URI(url).search(!0);if(googleplusAuth.error||!googleplusAuth.code||googleplusAuth.state!==state)return self._Logger.debug("Google callback error: "+googleplusAuth.error),reject(googleplusAuth.error);self._Logger.debug("Google callback received."),self._DtsApi.customer.signUpGooglePlus({code:googleplusAuth.code,client_id:customerApp.client_id}).then(function(ticket){self._Logger.debug("Google signin complete.");var url=self._DtsApi.oauth2.getAuthConfirmUrl(ticket.ticket_id,{client_id:customerApp.client_id,response_type:"token",redirect_uri:customerApp.callback_url});self._WebBrowser.open(url)},reject)}else if(0===url.indexOf(customerApp.callback_url)){var customerAuth=URI("?"+URI(url).fragment()).search(!0);if(customerAuth.error||!customerAuth.access_token)return self._Logger.debug("Google customer callback error: "+customerAuth.error),reject(customerAuth.error);self._Logger.debug("Google customer login complete."),resolve(customerAuth)}}var state=self._generateToken(),_reject=reject,_resolve=resolve;reject=function(e){self._Logger.debug("Unable to login with Google: "+e),dispose(),_reject(e)},resolve=function(data){self._Logger.debug("Google login complete."),dispose(),_resolve(data)},self._WebBrowser.onNavigated.add(onNavigated),self._Logger.debug("Logging in with Google.");var url=URI("https://accounts.google.com/o/oauth2/auth").addSearch("client_id",googleplusApp.client_id).addSearch("redirect_uri",googleplusApp.redirect_url).addSearch("response_type","code").addSearch("scope","https://www.googleapis.com/auth/plus.login email").addSearch("access_type","offline").addSearch("state",state).toString();self._WebBrowser.open(url)})},SocialManager.prototype.loginTwitter=function(){var self=this,twitterApp=this._SNAPEnvironment.twitter_application,customerApp=this._SNAPEnvironment.customer_application;return new Promise(function(resolve,reject){function dispose(){self._WebBrowser.onNavigated.remove(onNavigated),self._WebBrowser.close()}function onNavigated(url){if(0===url.indexOf(twitterApp.redirect_url)){var twitterAuth=URI(url).search(!0);if(twitterAuth.error||!twitterAuth.oauth_verifier)return self._Logger.debug("Twitter callback error: "+twitterAuth.error),reject(twitterAuth.error);self._Logger.debug("Twitter callback received."),self._DtsApi.customer.signUpTwitter({client_id:customerApp.client_id,request_token:twitterAuth.oauth_token,request_token_secret:tokenSecret,request_token_verifier:twitterAuth.oauth_verifier}).then(function(ticket){self._Logger.debug("Twitter signin complete.");var url=self._DtsApi.oauth2.getAuthConfirmUrl(ticket.ticket_id,{client_id:customerApp.client_id,response_type:"token",redirect_uri:customerApp.callback_url});self._WebBrowser.open(url)},reject)}else if(0===url.indexOf(customerApp.callback_url)){var customerAuth=URI("?"+URI(url).fragment()).search(!0);if(customerAuth.error||!customerAuth.access_token)return self._Logger.debug("Twitter customer callback error: "+customerAuth.error),reject(customerAuth.error);self._Logger.debug("Twitter customer login complete."),resolve(customerAuth)}}var tokenSecret,_reject=reject,_resolve=resolve;reject=function(e){self._Logger.debug("Unable to login with Twitter: "+e),dispose(),_reject(e)},resolve=function(data){self._Logger.debug("Twitter login complete."),dispose(),_resolve(data)},self._WebBrowser.onNavigated.add(onNavigated),self._Logger.debug("Logging in with Twitter."),self._DtsApi.customer.signUpTwitterRequestToken({oauth_callback:twitterApp.redirect_url}).then(function(token){var url=URI("https://api.twitter.com/oauth/authenticate").addSearch("oauth_token",token.oauth_token).addSearch("force_login","true").toString();self._Logger.debug("Twitter request token received."),tokenSecret=token.oauth_token_secret,self._WebBrowser.open(url)},reject)})},SocialManager.prototype._generateToken=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"===c?r:3&r|8;return v.toString(16)})}}(),window.app.SocketClient=function(){function SocketClient(SessionProvider,Logger){_classCallCheck(this,SocketClient);var self=this;this._SessionProvider=SessionProvider,this._Logger=Logger,this.isConnectedChanged=new signals.Signal,this._channels={},this._isConnected=!1,this._socket=socketCluster.connect({path:"/sockets/",port:8080}),this._socket.on("connect",function(status){self._Logger.debug("Socket connected."),self._authenticate()}),this._socket.on("disconnect",function(){self._Logger.debug("Socket disconnected."),self._isConnected=!1,self.isConnectedChanged.dispatch(self.isConnected)})}return _createClass(SocketClient,[{key:"subscribe",value:function(topic,handler){this._getChannel(topic).watch(handler)}},{key:"send",value:function(topic,data){this._getChannel(topic).publish(data)}},{key:"_getChannel",value:function(topic){return this._channels[topic]||(this._channels[topic]=this._socket.subscribe(topic))}},{key:"_authenticate",value:function(){var self=this;this._SessionProvider.getBusinessToken().then(function(token){self._socket.emit("authenticate",{access_token:token},function(err){return err?void self._Logger.warn("Unable to authenticate socket: "+err.message):(self._isConnected=!0,void self.isConnectedChanged.dispatch(self.isConnected))})},function(e){self._Logger.warn("Unable to perform socket authentication: "+e.message)})}},{key:"isConnected",get:function(){return this._isConnected}}]),SocketClient}(),function(){var SoftwareManager=function(SNAPEnvironment){this._SNAPEnvironment=SNAPEnvironment};window.app.SoftwareManager=SoftwareManager,Object.defineProperty(SoftwareManager.prototype,"currentVersion",{get:function(){var pattern=/(SNAP)\/([0-9.]+)/,match=pattern.exec(navigator.userAgent);return match?match[1]:"8.8.8.8"}}),Object.defineProperty(SoftwareManager.prototype,"requiredVersion",{get:function(){return this._SNAPEnvironment.requirements[this._SNAPEnvironment.platform]}}),Object.defineProperty(SoftwareManager.prototype,"updateRequired",{get:function(){return-1===this._versionCompare(this.currentVersion,this.requiredVersion)}}),SoftwareManager.prototype._versionCompare=function(v1,v2,options){function isValidPart(x){return(lexicographical?/^\d+[A-Za-z]*$/:/^\d+$/).test(x)}if(!v1||!v2)return 0;var lexicographical=options&&options.lexicographical,zeroExtend=options&&options.zeroExtend,v1parts=v1.split("."),v2parts=v2.split(".");if(!v1parts.every(isValidPart)||!v2parts.every(isValidPart))return NaN;if(zeroExtend){for(;v1parts.length<v2parts.length;)v1parts.push("0");for(;v2parts.length<v1parts.length;)v2parts.push("0")}lexicographical||(v1parts=v1parts.map(Number),v2parts=v2parts.map(Number));for(var i=0;i<v1parts.length;++i){if(v2parts.length===i)return 1;if(v1parts[i]!==v2parts[i])return v1parts[i]>v2parts[i]?1:-1}return v1parts.length!==v2parts.length?-1:0}}(),function(){var Store=function(){this._storage=null};window.app.Store=Store,Store.prototype.clear=function(){return this._storage=null,Promise.resolve()},Store.prototype.read=function(){var self=this;return new Promise(function(resolve,reject){resolve(self._storage)})},Store.prototype.write=function(value){var self=this;return new Promise(function(resolve,reject){self._storage=value,resolve()})}}(),function(){var LocalStorageStore=function(id){app.Store.call(this),this._id=id};LocalStorageStore.prototype=Object.create(app.Store.prototype),LocalStorageStore.prototype.clear=function(){return store.remove(this._id),Promise.resolve()},LocalStorageStore.prototype.read=function(){return Promise.resolve(store.get(this._id))},LocalStorageStore.prototype.write=function(value){return store.set(this._id,value),Promise.resolve()},window.app.LocalStorageStore=LocalStorageStore}(),window.app.SurveyManager=function(){function SurveyManager(DataProvider,SurveyModel){_classCallCheck(this,SurveyManager);var self=this;this._DataProvider=DataProvider,this._SurveyModel=SurveyModel,this._SurveyModel.isEnabled&&this._DataProvider.surveys().then(function(data){self._SurveyModel.feedbackSurvey=data.surveys[0]})}return _createClass(SurveyManager,[{key:"reset",value:function(){var self=this;return new Promise(function(resolve,reject){self._SurveyModel.isEnabled&&(self._SurveyModel.feedbackSurveyComplete=!1),resolve()})}},{key:"model",get:function(){return this._SurveyModel}}]),SurveyManager}(),window.app.SurveyModel=function(){function SurveyModel(Config,storageProvider){_classCallCheck(this,SurveyModel);var self=this;this._isEnabled=Boolean(Config.surveys),this._surveys={},this._store=storageProvider("snap_survey"),this._feedbackSurvey=null,this.feedbackSurveyChanged=new signals.Signal,this.surveyCompleted=new signals.Signal,this._store.read().then(function(value){self._surveys=value||self._surveys})}return _createClass(SurveyModel,[{key:"isEnabled",get:function(){return Boolean(this._isEnabled)}},{key:"feedbackSurvey",get:function(){return this._feedbackSurvey},set:function(value){this._feedbackSurvey=value,this.feedbackSurveyChanged.dispatch(this._feedbackSurvey)}},{key:"feedbackSurveyComplete",get:function(){return Boolean(this._surveys.feedback)},set:function(value){this._surveys.feedback=Boolean(value),this._store.write(this._surveys),this.surveyCompleted.dispatch(this.feedbackSurvey)}}]),SurveyModel}(),window.app.TelemetryService=function(){function TelemetryService($resource){_classCallCheck(this,TelemetryService),this._api={submitTelemetry:$resource("/snap/telemetry",{},{query:{method:"POST"}}),submitLogs:$resource("/snap/logs",{},{query:{method:"POST"}})}}return _createClass(TelemetryService,[{key:"submitTelemetry",value:function(data){return this._api.submitTelemetry.query(data).$promise}},{key:"submitLogs",value:function(data){return this._api.submitLogs.query(data).$promise}}]),TelemetryService}(),window.app.WebBrowser=function(){function WebBrowser($window,AnalyticsModel,ManagementService,SNAPEnvironment,SNAPHosts){_classCallCheck(this,WebBrowser),this.$$window=$window,this._AnalyticsModel=AnalyticsModel,this._ManagementService=ManagementService,this._SNAPEnvironment=SNAPEnvironment,this._localHosts=Object.keys(SNAPHosts).map(function(p){return SNAPHosts[p].host}),this._localHosts.push("localhost"),this.onOpen=new signals.Signal,this.onClose=new signals.Signal,this.onNavigated=new signals.Signal}return _createClass(WebBrowser,[{key:"navigated",value:function(url){this.onNavigated.dispatch(url);var host=URI(url).hostname();-1===this._localHosts.indexOf(host)&&this._AnalyticsModel.logUrl(url)}},{key:"open",value:function(url){this.isExternal&&this._ManagementService.openBrowser(url),this.onOpen.dispatch(url),this._browserOpened=!0}},{key:"close",value:function(){this._browserOpened&&(this.isExternal&&this._ManagementService.closeBrowser(),this.onClose.dispatch(),this._browserOpened=!1)}},{key:"getAppUrl",value:function(url){var host=this.$$window.location.protocol+"//"+this.$$window.location.hostname+(this.$$window.location.port?":"+this.$$window.location.port:"");return host+url}},{key:"isExternal",get:function(){return"web"!==this._SNAPEnvironment.platform}}]),WebBrowser}(),function(){function _staticHostRegex(SNAP_HOSTS_CONFIG){return new RegExp(".*"+SNAP_HOSTS_CONFIG["static"]+".*")}function _getPartialUrl(SNAP_CONFIG,SNAP_HOSTS_CONFIG,SNAP_ENVIRONMENT,name){var host=SNAP_HOSTS_CONFIG["static"].host?"//"+SNAP_HOSTS_CONFIG["static"].host+SNAP_HOSTS_CONFIG["static"].path:"";return host+"/assets/"+SNAP_CONFIG.theme.layout+"/partials/"+name+".html"}angular.module("SNAPApplication",["ngRoute","ngAnimate","ngTouch","ngSanitize","SNAP.configs","SNAP.controllers","SNAP.directives","SNAP.filters","SNAP.services"]).config(["$locationProvider","$routeProvider","$sceDelegateProvider","SNAPConfig","SNAPHosts","SNAPEnvironment",function($locationProvider,$routeProvider,$sceDelegateProvider,SNAPConfig,SNAPHosts,SNAPEnvironment){var getPartialUrl=function(name){return _getPartialUrl(SNAPConfig,SNAPHosts,SNAPEnvironment,name)},staticHostRegex=function(){return _staticHostRegex(SNAPHosts)};SNAPHosts["static"].host&&$sceDelegateProvider.resourceUrlWhitelist(["self",staticHostRegex()]),$locationProvider.html5Mode(!1),$routeProvider.when("/",{template:" ",controller:"HomeBaseCtrl"}),$routeProvider.when("/menu/:token",{template:" ",controller:"MenuBaseCtrl"}),$routeProvider.when("/category/:token",{template:" ",controller:"CategoryBaseCtrl"}),$routeProvider.when("/item/:token",{template:" ",controller:"ItemBaseCtrl"}),$routeProvider.when("/url/:url",{template:" ",controller:"UrlCtrl"}),$routeProvider.when("/checkout",{templateUrl:getPartialUrl("checkout"),controller:"CheckoutCtrl"}),$routeProvider.when("/signin",{templateUrl:getPartialUrl("signin"),controller:"SignInCtrl"}),$routeProvider.when("/account",{templateUrl:getPartialUrl("account"),controller:"AccountCtrl"}),$routeProvider.when("/chat",{templateUrl:getPartialUrl("chat"),controller:"ChatCtrl"}),$routeProvider.when("/chatmap",{templateUrl:getPartialUrl("chatmap"),controller:"ChatMapCtrl"}),$routeProvider.when("/survey",{templateUrl:getPartialUrl("survey"),controller:"SurveyCtrl"}),$routeProvider.otherwise({redirectTo:"/"})}]),angular.module("SNAPStartup",["ngRoute","SNAP.configs","SNAP.controllers","SNAP.directives","SNAP.filters","SNAP.services"]).config(["$locationProvider","$routeProvider","$sceDelegateProvider",function($locationProvider,$routeProvider,$sceDelegateProvider){alert("lol-app")}]),angular.module("SNAPAuxiliares",["ngRoute","ngAnimate","ngTouch","ngSanitize","SNAP.configs","SNAP.controllers","SNAP.directives","SNAP.filters","SNAP.services"]).config(["$locationProvider","$routeProvider","SNAPConfig","SNAPHosts","SNAPEnvironment",function($locationProvider,$routeProvider,SNAPConfig,SNAPHosts,SNAPEnvironment){var getPartialUrl=function(name){return _getPartialUrl(SNAPConfig,SNAPHosts,SNAPEnvironment,name)};$locationProvider.html5Mode(!1),$routeProvider.when("/",{templateUrl:getPartialUrl("chatroom"),controller:"ChatRoomCtrl"}),$routeProvider.otherwise({redirectTo:"/"})}])}(),angular.module("SNAP.controllers",["angular-bacon"]),angular.module("SNAP.controllers").controller("AccountCtrl",["$scope","CustomerManager","DialogManager","NavigationManager",function($scope,CustomerManager,DialogManager,NavigationManager){if(!CustomerManager.model.isEnabled||!CustomerManager.model.isAuthenticated)return void(NavigationManager.location={type:"home"});$scope.profile=CustomerManager.model.profile,$scope.canChangePassword=CustomerManager.model.hasCredentials;$scope.$watchAsProperty("profile");CustomerManager.model.profileChanged.add(function(value){$scope.profile=value,$scope.canChangePassword=CustomerManager.model.hasCredentials,$scope.canChangeEmail=CustomerManager.model.hasCredentials}),$scope.editProfile=function(){$scope.profileedit=angular.copy($scope.profile),$scope.showProfileEdit=!0},$scope.editPassword=function(){$scope.passwordedit={old_password:"",new_password:""},$scope.showProfileEdit=!1,$scope.showPasswordEdit=!0},$scope.editPayment=function(){$scope.showPaymentEdit=!0},$scope.profileEditSubmit=function(){var job=DialogManager.startJob();CustomerManager.updateProfile($scope.profileedit).then(function(){DialogManager.endJob(job),$scope.showProfileEdit=!1},function(e){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})},$scope.profileEditCancel=function(){$scope.showProfileEdit=!1},$scope.passwordEditSubmit=function(){var job=DialogManager.startJob();CustomerManager.changePassword($scope.passwordedit).then(function(){DialogManager.endJob(job),$scope.showPasswordEdit=!1},function(e){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})},$scope.passwordEditCancel=function(){$scope.showPasswordEdit=!1}}]),angular.module("SNAP.controllers").controller("BackgroundCtrl",["$scope","$timeout","ShellManager","NavigationManager",function($scope,$timeout,ShellManager,NavigationManager){function showImages(values){$timeout(function(){$scope.images=values.map(function(item){return{src:ShellManager.getMediaUrl(item.media,1920,1080,"jpg"),type:ShellManager.getMediaType(item.media)}})})}var backgrounds=ShellManager.model.backgrounds,pageBackgrounds=null;showImages(backgrounds),ShellManager.model.backgroundsChanged.add(function(value){backgrounds=value,showImages(backgrounds)}),NavigationManager.locationChanged.add(function(location){var newPageBackgrounds=ShellManager.getPageBackgrounds(location);if(newPageBackgrounds.length>0)return pageBackgrounds=newPageBackgrounds,void showImages(pageBackgrounds);if(pageBackgrounds)switch(location.type){case"menu":case"category":case"item":return}pageBackgrounds=null,showImages(backgrounds)})}]),angular.module("SNAP.controllers").controller("CartCtrl",["$scope","$timeout","$sce","CustomerManager","ShellManager","NavigationManager","OrderManager","DialogManager","CartModel","LocationModel","ChatManager",function($scope,$timeout,$sce,CustomerManager,ShellManager,NavigationManager,OrderManager,DialogManager,CartModel,LocationModel,ChatManager){$scope.getMediaUrl=function(media,width,height,extension){return ShellManager.getMediaUrl(media,width,height,extension)},$scope.formatPrice=function(value){return ShellManager.formatPrice(value)},$scope.options={},$scope.state=CartModel.cartState,CartModel.cartStateChanged.add(function(state){return $timeout(function(){return $scope.state=state})}),$scope.currentOrder=OrderManager.model.orderCart,OrderManager.model.orderCartChanged.add(function(value){return $scope.currentOrder=value}),$scope.totalOrder=OrderManager.model.orderCheck,OrderManager.model.orderCheckChanged.add(function(value){return $scope.totalOrder=value}),$scope.giftSeat=LocationModel.getSeat(ChatManager.model.giftSeat),ChatManager.model.giftSeatChanged.add(function(token){$timeout(function(){return $scope.giftSeat=LocationModel.getSeat(token)})}),$scope.requestAssistanceAvailable=!0,$scope.requestCloseoutAvailable=!0,$scope.checkoutEnabled=CustomerManager.model.isEnabled,$scope.toGoOrder=!1,$scope.visible=CartModel.isCartOpen,NavigationManager.locationChanging.add(function(location){"category"!==location.type&&(CartModel.isCartOpen=!1)}),CartModel.isCartOpenChanged.add(function(value){$scope.showCart(),$scope.visible=value}),$scope.seat_name=LocationModel.seat?LocationModel.seat.name:"Table",LocationModel.seatChanged.add(function(seat){return $scope.seat_name=seat?seat.name:"Table"});var refreshAssistanceRequest=function(){$scope.requestAssistanceAvailable=null==OrderManager.model.assistanceRequest},refreshCloseoutRequest=function(){$scope.requestCloseoutAvailable=null==OrderManager.model.closeoutRequest};OrderManager.model.assistanceRequestChanged.add(refreshAssistanceRequest),OrderManager.model.closeoutRequestChanged.add(refreshCloseoutRequest),refreshAssistanceRequest(),refreshCloseoutRequest(),$scope.calculateDescription=function(entry){var result=entry.name||entry.item.title;return result+=entry.modifiers.reduce(function(output,category){return output+category.modifiers.reduce(function(output,modifier){return output+(modifier.isSelected?"<br/>- "+modifier.data.title:"")},"")},""),$sce.trustAsHtml(result)},$scope.calculatePrice=function(entry){return OrderManager.calculatePrice(entry)},$scope.calculateTotalPrice=function(entries){return OrderManager.calculateTotalPrice(entries)},$scope.editItem=function(entry){return CartModel.openEditor(entry,!1)},$scope.removeFromCart=function(entry){return $scope.currentOrder=OrderManager.removeFromCart(entry)},$scope.reorderItem=function(entry){return $scope.currentOrder=OrderManager.addToCart(entry.clone())},$scope.submitCart=function(){var job=DialogManager.startJob(),options=$scope.options.to_go_order?2:0;OrderManager.submitCart(options).then(function(){DialogManager.endJob(job),$scope.$apply(function(){$scope.currentOrder=OrderManager.model.orderCart,$scope.totalOrder=OrderManager.model.orderCheck,$scope.toGoOrder=!1}),DialogManager.alert(ALERT_REQUEST_ORDER_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})},$scope.clearCart=function(){$scope.toGoOrder=!1,$scope.currentOrder=OrderManager.clearCart()},$scope.closeCart=function(){CartModel.isCartOpen=!1,$scope.showCart()},$scope.showHistory=function(){return CartModel.cartState=CartModel.STATE_HISTORY},$scope.showCart=function(){return CartModel.cartState=CartModel.STATE_CART},$scope.payCheck=function(){return NavigationManager.location={type:"checkout"}},$scope.requestAssistance=function(){$scope.requestAssistanceAvailable&&DialogManager.confirm(ALERT_TABLE_ASSISTANCE).then(function(){var job=DialogManager.startJob();OrderManager.requestAssistance().then(function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_ASSISTANCE_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})})},$scope.requestCloseout=function(){if($scope.requestCloseoutAvailable){var job=DialogManager.startJob();OrderManager.requestCloseout().then(function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_CLOSEOUT_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})}}}]),angular.module("SNAP.controllers").controller("CategoryBaseCtrl",["$scope","$timeout","DataManager","NavigationManager",function($scope,$timeout,DataManager,NavigationManager){}]),angular.module("SNAP.controllers").controller("CategoryCtrl",["$scope","$timeout","DataManager","NavigationManager","SNAPEnvironment","ShellManager",function($scope,$timeout,DataManager,NavigationManager,SNAPEnvironment,ShellManager){var CategoryList=React.createClass({displayName:"CategoryList",render:function(){var tileClassName=ShellManager.tileStyle,rows=this.props.tiles.map(function(tile,i){return React.DOM.td({className:tileClassName,key:i},React.DOM.a({onClick:function(e){e.preventDefault(),NavigationManager.location=tile.destination},style:{backgroundImage:"url("+ShellManager.getMediaUrl(tile.image,370,370)+")"}},React.DOM.span(null,tile.title)))}).reduce(function(result,value,i){return result[i%2].push(value),result},[[],[]]).map(function(row,i){return React.DOM.tr({key:i},row)});return React.DOM.table({className:"tile-table"},rows)}});NavigationManager.locationChanging.add(function(location){DataManager.category="category"===location.type?location.token:void 0,$scope.visible=Boolean(DataManager.category),$timeout(function(){$scope.$apply()})}),DataManager.categoryChanged.add(function(data){if(data){var tiles,categories=data.categories||[];tiles=data.items||[],tiles=categories.concat(tiles),"desktop"!==SNAPEnvironment.platform&&(tiles=tiles.filter(function(tile){return 3!==tile.type})),tiles.forEach(function(tile){tile.url="#"+NavigationManager.getPath(tile.destination)}),React.render(React.createElement(CategoryList,{tiles:tiles}),document.getElementById("content-category"))}})}]),angular.module("SNAP.controllers").controller("ChatCtrl",["$scope","$timeout","CustomerManager","ChatManager","DialogManager","NavigationManager","LocationModel","ShellManager","SNAPConfig",function($scope,$timeout,CustomerManager,ChatManager,DialogManager,NavigationManager,LocationModel,ShellManager,SNAPConfig){if(!SNAPConfig.chat)return void(NavigationManager.location={type:"home"});$scope.locationName=SNAPConfig.location_name,$scope.getPartialUrl=function(name){return ShellManager.getPartialUrl(name)},$scope.chatEnabled=ChatManager.model.isEnabled,ChatManager.model.isEnabledChanged.add(function(value){$timeout(function(){return $scope.chatEnabled=value})}),$scope.activeDevices=ChatManager.model.activeDevices,ChatManager.model.activeDevicesChanged.add(function(value){$timeout(function(){return $scope.activeDevices=value})}),$scope.giftSeat=LocationModel.getSeat(ChatManager.model.giftSeat),ChatManager.model.giftSeatChanged.add(function(token){$timeout(function(){return $scope.giftSeat=LocationModel.getSeat(token)})}),$scope.giftDevice=ChatManager.model.giftDevice,ChatManager.model.giftDeviceChanged.add(function(value){$timeout(function(){return $scope.giftDevice=value})}),$scope.toggleChat=function(){ChatManager.model.isEnabled=!ChatManager.model.isEnabled;
},$scope.openMap=function(){NavigationManager.location={type:"chatmap"}},$scope.getDeviceName=function(device_token){return ChatManager.getDeviceName(device_token)},$scope.getSeatNumber=function(device_token){var device=LocationModel.getDevice(device_token);for(var p in LocationModel.seats)if(LocationModel.seats[p].token===device.seat){var match=LocationModel.seats[p].name.match(/\d+/);return match?match[0]||"":""}return""},$scope.closeChat=function(device_token){DialogManager.confirm("Are you sure you would like to close the chat with "+$scope.getDeviceName(device_token)+"?").then(function(){ChatManager.declineDevice(device_token)})},$scope.getUnreadCount=function(device_token){return ChatManager.getUnreadCount(device_token)},$scope.sendGift=function(device_token){var device=LocationModel.getDevice(device_token),seat=LocationModel.getSeat(device.seat);seat&&DialogManager.confirm("Are you sure that you want to send a gift to "+seat.name+"?").then(function(){ChatManager.startGift(device_token),NavigationManager.location={type:"home"}})},$scope.cancelGift=function(){return ChatManager.endGift()},ChatManager.isPresent=!0;var watchLocation=!0;$scope.$on("$locationChangeStart",function(){watchLocation&&(ChatManager.model.isPresent=!1,watchLocation=!1)})}]),angular.module("SNAP.controllers").controller("ChatBoxCtrl",["$scope","$timeout","$attrs","ChatManager","LocationModel",function($scope,$timeout,$attrs,ChatManager,LocationModel){function showMessages(){$timeout(function(){$scope.messages=ChatManager.model.history.filter(function(message){return message.type===type&&(message.device===to_device||message.to_device===to_device)})})}var to_device=$scope.device,type=to_device?ChatManager.MESSAGE_TYPES.DEVICE:ChatManager.MESSAGE_TYPES.LOCATION;to_device?LocationModel.getDevice(to_device):null;$scope.readonly=Boolean($attrs.readonly),$scope.chat={},$scope.messages=[],$scope.chatEnabled=ChatManager.model.isEnabled,ChatManager.model.isEnabledChanged.add(function(value){$timeout(function(){return $scope.chatEnabled=value})}),$scope.isConnected=ChatManager.model.isConnected,ChatManager.model.isConnectedChanged.add(function(value){$timeout(function(){return $scope.isConnected=value})}),$scope.sendMessage=function(){if($scope.isConnected&&$scope.chat.message){var message={type:type,to_device:to_device,text:$scope.chat.message};ChatManager.sendMessage(message),$scope.chat.message=""}},$scope.getFromName=function(message){return ChatManager.getMessageName(message)},$scope.getStatusText=function(message){if(message.to_device===to_device)switch(message.status){case ChatManager.MESSAGE_STATUSES.CHAT_REQUEST:return"You have requested to chat with "+ChatManager.getDeviceName(message.to_device);case ChatManager.MESSAGE_STATUSES.CHAT_REQUEST_ACCEPTED:return"Accepted chat request";case ChatManager.MESSAGE_STATUSES.CHAT_REQUEST_DECLINED:return"Declined chat request";case ChatManager.MESSAGE_STATUSES.CHAT_CLOSED:return"Closed the chat";case ChatManager.MESSAGE_STATUSES.GIFT_REQUEST:return"Gift request sent";case ChatManager.MESSAGE_STATUSES.GIFT_REQUEST_ACCEPTED:return"Accepted a gift";case ChatManager.MESSAGE_STATUSES.GIFT_REQUEST_DECLINED:return"Declined a gift"}else if(message.device===to_device)switch(message.status){case ChatManager.MESSAGE_STATUSES.CHAT_REQUEST:return $scope.getFromName(message)+" would like to chat with you";case ChatManager.MESSAGE_STATUSES.CHAT_REQUEST_ACCEPTED:return"Accepted chat request";case ChatManager.MESSAGE_STATUSES.CHAT_REQUEST_DECLINED:return"Declined chat request";case ChatManager.MESSAGE_STATUSES.CHAT_CLOSED:return"Closed the chat";case ChatManager.MESSAGE_STATUSES.GIFT_REQUEST:return"Would like to send you a gift";case ChatManager.MESSAGE_STATUSES.GIFT_REQUEST_ACCEPTED:return"Accepted a gift";case ChatManager.MESSAGE_STATUSES.GIFT_REQUEST_DECLINED:return"Declined a gift"}},$scope.isUnread=function(message){return message.to_device===to_device?!1:ChatManager.checkIfUnread(to_device,message)},$scope.markAsRead=function(){to_device&&ChatManager.markAsRead(to_device)},$scope.onKeydown=function(keycode){13===keycode&&$timeout(function(){$scope.sendMessage()})},LocationModel.devicesChanged.add(showMessages),LocationModel.seatsChanged.add(showMessages),ChatManager.model.historyChanged.add(showMessages),showMessages()}]),angular.module("SNAP.controllers").controller("ChatMapCtrl",["$scope","$timeout","ChatManager","ShellManager","DialogManager","NavigationManager","LocationModel",function($scope,$timeout,ChatManager,ShellManager,DialogManager,NavigationManager,LocationModel){function buildMap(){LocationModel.seat&&$timeout(function(){$scope.seats=LocationModel.seats.filter(function(seat){return seat.token!==LocationModel.seat.token}).map(function(seat){var devices=LocationModel.devices.filter(function(device){return device.seat===seat.token}).map(function(device){return{token:device.token,seat:device.seat,is_available:device.is_available,username:device.username}});return{token:seat.token,name:seat.name,devices:devices,map_position_x:seat.map_position_x,map_position_y:seat.map_position_y,is_available:devices.filter(function(device){return device.is_available}).length>0}})})}$scope.seats=[],$scope.mapImage=ShellManager.model.elements.location_map,ShellManager.model.elementsChanged.add(function(){$timeout(function(){return $scope.mapImage=ShellManager.model.elements.location_map})}),LocationModel.devicesChanged.add(buildMap),LocationModel.seatsChanged.add(buildMap),LocationModel.seatChanged.add(buildMap),buildMap(),$scope.chooseSeat=function(seat){var device=seat.devices[0];if(!seat.is_available||!device){var deviceName=device&&device.username?device.username:seat.name;return void DialogManager.alert(deviceName+" is unavailable for chat")}ChatManager.approveDevice(device.token),$scope.exitMap()},$scope.exitMap=function(){NavigationManager.location={type:"chat"}}}]),angular.module("SNAP.controllers").controller("ChatRoomCtrl",["$scope","$timeout","ChatManager","NavigationManager","ShellManager","SNAPConfig",function($scope,$timeout,ChatManager,NavigationManager,ShellManager,SNAPConfig){return SNAPConfig.chat?($scope.locationName=SNAPConfig.location_name,void($scope.getPartialUrl=function(name){return ShellManager.getPartialUrl(name)})):void(NavigationManager.location={type:"home"})}]),angular.module("SNAP.controllers").controller("CheckoutCtrl",["$scope","$rootScope","$timeout","CustomerManager","OrderManager","DialogManager","NavigationManager","SessionManager","ShellManager","LocationModel","SurveyManager",function($scope,$rootScope,$timeout,CustomerManager,OrderManager,DialogManager,NavigationManager,SessionManager,ShellManager,LocationModel,SurveyManager){function startNextCheck(){$scope.current;return $scope.options.index===$scope.options.count-1?(OrderManager.clearCheck(),void(NavigationManager.location={type:SurveyManager.model.isEnabled?"survey":"home"})):void $timeout(function(){$scope.options.index++,$scope.options.step=$scope.STEP_TIPPING})}$scope.CHECK_SPLIT_NONE=0,$scope.CHECK_SPLIT_BY_ITEMS=1,$scope.CHECK_SPLIT_EVENLY=2,$scope.PAYMENT_METHOD_CARD=1,$scope.PAYMENT_METHOD_CASH=2,$scope.PAYMENT_METHOD_PAYPAL=3,$scope.RECEIPT_METHOD_NONE=0,$scope.RECEIPT_METHOD_EMAIL=1,$scope.RECEIPT_METHOD_SMS=2,$scope.RECEIPT_METHOD_PRINT=3,$scope.STEP_CHECK_SPLIT=0,$scope.STEP_PAYMENT_METHOD=1,$scope.STEP_TIPPING=2,$scope.STEP_SIGNATURE=3,$scope.STEP_RECEIPT=4,$scope.STEP_COMPLETE=5,$scope.options={},$scope.data=[{items:OrderManager.model.orderCheck}];var data=$scope.$watchAsProperty("data");data.changes().subscribe(function(value){if(value.value){var data=value.value();$scope.options.count=data.length}$scope.options.index=0}),$scope.options.guest_count_max=Math.max(SessionManager.guestCount,OrderManager.model.orderCheck.reduce(function(i,item){return i+item.quantity},0)),$scope.options.guest_count=SessionManager.guestCount,$scope.options.check_split=$scope.CHECK_SPLIT_NONE,$scope.options.index=0;var index=$scope.$watchAsProperty("options.index");Bacon.combineAsArray(index,data).subscribe(function(){$scope.current=$scope.data[$scope.options.index],CustomerManager.model.isAuthenticated&&!CustomerManager.model.isGuest&&($scope.current.receipt_phone=$scope.current.receipt_phone||CustomerManager.model.profile.phone,$scope.current.receipt_email=CustomerManager.model.hasCredentials?CustomerManager.model.profile.email:$scope.current.receipt_email),$scope.current.items&&($scope.current.subtotal=OrderManager.calculateTotalPrice($scope.current.items),$scope.current.tax=OrderManager.calculateTax($scope.current.items)),$scope.current.tip||($scope.current.tip=0)}),$scope.options.step=$scope.options.guest_count_max>1?$scope.STEP_CHECK_SPLIT:$scope.STEP_TIPPING;var step=$scope.$watchAsProperty("options.step");return step.skipDuplicates().subscribe(function(value){if(value.value){var step=value.value();step===$scope.STEP_COMPLETE&&startNextCheck()}}),$scope.options.seat=LocationModel.seat?LocationModel.seat.name:"Table",LocationModel.seatChanged.add(function(seat){$scope.options.seat=seat?seat.name:"Table"}),$scope.getPartialUrl=function(name){return ShellManager.getPartialUrl(name)},$scope.calculateTitle=function(entry){return entry.name||entry.item.title},$scope.calculatePrice=function(entry){return OrderManager.calculatePrice(entry)},$scope.calculateTotalPrice=function(entries){return OrderManager.calculateTotalPrice(entries)},$scope.formatPrice=function(value){return ShellManager.formatPrice(value||0)},CustomerManager.model.isAuthenticated?void($scope.initialized=!0):void(NavigationManager.location={type:"signin"})}]),angular.module("SNAP.controllers").controller("CheckoutMethodCtrl",["$scope","$timeout","CustomerModel","CardReader","DialogManager","OrderManager","Logger",function($scope,$timeout,CustomerModel,CardReader,DialogManager,OrderManager,Logger){function generatePaymentToken(){var job=DialogManager.startJob();OrderManager.generatePaymentToken().then(function(){DialogManager.endJob(job)},function(e){Logger.debug("Payment token generation error: "+JSON.stringify(e)),DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})}function cardDataReceived(card){$timeout(function(){OrderManager.clearCheck($scope.current.items),$scope.current.card_data=card.data,$scope.options.step=$scope.STEP_SIGNATURE})}CardReader.onReceived.add(function(data){Logger.debug("Card reader result: "+JSON.stringify(data));var card={number:data.card_number,month:data.expiration_month,year:data.expiration_year,data:data.data};CardReader.stop(),cardDataReceived(card)}),CardReader.onError.add(function(e){Logger.debug("Card reader error: "+JSON.stringify(e)),DialogManager.alert(ALERT_CARDREADER_ERROR)}),$scope.$on("$locationChangeStart",function(){CardReader.stop()}),$scope.payCard=function(){$scope.current.payment_method=$scope.PAYMENT_METHOD_CARD,CardReader.start()},$scope.payCardCancel=function(){$scope.current.payment_method=void 0,CardReader.stop()},$scope.payCash=function(){if($scope.current.payment_method=$scope.PAYMENT_METHOD_CASH,null!=OrderManager.model.closeoutRequest)return DialogManager.alert(ALERT_REQUEST_CLOSEOUT_SENT),void $timeout(function(){$scope.options.step=$scope.STEP_COMPLETE});var job=DialogManager.startJob();OrderManager.requestCloseout().then(function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_CLOSEOUT_SENT),$timeout(function(){$scope.options.step=$scope.STEP_COMPLETE})},function(e){Logger.debug("Request closeout error: "+JSON.stringify(e)),DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})},generatePaymentToken()}]),angular.module("SNAP.controllers").controller("CheckoutReceiptCtrl",["$scope","$timeout","DialogManager","OrderManager",function($scope,$timeout,DialogManager,OrderManager){function requestReceipt(){var item=$scope.current,request={checkout_token:item.checkout_token,receipt_method:item.receipt_method};item.receipt_method===$scope.RECEIPT_METHOD_EMAIL?request.receipt_email=item.receipt_email:item.receipt_method===$scope.RECEIPT_METHOD_SMS&&(request.receipt_phone=item.receipt_phone);var job=DialogManager.startJob();OrderManager.requestReceipt(request).then(function(){DialogManager.endJob(job),$timeout(function(){$scope.options.step=$scope.STEP_COMPLETE})},function(e){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})}$scope.receiptNone=function(){$scope.current.receipt_method=$scope.RECEIPT_METHOD_NONE,$scope.options.step=$scope.STEP_COMPLETE},$scope.receiptEmail=function(){$scope.current.receipt_email&&($scope.current.receipt_method=$scope.RECEIPT_METHOD_EMAIL,requestReceipt())},$scope.receiptSms=function(){$scope.current.receipt_phone&&($scope.current.receipt_phone=$scope.RECEIPT_METHOD_SMS,requestReceipt())},$scope.receiptPrint=function(){$scope.current.receipt_method=$scope.RECEIPT_METHOD_PRINT,requestReceipt()}}]),angular.module("SNAP.controllers").controller("CheckoutSignatureCtrl",["$scope","$timeout","DialogManager","OrderManager","Logger",function($scope,$timeout,DialogManager,OrderManager,Logger){function completeCheckout(){var item=$scope.current,job=DialogManager.startJob(),request={amount_subtotal:item.subtotal,amount_tax:item.tax,amount_tip:item.tip,card_data:item.card_data,signature_token:item.signature_token,order_tokens:null!=item.items?item.items.reduce(function(result,item){for(var i=0;i<item.quantity;i++)result.push(item.request);return result},[]):null};OrderManager.payOrder(request).then(function(result){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_CLOSEOUT_SENT),$timeout(function(){$scope.current.checkout_token=result.token,$scope.options.step=$scope.STEP_RECEIPT})},function(e){Logger.debug("Order payment error: "+JSON.stringify(e)),DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})}var resetSignature=function(){$timeout(function(){$scope.current.signature_token=void 0;var signature=$("#checkout-signature-input");signature.empty(),signature.jSignature("init",{color:"#000","background-color":"#fff","decor-color":"#fff",width:"100%",height:"200px"})},300)};$scope.signatureSubmit=function(){var signature=$("#checkout-signature-input");if(0!==signature.jSignature("getData","native").length){var job=DialogManager.startJob(),sig=signature.jSignature("getData","image");OrderManager.uploadSignature(sig[1]).then(function(token){DialogManager.endJob(job),$timeout(function(){$scope.current.signature_token=token,completeCheckout()})},function(e){Logger.debug("Signature upload error: "+JSON.stringify(e)),DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})}},$scope.signatureCancel=function(){resetSignature()};var step=$scope.$watchAsProperty("options.step");step.skipDuplicates().subscribe(function(value){value.value&&value.value()===$scope.STEP_SIGNATURE&&resetSignature()})}]),angular.module("SNAP.controllers").controller("CheckoutSplitCtrl",["$scope","$timeout","OrderManager",function($scope,$timeout,OrderManager){$scope.splitCheck=function(type){var i,data=[];if(type===$scope.CHECK_SPLIT_NONE)data.push({items:OrderManager.model.orderCheck}),$scope.options.step=$scope.STEP_TIPPING;else if(type===$scope.CHECK_SPLIT_EVENLY){var check=OrderManager.model.orderCheck,subtotal=OrderManager.calculateTotalPrice(check),tax=OrderManager.calculateTax(check);for(i=0;i<$scope.options.guest_count;i++)data.push({subtotal:Math.round(subtotal/$scope.options.guest_count*100)/100,tax:Math.round(tax/$scope.options.guest_count*100)/100});$scope.options.step=$scope.STEP_TIPPING}else if(type===$scope.CHECK_SPLIT_BY_ITEMS){for(i=0;i<$scope.options.guest_count;i++)data.push({items:[]});$scope.split_items=OrderManager.model.orderCheck.slice(0).map(function(item){return item.clone()})}$scope.$parent.data=data,$scope.options.check_split=type},$scope.addToCheck=function(entry){$scope.split_items=$scope.split_items.map(function(item){return item.request!==entry.request?item:item.quantity>1?(item.quantity--,item.clone()):null}).filter(function(item){return null!=item});var exists=!1;if($scope.current.items=$scope.current.items.map(function(item){return item.request===entry.request?(exists=!0,item.quantity++,item.clone()):item}),!exists){var clone=entry.clone();clone.quantity=1,$scope.current.items.push(clone)}},$scope.removeFromCheck=function(entry){$scope.current.items=$scope.current.items.map(function(item){return item.request!==entry.request?item:item.quantity>1?(item.quantity--,item.clone()):null}).filter(function(item){return null!=item});var exists=!1;if($scope.split_items=$scope.split_items.map(function(item){return item.request===entry.request?(exists=!0,item.quantity++,item.clone()):item}),!exists){var clone=entry.clone();clone.quantity=1,$scope.split_items.push(clone)}},$scope.addAllToCheck=function(){$scope.split_items.forEach($scope.addToCheck),$scope.split_items.forEach(function(item){$scope.current.items.forEach(function(newitem){newitem.request===item.request&&(newitem.quantity+=item.quantity)})}),$scope.split_items=[]},$scope.removeAllFromCheck=function(){$scope.current.items.forEach($scope.removeFromCheck),$scope.current.items.forEach(function(item){$scope.split_items.forEach(function(newitem){newitem.request===item.request&&(newitem.quantity+=item.quantity)})}),$scope.current.items=[]},$scope.splitNextCheck=function(){return $scope.options.index<$scope.options.count-1&&$scope.split_items.length>0?void $scope.options.index++:($scope.split_items.length>0&&$scope.addAllToCheck(),void $timeout(function(){$scope.$parent.data=$scope.$parent.data.filter(function(check){return check.items.length>0}),$scope.options.step=$scope.STEP_TIPPING}))};var step=$scope.$watchAsProperty("options.step");step.skipDuplicates().subscribe(function(value){value.value&&value.value()===$scope.STEP_CHECK_SPLIT&&$timeout(function(){$scope.options.check_split=$scope.CHECK_SPLIT_NONE})})}]),angular.module("SNAP.controllers").controller("CheckoutTipCtrl",["$scope","$timeout","OrderManager",function($scope,$timeout,OrderManager){$scope.addTip=function(amount){$scope.current.tip=Math.round($scope.current.subtotal*amount*100)/100},$scope.applyTip=function(){$scope.options.step=$scope.STEP_PAYMENT_METHOD}}]),angular.module("SNAP.controllers").factory("CommandFlipScreen",["ManagementService",function(ManagementService){return function(){ManagementService.rotateScreen()}}]),angular.module("SNAP.controllers").factory("CommandReset",["AnalyticsManager","ChatManager","CustomerManager","OrderManager","SessionManager","SurveyManager","ManagementService","Logger",function(AnalyticsManager,ChatManager,CustomerManager,OrderManager,SessionManager,SurveyManager,ManagementService,Logger){return function(){function fail(e){Logger.warn("Unable to reset properly: "+e.message),ManagementService.reset()}SessionManager.endSession(),AnalyticsManager.submit().then(function(){OrderManager.reset().then(function(){SurveyManager.reset().then(function(){CustomerManager.logout().then(function(){ChatManager.reset().then(function(){ManagementService.reset()},fail)},fail)},fail)},fail)},fail)}}]),angular.module("SNAP.controllers").factory("CommandStartup",["Logger","AppCache","ChatManager","ShellManager","CustomerManager","DataManager","NavigationManager","SurveyManager","SNAPConfig",function(Logger,AppCache,ChatManager,ShellManager,CustomerManager,DataManager,NavigationManager,SurveyManager,SNAPConfig){return function(){function cacheComplete(updated){updated?window.location.reload(!0):DataManager.initialize()}if(AppCache.isUpdated)return void cacheComplete(!0);if(AppCache.isComplete&&cacheComplete(!1),AppCache.complete.add(cacheComplete),ShellManager.initialize(),CustomerManager.model.isEnabled){if(!CustomerManager.model.isAuthenticated)return void(NavigationManager.location={type:"signin"})}else CustomerManager.guestLogin()}}]),angular.module("SNAP.controllers").factory("CommandSubmitOrder",["DialogManager","LocationModel","OrderManager",function(DialogManager,LocationModel,OrderManager){return function(options){if(!LocationModel.seat||!LocationModel.seat.token)return void DialogManager.alert(ALERT_ERROR_NO_SEAT);var job=DialogManager.startJob();options=options||0,OrderManager.submitCart(options).then(function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_ORDER_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})}}]),angular.module("SNAP.controllers").controller("DialogCtrl",["$scope","$timeout","ActivityMonitor","DialogManager",function($scope,$timeout,ActivityMonitor,DialogManager){function updateVisibility(isBusy,showAlert,showConfirm){$timeout(function(){$scope.isBusy=void 0!==isBusy?isBusy:$scope.isBusy,$scope.showAlert=void 0!==showAlert?showAlert:$scope.showAlert,$scope.showConfirm=void 0!==showConfirm?showConfirm:$scope.showConfirm,$scope.visible=$scope.isBusy||$scope.showAlert||$scope.showConfirm})}function showNextAlert(){return alertTimer&&$timeout.cancel(alertTimer),alertIndex++,alertIndex===alertStack.length?(updateVisibility(void 0,!1),alertStack=[],void(alertIndex=-1)):($timeout(function(){$scope.alertTitle=alertStack[alertIndex].title,$scope.alertText=alertStack[alertIndex].message,updateVisibility(void 0,!0)}),void(alertTimer=$timeout(showNextAlert,1e4)))}function showNextConfirm(){return confirmIndex++,confirmIndex===confirmStack.length?(updateVisibility(void 0,void 0,!1),confirmStack=[],void(confirmIndex=-1)):void $timeout(function(){$scope.confirmText=confirmStack[confirmIndex].message,updateVisibility(void 0,void 0,!0)})}function getMessage(message){if("string"!=typeof message)switch(message){case ALERT_GENERIC_ERROR:message="Oops! My bits are fiddled. Our request system has been disconnected. Please notify a server.";break;case ALERT_REQUEST_SUBMIT_ERROR:message="Oops! My bits are fiddled. Our request system has been disconnected. Please notify a server.";break;case ALERT_REQUEST_ASSISTANCE_SENT:message="Call Server request was sent successfully.";break;case ALERT_REQUEST_ASSISTANCE_RECEIVED:message="Your request for server assistance has been seen, and accepted.";break;case ALERT_REQUEST_CLOSEOUT_SENT:message="Request check request was sent successfully.";break;case ALERT_REQUEST_CLOSEOUT_RECEIVED:message="Your check request has been seen, and accepted.";break;case ALERT_REQUEST_ORDER_SENT:message="Order sent! You will be notified when your waiter accepts the order.";break;case ALERT_REQUEST_ORDER_RECEIVED:message="Your order has been successfully accepted.";break;case ALERT_SIGNIN_REQUIRED:message="You must be logged into SNAP to access this page.";break;case ALERT_TABLE_ASSISTANCE:message="Are you sure you want to call the waiter?";break;case ALERT_TABLE_CLOSEOUT:message="Are you sure you want to request your check?";break;case ALERT_TABLE_RESET:message="Are you sure you want to reset?";break;case ALERT_DELET_CARD:message="Are you sure you want to remove this payment method?";break;case ALERT_PASSWORD_RESET_COMPLETE:message="A link to change your password has been emailed.";break;case ALERT_SOFTWARE_OUTDATED:message="A software update is available. Please restart the application.";break;case ALERT_CARDREADER_ERROR:message="Unable to read the card data. Please try again.";break;case ALERT_ERROR_NO_SEAT:message="Device is not assigned to any table."}return message}var alertTimer,alertStack=[],confirmStack=[],alertIndex=-1,confirmIndex=-1;$scope.visible=!1,$scope.isBusy=!1,$scope.showAlert=!1,$scope.showConfirm=!1,$scope.closeAlert=function(){ActivityMonitor.activityDetected(),showNextAlert()},$scope.closeConfirm=function(confirmed){ActivityMonitor.activityDetected();var confirm=confirmStack[confirmIndex];confirmed?confirm.resolve&&confirm.resolve():confirm.reject&&confirm.reject(),showNextConfirm()},DialogManager.alertRequested.add(function(message,title){message=getMessage(message),alertStack.push({title:title,message:message}),$scope.showAlert||$timeout(showNextAlert)}),DialogManager.confirmRequested.add(function(message,resolve,reject){message=getMessage(message),confirmStack.push({message:message,resolve:resolve,reject:reject}),$scope.showConfirm||$timeout(showNextConfirm)}),DialogManager.jobStarted.add(function(){document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur(),updateVisibility(!0)}),DialogManager.jobEnded.add(function(){updateVisibility(!1)})}]),angular.module("SNAP.controllers").controller("GalaxiesAdvertisementCtrl",["$scope","$timeout","ActivityMonitor","AnalyticsModel","ShellManager","DataManager","DataProvider","DialogManager","NavigationManager","CommandReset","CommandFlipScreen","ShellManager","WebBrowser","SNAPEnvironment",function($scope,$timeout,ActivityMonitor,AnalyticsModel,hellManager,DataManager,DataProvider,DialogManager,NavigationManager,CommandReset,CommandFlipScreen,ShellManager,WebBrowser,SNAPEnvironment){$scope.visible=!1,$scope.advertisementClick=function(item){return CustomerManager.model.isEnabled&&!CustomerManager.model.isAuthenticated?void DialogManager.alert(ALERT_SIGNIN_REQUIRED):(AnalyticsModel.logAdvertisement({token:item.token,type:"click"}),void(item.href&&(NavigationManager.location={type:"url",url:item.href.url})))},$scope.advertisementImpression=function(item){ActivityMonitor.active&&$scope.visible&&AnalyticsModel.logAdvertisement({token:item.token,type:"impression"})},$scope.advertisements=[],DataProvider.advertisements().then(function(data){$timeout(function(){$scope.advertisements=data.main.map(function(ad){return{src:ShellManager.getMediaUrl(ad.src,970,90),href:ad.href,type:ShellManager.getMediaType(ad.src),token:ad.token}})})}),NavigationManager.locationChanging.add(function(location){$scope.visible="home"===location.type,$timeout(function(){return $scope.$apply()})})}]),angular.module("SNAP.controllers").controller("GalaxiesCartCtrl",["$scope","$timeout","$sce","CustomerManager","ShellManager","NavigationManager","OrderManager","DialogManager","CartModel","LocationModel","ChatManager",function($scope,$timeout,$sce,CustomerManager,ShellManager,NavigationManager,OrderManager,DialogManager,CartModel,LocationModel,ChatManager){$scope.STATE_CART=CartModel.STATE_CART,$scope.STATE_HISTORY=CartModel.STATE_HISTORY,$scope.getMediaUrl=function(media,width,height,extension){return ShellManager.getMediaUrl(media,width,height,extension)},$scope.formatPrice=function(value){return ShellManager.formatPrice(value)},$scope.options={},$scope.currency=ShellManager.model.currency,ShellManager.model.currencyChanged.add(function(currency){return $timeout(function(){return $scope.currency=currency})}),$scope.state=CartModel.cartState,CartModel.cartStateChanged.add(function(state){return $timeout(function(){return $scope.state=state})}),$scope.editableItem=CartModel.editableItem,CartModel.editableItemChanged.add(function(item){return $timeout(function(){return $scope.editableItem=item})}),$scope.currentOrder=OrderManager.model.orderCart,OrderManager.model.orderCartChanged.add(function(value){return $scope.currentOrder=value}),$scope.totalOrder=OrderManager.model.orderCheck,OrderManager.model.orderCheckChanged.add(function(value){return $scope.totalOrder=value}),$scope.giftSeat=LocationModel.getSeat(ChatManager.model.giftSeat),ChatManager.model.giftSeatChanged.add(function(token){$timeout(function(){return $scope.giftSeat=LocationModel.getSeat(token)})}),$scope.customerName=CustomerManager.customerName,CustomerManager.model.profileChanged.add(function(){$timeout(function(){return $scope.customerName=CustomerManager.customerName})}),$scope.checkoutEnabled=CustomerManager.model.isEnabled,$scope.visible=CartModel.isCartOpen,NavigationManager.locationChanging.add(function(location){"category"!==location.type&&(CartModel.isCartOpen=!1,CartModel.closeEditor())}),CartModel.isCartOpenChanged.add(function(value){$scope.showCart(),$scope.visible=value}),$scope.seat_name=LocationModel.seat?LocationModel.seat.name:"Table",LocationModel.seatChanged.add(function(seat){return $scope.seat_name=seat?seat.name:"Table"});var refreshAssistanceRequest=function(){$scope.requestAssistanceAvailable=null==OrderManager.model.assistanceRequest},refreshCloseoutRequest=function(){$scope.requestCloseoutAvailable=null==OrderManager.model.closeoutRequest};OrderManager.model.assistanceRequestChanged.add(refreshAssistanceRequest),OrderManager.model.closeoutRequestChanged.add(refreshCloseoutRequest),$scope.requestAssistanceAvailable=null==OrderManager.model.assistanceRequest,$scope.requestCloseoutAvailable=null==OrderManager.model.closeoutRequest,$scope.getModifiers=function(entry){return entry.modifiers?entry.modifiers.reduce(function(result,category){var modifiers=category.modifiers.filter(function(modifier){return modifier.isSelected});return result=result.concat(modifiers)},[]):[]},$scope.calculatePrice=function(entry){return OrderManager.calculatePrice(entry)},$scope.calculateTotalPrice=function(entries){return OrderManager.calculateTotalPrice(entries)},$scope.editItem=function(entry){return CartModel.openEditor(entry,!1)},$scope.updateModifiers=function(category,modifier){1===category.data.selection?angular.forEach(category.modifiers,function(m){return m.isSelected=m===modifier}):modifier.isSelected=!modifier.isSelected},$scope.removeFromCart=function(entry){return $scope.currentOrder=OrderManager.removeFromCart(entry)},$scope.reorderItem=function(entry){return $scope.currentOrder=OrderManager.addToCart(entry.clone())},$scope.submitCart=function(){var job=DialogManager.startJob(),options=$scope.options.toGo?2:0;OrderManager.submitCart(options).then(function(){DialogManager.endJob(job),$scope.$apply(function(){$scope.currentOrder=OrderManager.model.orderCart,$scope.totalOrder=OrderManager.model.orderCheck,$scope.options.toGo=!1}),DialogManager.alert(ALERT_REQUEST_ORDER_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})},$scope.clearCart=function(){$scope.options.toGo=!1,$scope.currentOrder=OrderManager.clearCart()},$scope.closeEditor=function(){CartModel.closeEditor()},$scope.closeCart=function(){CartModel.isCartOpen=!1,CartModel.state=CartModel.STATE_CART},$scope.showHistory=function(){return CartModel.state=CartModel.STATE_HISTORY},$scope.showCart=function(){return CartModel.state=CartModel.STATE_CART},$scope.payCheck=function(){return NavigationManager.location={type:"checkout"}},$scope.requestAssistance=function(){$scope.requestAssistanceAvailable&&DialogManager.confirm(ALERT_TABLE_ASSISTANCE).then(function(){var job=DialogManager.startJob();OrderManager.requestAssistance().then(function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_ASSISTANCE_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})})},$scope.requestCloseout=function(){if($scope.requestCloseoutAvailable){var job=DialogManager.startJob();OrderManager.requestCloseout().then(function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_CLOSEOUT_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})}}}]),angular.module("SNAP.controllers").controller("GalaxiesCategoryCtrl",["$scope","$timeout","DataManager","NavigationManager","ShellManager",function($scope,$timeout,DataManager,NavigationManager,ShellManager){$scope.goBack=function(){return NavigationManager.goBack()};var CategoryList=React.createClass({displayName:"CategoryList",render:function(){var rows=this.props.tiles.map(function(tile,i){var background=ShellManager.getMediaUrl(tile.image,470,410);return React.DOM.td({className:"tile tile-regular",key:i},React.DOM.a({onClick:function(e){e.preventDefault(),NavigationManager.location=tile.destination},style:{backgroundImage:background?'url("'+background+'")':null}},React.DOM.span(null,tile.title)))}).reduce(function(result,value,i){return result[i%2].push(value),result},[[],[]]).map(function(row,i){return React.DOM.tr({key:i},row)});return React.DOM.table({className:"tile-table"},rows)}});DataManager.categoryChanged.add(function(category){if(!category)return $timeout(function(){return $scope.category=null;
});var items=category.items||[],categories=category.categories||[],tiles=categories.concat(items).map(function(item){return{title:item.title,image:item.image,url:"#"+NavigationManager.getPath(item.destination),destination:item.destination}});React.render(React.createElement(CategoryList,{tiles:tiles}),document.getElementById("page-category-content")),$scope.category=category,$timeout(function(){return $scope.$apply()})}),NavigationManager.locationChanging.add(function(location){return"item"===location.type?void($scope.showModal=!0):($scope.showModal=!1,DataManager.category="category"===location.type?location.token:void 0,$scope.visible=Boolean(DataManager.category),void $timeout(function(){return $scope.$apply()}))})}]),angular.module("SNAP.controllers").controller("GalaxiesHomeCtrl",["$scope","$timeout","DataManager","NavigationManager","ShellManager","SNAPConfig",function($scope,$timeout,DataManager,NavigationManager,ShellManager,SNAPConfig){var HomeMenu=React.createClass({displayName:"HomeMenu",render:function(){var rows=[],home=this.props.home;Boolean(home.intro)&&rows.push(React.DOM.td({className:"tile tile-info",key:"intro"},React.DOM.div({},[React.DOM.h1({key:"intro-title"},home.intro.title||"Welcome to "+SNAPConfig.location_name),React.DOM.p({key:"intro-text"},home.intro.text)])));var tiles=this.props.tiles.map(function(tile,i){var background=ShellManager.getMediaUrl(tile.image,470,410);return React.DOM.td({className:"tile tile-regular",key:i},React.DOM.a({onClick:function(e){e.preventDefault(),NavigationManager.location=tile.destination},style:{backgroundImage:background?'url("'+background+'")':null}},React.DOM.span(null,tile.title)))});return rows=rows.concat(tiles).reduce(function(result,value){return result[0].push(value),result},[[]]).map(function(row,i){return React.DOM.tr({key:i},row)}),React.DOM.table({className:"tile-table"},rows)}});DataManager.homeChanged.add(function(home){if(home){var tiles=home.menus.map(function(menu){var destination={type:"menu",token:menu.token};return{title:menu.title,image:menu.image,url:"#"+NavigationManager.getPath(destination),destination:destination}});React.render(React.createElement(HomeMenu,{tiles:tiles,home:home}),document.getElementById("page-home-menu"))}}),NavigationManager.locationChanging.add(function(location){DataManager.home="home"===location.type,$scope.visible=Boolean(DataManager.home),$timeout(function(){return $scope.$apply()})})}]),angular.module("SNAP.controllers").controller("GalaxiesItemCtrl",["$scope","$timeout","DataManager","NavigationManager","OrderManager","ShellManager","WebBrowser","CommandSubmitOrder",function($scope,$timeout,DataManager,NavigationManager,OrderManager,ShellManager,WebBrowser,CommandSubmitOrder){$scope.goBack=function(){return NavigationManager.goBack()},DataManager.itemChanged.add(function(item){if(!item)return WebBrowser.close(),$timeout(function(){$scope.entry=$scope.entries=null,$scope.type=1,$scope.step=0,$scope.entryIndex=0});var type=item.type;if(2===type&&item.website)WebBrowser.open(item.website.url);else if(3===type&&item.flash){var flashUrl=ShellManager.getMediaUrl(item.flash.media,0,0,"swf"),url="/flash#url="+encodeURIComponent(flashUrl)+"&width="+encodeURIComponent(item.flash.width)+"&height="+encodeURIComponent(item.flash.height);WebBrowser.open(WebBrowser.getAppUrl(url))}$timeout(function(){1===type&&($scope.entry=new app.CartItem(item,1)),$scope.type=type,$scope.step=0,$scope.entryIndex=0})}),$scope.getMediaUrl=function(media,w,h,extension){return ShellManager.getMediaUrl(media,w,h,extension)},$scope.formatPrice=function(value){return value?ShellManager.formatPrice(value):0},$scope.nextStep=function(){0===$scope.step?$scope.entry.hasModifiers?($scope.entries=$scope.entry.cloneMany(),$scope.currentEntry=$scope.entries[$scope.entryIndex=0],$scope.step=1):(OrderManager.addToCart($scope.entry),$scope.step=2):1===$scope.step&&($scope.entryIndex===$scope.entries.length-1?($scope.entries.forEach(function(entry){return OrderManager.addToCart(entry)}),$scope.step=2):$scope.currentEntry=$scope.entries[++$scope.entryIndex])},$scope.previousStep=function(){1===$scope.step&&$scope.entryIndex>0?$scope.currentEntry=$scope.entries[--$scope.entryIndex]:0===$scope.step?$scope.goBack():$scope.step--},$scope.updateModifiers=function(category,modifier){1===category.data.selection?angular.forEach(category.modifiers,function(m){return m.isSelected=m===modifier}):modifier.isSelected=!modifier.isSelected},$scope.submitOrder=function(){CommandSubmitOrder(),$scope.goBack()},NavigationManager.locationChanging.add(function(location){DataManager.item="item"===location.type?location.token:void 0,$scope.visible=Boolean(DataManager.item),$timeout(function(){return $scope.$apply()})})}]),angular.module("SNAP.controllers").controller("GalaxiesItemEditCtrl",["$scope","ShellManager","NavigationManager","OrderManager","CartModel","CommandSubmitOrder",function($scope,ShellManager,NavigationManager,OrderManager,CartModel,CommandSubmitOrder){$scope.getMediaUrl=function(media,width,height,extension){return ShellManager.getMediaUrl(media,width,height,extension)},$scope.formatPrice=function(value){return ShellManager.formatPrice(value)};var currentIndex=-1,refreshNavigation=function(){$scope.entry&&$scope.entry.hasModifiers&&($scope.hasNextCategory=$scope.entry.modifiers.length>1&&currentIndex<$scope.entry.modifiers.length-1,$scope.hasPreviousCategory=currentIndex>0,$scope.category=$scope.entry.modifiers[currentIndex],$scope.canExit=CartModel.editableItemNew,$scope.canDone=!0)};NavigationManager.locationChanging.add(function(location){"menu"!==location.type&&"category"!==location.type&&$scope.exit()}),CartModel.isCartOpenChanged.add(function(value){value&&$scope.exit()});var init=function(value){$scope.entry=value,$scope.visible=null!=$scope.entry,currentIndex=0,refreshNavigation()};init(CartModel.editableItem),CartModel.editableItemChanged.add(function(value){init(value)}),$scope.getModifierTitle=function(modifier){return modifier.data.title+(modifier.data.price>0?" (+"+ShellManager.formatPrice(modifier.data.price)+")":"")},$scope.leftButtonClick=function(){currentIndex>0?$scope.previousCategory():$scope.exit()},$scope.leftButtonText=function(){return currentIndex>0?"Back":"Exit"},$scope.showLeftButton=function(){return currentIndex>0},$scope.rightButtonClick=function(){if(1===$scope.entry.modifiers[currentIndex].data.selection){var numSelected=0;if(angular.forEach($scope.entry.modifiers[currentIndex].modifiers,function(m){m.isSelected&&numSelected++}),1!==numSelected)return}$scope.hasNextCategory?$scope.nextCategory():$scope.done()},$scope.rightButtonText=function(){return $scope.hasNextCategory?"Next":"Done"},$scope.showRightButton=function(){return $scope.hasNextCategory},$scope.previousCategory=function(){currentIndex--,refreshNavigation()},$scope.nextCategory=function(){currentIndex++,refreshNavigation()},$scope.updateModifiers=function(category,modifier){modifier.isSelected=!modifier.isSelected,modifier.isSelected&&1===category.data.selection&&angular.forEach(category.modifiers,function(m){m.isSelected=m===modifier})},$scope.submitChanges=function(){OrderManager.removeFromCart($scope.entry),OrderManager.addToCart($scope.entry),$scope.exit()},$scope.done=function(){CartModel.editableItemNew&&OrderManager.addToCart(CartModel.editableItem),$scope.exit(),CartModel.isCartOpen=!0},$scope.exit=function(){CartModel.closeEditor()}}]),angular.module("SNAP.controllers").controller("GalaxiesMenuCtrl",["$scope","$timeout","DataManager","NavigationManager","ShellManager",function($scope,$timeout,DataManager,NavigationManager,ShellManager){$scope.goBack=function(){return NavigationManager.goBack()};var MenuList=React.createClass({displayName:"MenuList",render:function(){var rows=this.props.tiles.map(function(tile,i){var background=ShellManager.getMediaUrl(tile.image,470,410);return React.DOM.td({className:"tile tile-regular",key:i},React.DOM.a({onClick:function(e){e.preventDefault(),NavigationManager.location=tile.destination},style:{backgroundImage:background?'url("'+background+'")':null}},React.DOM.span(null,tile.title)))}).reduce(function(result,value,i){return result[i%2].push(value),result},[[],[]]).map(function(row,i){return React.DOM.tr({key:i},row)});return React.DOM.table({className:"tile-table"},rows)}});DataManager.menuChanged.add(function(menu){if(!menu)return $timeout(function(){return $scope.menu=null});var tiles=menu.categories.map(function(category){var destination={type:"category",token:category.token};return{title:category.title,image:category.image,url:"#"+NavigationManager.getPath(destination),destination:destination}});React.render(React.createElement(MenuList,{tiles:tiles}),document.getElementById("page-menu-content")),$scope.menu=menu,$timeout(function(){return $scope.$apply()})}),NavigationManager.locationChanging.add(function(location){DataManager.menu="menu"===location.type?location.token:void 0,$scope.visible=Boolean(DataManager.menu),$timeout(function(){return $scope.$apply()})})}]),angular.module("SNAP.controllers").controller("GalaxiesNavigationCtrl",["$scope","$timeout","ActivityMonitor","CustomerManager","AnalyticsModel","CartModel","ShellManager","DataManager","DataProvider","DialogManager","LocationModel","ManagementService","NavigationManager","OrderManager","CommandReset","CommandSubmitOrder","CommandFlipScreen","WebBrowser","SNAPEnvironment",function($scope,$timeout,ActivityMonitor,CustomerManager,AnalyticsModel,CartModel,ShellManager,DataManager,DataProvider,DialogManager,LocationModel,ManagementService,NavigationManager,OrderManager,CommandReset,CommandSubmitOrder,CommandFlipScreen,WebBrowser,SNAPEnvironment){$scope.menus=[],DataProvider.home().then(function(response){if(response){var location=NavigationManager.location,limit="desktop"===SNAPEnvironment.platform?4:3;$scope.menus=response.menus.filter(function(menu){return"desktop"===SNAPEnvironment.platform||3!==menu.type}).filter(function(menu,i){return limit>i}).map(function(menu){var destination={type:"menu",token:menu.token};return{token:menu.token,title:menu.title,url:"#"+NavigationManager.getPath(destination),destination:destination,selected:"menu"===location.type&&menu.token===location.token}})}}),$scope.advertisementClick=function(item){item.href&&(NavigationManager.location={type:"url",url:item.href.url})},$scope.currentAdvertisement,$scope.advertisementImpression=function(item){$scope.currentAdvertisement=item,ActivityMonitor.active&&$scope.menuOpen&&AnalyticsModel.logAdvertisement({token:item.token,type:"impression"})},$scope.advertisements=[],DataProvider.advertisements().then(function(data){$timeout(function(){$scope.advertisements=data.misc.map(function(ad){return{src:ShellManager.getMediaUrl(ad.src,300,250),href:ad.href,type:ShellManager.getMediaType(ad.src),token:ad.token}})})}),$scope.navigateHome=function(){ActivityMonitor.activityDetected(),$scope.settingsOpen=!1,NavigationManager.location={type:"home"}},$scope.navigateBack=function(){ActivityMonitor.activityDetected(),$scope.settingsOpen=!1,NavigationManager.goBack()},$scope.rotateScreen=function(){ActivityMonitor.activityDetected(),$scope.settingsOpen=!1,CommandFlipScreen()},$scope.openCart=function(){ActivityMonitor.activityDetected(),$scope.settingsOpen=!1,CartModel.isCartOpen=!CartModel.isCartOpen},$scope.seatName=LocationModel.seat?LocationModel.seat.name:"Table",LocationModel.seatChanged.add(function(value){return $timeout(function(){return $scope.seatName=value?value.name:"Table"})}),$scope.resetTable=function(){ActivityMonitor.activityDetected(),$scope.settingsOpen=!1,DialogManager.confirm(ALERT_TABLE_RESET).then(function(){DialogManager.startJob(),CommandReset()})},$scope.menuOpen=!1,$scope.toggleMenu=function(){ActivityMonitor.activityDetected(),$scope.menuOpen=!$scope.menuOpen,$scope.currentAdvertisement&&$scope.menuOpen&&(AnalyticsModel.logAdvertisement({token:$scope.currentAdvertisement.token,type:"impression"}),$scope.currentAdvertisement=null)},$scope.settingsOpen=!1,$scope.toggleSettings=function(){ActivityMonitor.activityDetected(),$scope.settingsOpen=!$scope.settingsOpen},$scope.elements=ShellManager.model.elements,ShellManager.model.elementsChanged.add(function(value){$timeout(function(){return $scope.elements=value})}),$scope.cartCount=OrderManager.model.orderCart.length,OrderManager.model.orderCartChanged.add(function(cart){$timeout(function(){return $scope.cartCount=cart.length})}),$scope.checkoutEnabled=CustomerManager.model.isEnabled,$scope.totalOrder=OrderManager.model.orderCheck,OrderManager.model.orderCheckChanged.add(function(value){$timeout(function(){return $scope.totalOrder=value})}),$scope.requestAssistance=function(){$scope.requestAssistanceAvailable&&(ActivityMonitor.activityDetected(),$scope.settingsOpen=!1,DialogManager.confirm(ALERT_TABLE_ASSISTANCE).then(function(){var job=DialogManager.startJob();OrderManager.requestAssistance().then(function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_ASSISTANCE_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})}))};var refreshAssistanceRequest=function(){$scope.requestAssistanceAvailable=!Boolean(OrderManager.model.assistanceRequest)};OrderManager.model.assistanceRequestChanged.add(refreshAssistanceRequest),refreshAssistanceRequest(),$scope.submitOrder=function(){ActivityMonitor.activityDetected(),$scope.settingsOpen=!1,CommandSubmitOrder()},$scope.viewOrder=function(){return ActivityMonitor.activityDetected(),$scope.settingsOpen=!1,CustomerManager.model.isEnabled&&!CustomerManager.model.isAuthenticated?void DialogManager.alert(ALERT_SIGNIN_REQUIRED):(CartModel.cartState=CartModel.STATE_CART,void(CartModel.isCartOpen=!0))},$scope.payBill=function(){return ActivityMonitor.activityDetected(),$scope.settingsOpen=!1,CustomerManager.model.isEnabled&&!CustomerManager.model.isAuthenticated?void DialogManager.alert(ALERT_SIGNIN_REQUIRED):(CartModel.cartState=CartModel.STATE_HISTORY,void(CartModel.isCartOpen=!0))},$scope.customerName=CustomerManager.customerName,CustomerManager.model.profileChanged.add(function(){$timeout(function(){return $scope.customerName=CustomerManager.customerName})}),$scope.settings={displayBrightness:100,soundVolume:100},$scope.$watch("settings.soundVolume",function(value,old){value!==old&&(ActivityMonitor.activityDetected(),ManagementService.setSoundVolume(value))}),ManagementService.getSoundVolume().then(function(response){return $timeout(function(){return $scope.settings.soundVolume=response.volume})},function(e){}),$scope.$watch("settings.displayBrightness",function(value,old){value!==old&&(ActivityMonitor.activityDetected(),ManagementService.setDisplayBrightness(value))}),ManagementService.getDisplayBrightness().then(function(response){return $timeout(function(){return $scope.settings.displayBrightness=response.brightness})},function(e){}),$scope.navigate=function(destination){return NavigationManager.location=destination},NavigationManager.locationChanging.add(function(location){$scope.visible="signin"!==location.type,$timeout(function(){return $scope.$apply()})}),NavigationManager.locationChanged.add(function(location){$timeout(function(){"category"!==location.type&&"item"!==location.type&&$scope.menus.forEach(function(menu){menu.selected="menu"===location.type&&menu.token===location.token}),$scope.menuOpen=!1,$scope.settingsOpen=!1})})}]),angular.module("SNAP.controllers").controller("HomeBaseCtrl",["$scope","$timeout","DataManager","NavigationManager",function($scope,$timeout,DataManager,NavigationManager){}]),angular.module("SNAP.controllers").controller("HomeCtrl",["$scope","$timeout","ChatManager","DataProvider","ShellManager","CustomerManager","OrderManager","DialogManager","NavigationManager","LocationModel","SurveyManager","SNAPConfig","SNAPEnvironment","CommandReset",function($scope,$timeout,ChatManager,DataProvider,ShellManager,CustomerManager,OrderManager,DialogManager,NavigationManager,LocationModel,SurveyManager,SNAPConfig,SNAPEnvironment,CommandReset){var HomeMenu=React.createClass({displayName:"HomeMenu",render:function(){var result=[React.DOM.td({key:-1})],rows=this.props.tiles.map(function(tile,i){return React.DOM.td({className:"home-menu-item",key:i},React.DOM.a({onClick:function(e){e.preventDefault(),NavigationManager.location=tile.destination}},React.DOM.img({src:ShellManager.getMediaUrl(tile.image,160,160)})))});return result=result.concat(rows),result.push(React.DOM.td({key:result.length})),React.DOM.table(null,result)}});DataProvider.home().then(function(response){if(response){var tiles=[];response.menus.filter(function(menu){return"desktop"===SNAPEnvironment.platform||3!==menu.type}).reduce(function(tiles,menu){if(menu.promos&&menu.promos.length>0)menu.promos.filter(function(promo){return"desktop"===SNAPEnvironment.platform||3!==promo.type}).forEach(function(promo){tiles.push({title:promo.title,image:promo.image,url:"#"+NavigationManager.getPath(promo.destination),destination:promo.destination})});else{var destination={type:"menu",token:menu.token};tiles.push({title:menu.title,image:menu.image,url:"#"+NavigationManager.getPath(destination),destination:destination})}return tiles},tiles),$timeout(function(){React.render(React.createElement(HomeMenu,{tiles:tiles}),document.getElementById("home-menu-main"))},1e3)}}),NavigationManager.locationChanging.add(function(location){$scope.visible="home"===location.type,$timeout(function(){$scope.$apply()})}),$scope.preload=function(destination){NavigationManager.location=destination},$scope.getMediaUrl=function(media,width,height,extension){return ShellManager.getMediaUrl(media,width,height,extension)},$scope.predicateEven=ShellManager.predicateEven,$scope.predicateOdd=ShellManager.predicateOdd,$scope.seat_name=LocationModel.seat?LocationModel.seat.name:"Table",LocationModel.seatChanged.add(function(value){$timeout(function(){$scope.seat_name=value?value.name:"Table"})}),$scope.customer_name=CustomerManager.customerName,CustomerManager.model.profileChanged.add(function(){$timeout(function(){return $scope.customer_name=CustomerManager.customerName})}),$scope.elements=ShellManager.model.elements,ShellManager.model.elementsChanged.add(function(value){$timeout(function(){return $scope.elements=value})});var refreshAssistanceRequest=function(){$scope.requestAssistanceAvailable=!Boolean(OrderManager.model.assistanceRequest)},refreshCloseoutRequest=function(){$scope.requestCloseoutAvailable=!Boolean(OrderManager.model.closeoutRequest)},refreshSurvey=function(){$scope.surveyAvailable=SurveyManager.model.isEnabled&&SurveyManager.model.feedbackSurvey&&!SurveyManager.model.feedbackSurveyComplete};OrderManager.model.assistanceRequestChanged.add(refreshAssistanceRequest),OrderManager.model.closeoutRequestChanged.add(refreshCloseoutRequest),SurveyManager.model.feedbackSurveyChanged.add(refreshSurvey),SurveyManager.model.surveyCompleted.add(refreshSurvey),refreshAssistanceRequest(),refreshCloseoutRequest(),refreshSurvey(),$scope.chatAvailable=Boolean(SNAPConfig.chat),$scope.requestAssistance=function(){$scope.requestAssistanceAvailable&&DialogManager.confirm(ALERT_TABLE_ASSISTANCE).then(function(){var job=DialogManager.startJob();OrderManager.requestAssistance().then(function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_ASSISTANCE_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})})},$scope.requestCloseout=function(){$scope.requestCloseoutAvailable&&DialogManager.confirm(ALERT_TABLE_CLOSEOUT).then(function(){var job=DialogManager.startJob();OrderManager.requestCloseout().then(function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_CLOSEOUT_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})})},$scope.openSurvey=function(){$scope.surveyAvailable&&(NavigationManager.location={type:"survey"})},$scope.seatClicked=function(){DialogManager.confirm(ALERT_TABLE_RESET).then(function(){DialogManager.startJob(),CommandReset()})},$scope.customerClicked=function(){CustomerManager.model.isEnabled&&(CustomerManager.model.isAuthenticated&&!CustomerManager.model.isGuest?NavigationManager.location={type:"account"}:DialogManager.alert(ALERT_SIGNIN_REQUIRED))},$scope.openChat=function(){NavigationManager.location={type:"chat"}}}]),angular.module("SNAP.controllers").controller("ItemBaseCtrl",["$scope",function($scope){}]),angular.module("SNAP.controllers").controller("ItemCtrl",["$scope","$timeout","AnalyticsModel","CustomerModel","DataManager","DialogManager","NavigationManager","OrderManager","CartModel","LocationModel","ShellManager","WebBrowser","SNAPEnvironment","ChatManager",function($scope,$timeout,AnalyticsModel,CustomerModel,DataManager,DialogManager,NavigationManager,OrderManager,CartModel,LocationModel,ShellManager,WebBrowser,SNAPEnvironment,ChatManager){var ItemImage=React.createClass({displayName:"ItemImage",render:function(){return React.DOM.img({src:ShellManager.getMediaUrl(this.props.media,600,600)})}});NavigationManager.locationChanging.add(function(location){DataManager.item="item"===location.type?location.token:void 0,$scope.visible=Boolean(DataManager.item),$timeout(function(){$scope.$apply()})}),DataManager.itemChanged.add(function(response){if(response||!$scope.websiteUrl&&!$scope.flashUrl||WebBrowser.close(),$scope.websiteUrl=null,$scope.flashUrl=null,!response)return $scope.entry=null,1===$scope.type&&(document.getElementById("item-photo").innerHTML=""),$scope.type=1,void $timeout(function(){return $scope.$apply()});var type=response.type;if(2===type&&response.website)$scope.websiteUrl=response.website.url,WebBrowser.open($scope.websiteUrl);else if(3===type&&response.flash){var url="/flash#url="+encodeURIComponent(getMediaUrl(response.flash.media,0,0,"swf"))+"&width="+encodeURIComponent(response.flash.width)+"&height="+encodeURIComponent(response.flash.height);$scope.flashUrl=WebBrowser.getAppUrl(url),WebBrowser.open($scope.flashUrl)}else 1===type&&($scope.entry=new app.CartItem(response,1),React.render(React.createElement(ItemImage,{media:$scope.entry.item.image}),document.getElementById("item-photo")));$scope.type=type,$timeout(function(){$scope.$apply()})}),$scope.getMediaUrl=function(media,width,height,extension){return ShellManager.getMediaUrl(media,width,height,extension)},$scope.formatPrice=function(value){return value?ShellManager.formatPrice(value):0},$scope.addToCart=function(){if(CustomerModel.isEnabled&&!CustomerModel.isAuthenticated)return void DialogManager.alert(ALERT_SIGNIN_REQUIRED);var entry=$scope.entry;entry.hasModifiers?CartModel.openEditor(entry,!0):(OrderManager.addToCart(entry),CartModel.isCartOpen=!0),NavigationManager.goBack()},$scope.cancelGift=function(){return ChatManager.cancelGift()},$scope.giftSeat=LocationModel.getSeat(ChatManager.model.giftSeat),ChatManager.model.giftSeatChanged.add(function(token){$timeout(function(){return $scope.giftSeat=LocationModel.getSeat(token)})})}]),angular.module("SNAP.controllers").controller("ItemEditCtrl",["$scope","ShellManager","NavigationManager","OrderManager","CartModel",function($scope,ShellManager,NavigationManager,OrderManager,CartModel){$scope.getMediaUrl=function(media,width,height,extension){return ShellManager.getMediaUrl(media,width,height,extension)},$scope.formatPrice=function(value){return ShellManager.formatPrice(value)};var currentIndex=-1,refreshNavigation=function(){$scope.entry&&$scope.entry.hasModifiers&&($scope.hasNextCategory=$scope.entry.modifiers.length>1&&currentIndex<$scope.entry.modifiers.length-1,$scope.hasPreviousCategory=currentIndex>0,$scope.category=$scope.entry.modifiers[currentIndex],$scope.canExit=CartModel.editableItemNew,$scope.canDone=!0)};NavigationManager.locationChanging.add(function(location){"menu"!==location.type&&"category"!==location.type&&$scope.exit()}),CartModel.isCartOpenChanged.add(function(value){value&&$scope.exit()});var init=function(value){$scope.entry=value,$scope.visible=null!=$scope.entry,currentIndex=0,refreshNavigation()};init(CartModel.editableItem),CartModel.editableItemChanged.add(function(value){init(value)}),$scope.getModifierTitle=function(modifier){return modifier.data.title+(modifier.data.price>0?" (+"+ShellManager.formatPrice(modifier.data.price)+")":"")},$scope.leftButtonClick=function(){currentIndex>0?$scope.previousCategory():$scope.exit()},$scope.leftButtonText=function(){return currentIndex>0?"Back":"Exit"},$scope.rightButtonClick=function(){if(1===$scope.entry.modifiers[currentIndex].data.selection){var numSelected=0;if(angular.forEach($scope.entry.modifiers[currentIndex].modifiers,function(m){m.isSelected&&numSelected++}),1!==numSelected)return}$scope.hasNextCategory?$scope.nextCategory():$scope.done()},$scope.rightButtonText=function(){return $scope.hasNextCategory?"Next":"Done"},$scope.previousCategory=function(){currentIndex--,refreshNavigation()},$scope.nextCategory=function(){currentIndex++,refreshNavigation()},$scope.updateModifiers=function(category,modifier){modifier.isSelected=!modifier.isSelected,modifier.isSelected&&1===category.data.selection&&angular.forEach(category.modifiers,function(m){m.isSelected=m===modifier})},$scope.done=function(){CartModel.editableItemNew&&OrderManager.addToCart(CartModel.editableItem),$scope.exit(),CartModel.isCartOpen=!0},$scope.exit=function(){CartModel.closeEditor()}}]),angular.module("SNAP.controllers").controller("MainAuxCtrl",["$scope","CommandStartup",function($scope,CommandStartup){CommandStartup()}]),angular.module("SNAP.controllers").controller("MainSnapCtrl",["$scope","$timeout","AppCache","CustomerManager","ActivityMonitor","ChatManager","ShellManager","DataManager","DialogManager","OrderManager","LocationModel","NavigationManager","SoftwareManager","SNAPConfig","CommandStartup",function($scope,$timeout,AppCache,CustomerManager,ActivityMonitor,ChatManager,ShellManager,DataManager,DialogManager,OrderManager,LocationModel,NavigationManager,SoftwareManager,SNAPConfig,CommandStartup){CommandStartup(),$scope.touch=function(){return ActivityMonitor.activityDetected()},OrderManager.model.orderRequestChanged.add(function(item){item&&item.promise.then(function(){return DialogManager.alert(ALERT_REQUEST_ORDER_RECEIVED)})}),OrderManager.model.assistanceRequestChanged.add(function(item){item&&item.promise.then(function(){return DialogManager.alert(ALERT_REQUEST_ASSISTANCE_RECEIVED)})}),OrderManager.model.closeoutRequestChanged.add(function(item){item&&item.promise.then(function(){return DialogManager.alert(ALERT_REQUEST_CLOSEOUT_RECEIVED)})}),ChatManager.model.chatRequestReceived.add(function(token){DialogManager.confirm(ChatManager.getDeviceName(token)+" would like to chat with you.").then(function(){ChatManager.approveDevice(token),NavigationManager.location={type:"chat"}},function(){return ChatManager.declineDevice(token)})}),ChatManager.model.giftRequestReceived.add(function(token,description){DialogManager.confirm(ChatManager.getDeviceName(token)+" would like to gift you a "+description).then(function(){ChatManager.acceptGift(token)},function(){return ChatManager.declineGift(token)})}),ChatManager.model.messageReceived.add(function(message){var device=LocationModel.getDevice(message.device);device&&(message.status===ChatManager.MESSAGE_STATUSES.CHAT_REQUEST_DECLINED?DialogManager.alert("Chat with "+ChatManager.getDeviceName(device.token)+' was declined. To stop recieving chat requests, open the chat screen and touch the "Chat on/off" button.'):message.status===ChatManager.MESSAGE_STATUSES.CHAT_REQUEST_ACCEPTED?DialogManager.alert("Your chat request to "+ChatManager.getDeviceName(device.token)+" was accepted."):message.status===ChatManager.MESSAGE_STATUSES.GIFT_REQUEST_ACCEPTED?DialogManager.alert(ChatManager.getDeviceName(device.token)+" has accepted your gift. The item will be added to your check."):message.status===ChatManager.MESSAGE_STATUSES.GIFT_REQUEST_DECLINED&&DialogManager.alert(ChatManager.getDeviceName(device.token)+" has declined your gift. The item will NOT be added to your check."),"chat"!==NavigationManager.location.type&&(message.status===ChatManager.MESSAGE_STATUSES.CHAT_CLOSED?DialogManager.notification(ChatManager.getDeviceName(device.token)+" has closed the chat"):!message.status&&message.to_device&&DialogManager.notification("New message from "+ChatManager.getDeviceName(device.token))))}),ChatManager.model.giftReady.add(function(){ChatManager.sendGift(OrderManager.model.orderCart),NavigationManager.location={type:"chat"}}),ChatManager.model.giftAccepted.add(function(status){if(status&&ChatManager.model.giftDevice){var job=DialogManager.startJob();OrderManager.submitCart().then(function(){DialogManager.endJob(job),NavigationManager.location={type:"chat"}},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR),ChatManager.endGift(),NavigationManager.location={type:"chat"}})}else ChatManager.model.giftSeat=null})}]),angular.module("SNAP.controllers").controller("MenuBaseCtrl",["$scope","$timeout","DataManager","NavigationManager",function($scope,$timeout,DataManager,NavigationManager){}]),angular.module("SNAP.controllers").controller("MenuCtrl",["$scope","$timeout","DataManager","NavigationManager","ShellManager",function($scope,$timeout,DataManager,NavigationManager,ShellManager){var MenuList=React.createClass({displayName:"MenuList",render:function(){var tileClassName=ShellManager.tileStyle,rows=this.props.tiles.map(function(tile,i){return React.DOM.td({className:tileClassName,key:i},React.DOM.a({onClick:function(e){e.preventDefault(),NavigationManager.location=tile.destination},style:{backgroundImage:"url("+ShellManager.getMediaUrl(tile.image,370,370)+")"}},React.DOM.span(null,tile.title)))}).reduce(function(result,value,i){return result[i%2].push(value),result},[[],[]]).map(function(row,i){return React.DOM.tr({key:i},row)});return React.DOM.table({className:"tile-table"},rows)}});NavigationManager.locationChanging.add(function(location){DataManager.menu="menu"===location.type?location.token:void 0,$scope.visible=Boolean(DataManager.menu),$timeout(function(){$scope.$apply()})}),DataManager.menuChanged.add(function(menu){menu&&(menu.categories.forEach(function(tile){tile.url="#"+NavigationManager.getPath(tile.destination)}),React.render(React.createElement(MenuList,{tiles:menu.categories}),document.getElementById("content-menu")))})}]),angular.module("SNAP.controllers").controller("ModalCtrl",["$scope","$timeout","DialogManager",function($scope,$timeout,DialogManager){DialogManager.modalStarted.add(function(){return $timeout(function(){return $scope.visible=!0})}),DialogManager.modalEnded.add(function(){return $timeout(function(){return $scope.visible=!1})})}]),angular.module("SNAP.controllers").controller("NavigationCtrl",["$scope","$timeout","ActivityMonitor","CustomerManager","AnalyticsModel","CartModel","ShellManager","DataManager","DataProvider","DialogManager","NavigationManager","OrderManager","CommandReset","CommandFlipScreen","WebBrowser","SNAPEnvironment",function($scope,$timeout,ActivityMonitor,CustomerManager,AnalyticsModel,CartModel,ShellManager,DataManager,DataProvider,DialogManager,NavigationManager,OrderManager,CommandReset,CommandFlipScreen,WebBrowser,SNAPEnvironment){$scope.menus=[],DataProvider.home().then(function(response){if(response){var location=NavigationManager.location,limit="desktop"===SNAPEnvironment.platform?4:3;$scope.menus=response.menus.filter(function(menu){return"desktop"===SNAPEnvironment.platform||3!==menu.type}).filter(function(menu,i){return limit>i}).map(function(menu){var destination={type:"menu",token:menu.token};return{token:menu.token,title:menu.title,url:"#"+NavigationManager.getPath(destination),destination:destination,selected:"menu"===location.type&&menu.token===location.token}})}}),$scope.navigateHome=function(){return ActivityMonitor.activityDetected(),CustomerManager.model.isEnabled&&!CustomerManager.model.isAuthenticated?void DialogManager.confirm(ALERT_TABLE_RESET).then(function(){
DialogManager.startJob(),CommandReset()}):(NavigationManager.location={type:"home"},void(CartModel.isCartOpen=!1))},$scope.navigateBack=function(){return ActivityMonitor.activityDetected(),CustomerManager.model.isEnabled&&!CustomerManager.model.isAuthenticated?void DialogManager.alert(ALERT_SIGNIN_REQUIRED):(NavigationManager.goBack(),void(CartModel.isCartOpen=!1))},$scope.rotateScreen=function(){ActivityMonitor.activityDetected(),CommandFlipScreen()},$scope.openCart=function(){return ActivityMonitor.activityDetected(),CustomerManager.model.isEnabled&&!CustomerManager.model.isAuthenticated?void DialogManager.alert(ALERT_SIGNIN_REQUIRED):void(CartModel.isCartOpen=!CartModel.isCartOpen)},$scope.openSettings=function(){DialogManager.confirm(ALERT_TABLE_RESET).then(function(){DialogManager.startJob(),CommandReset()})},$scope.menuOpen=!1,$scope.toggleMenu=function(){$scope.menuOpen=!$scope.menuOpen},$scope.advertisementClick=function(item){return CustomerManager.model.isEnabled&&!CustomerManager.model.isAuthenticated?void DialogManager.alert(ALERT_SIGNIN_REQUIRED):(AnalyticsModel.logAdvertisement({token:item.token,type:"click"}),void(item.href&&(NavigationManager.location={type:"url",url:item.href.url})))},$scope.advertisementImpression=function(item){ActivityMonitor.active&&!$scope.wide&&AnalyticsModel.logAdvertisement({token:item.token,type:"impression"})},$scope.elements=ShellManager.model.elements,ShellManager.model.elementsChanged.add(function(value){$timeout(function(){return $scope.elements=value})}),$scope.advertisementsAll=[],$scope.advertisementsTop=[],$scope.advertisementsBottom=[];var mapAdvertisement=function(ad){return{src:ShellManager.getMediaUrl(ad.src,970,90),href:ad.href,type:ShellManager.getMediaType(ad.src),token:ad.token}};DataProvider.advertisements().then(function(response){$timeout(function(){$scope.advertisementsTop=response.top.map(mapAdvertisement),$scope.advertisementsBottom=response.bottom.map(mapAdvertisement),$scope.advertisementsAll=$scope.advertisementsTop.concat($scope.advertisementsBottom)})}),$scope.cartCount=OrderManager.model.orderCart.length,OrderManager.model.orderCartChanged.add(function(cart){$timeout(function(){return $scope.cartCount=cart.length})}),$scope.requestAssistance=function(){$scope.requestAssistanceAvailable&&DialogManager.confirm(ALERT_TABLE_ASSISTANCE).then(function(){var job=DialogManager.startJob();OrderManager.requestAssistance().then(function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_ASSISTANCE_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})})};var refreshAssistanceRequest=function(){$scope.requestAssistanceAvailable=!Boolean(OrderManager.model.assistanceRequest)};OrderManager.model.assistanceRequestChanged.add(refreshAssistanceRequest),refreshAssistanceRequest(),$scope.customerName=CustomerManager.customerName,CustomerManager.model.profileChanged.add(function(){$timeout(function(){return $scope.customerName=CustomerManager.customerName})}),$scope.navigate=function(destination){return NavigationManager.location=destination},NavigationManager.locationChanged.add(function(location){$timeout(function(){$scope.menus.forEach(function(menu){})})})}]),angular.module("SNAP.controllers").controller("NotificationCtrl",["$scope","$timeout","DialogManager",function($scope,$timeout,DialogManager){function updateVisibility(isVisible){$timeout(function(){$scope.visible=isVisible})}function hideNext(){for(var messages=[],i=1;i<$scope.messages.length;i++)messages.push($scope.messages[i]);return $scope.messages=messages,0===$scope.messages.length?void updateVisibility(!1):void(timer=$timeout(hideNext,4e3))}var timer;$scope.messages=[],$scope.visible=!1,DialogManager.notificationRequested.add(function(message){$timeout(function(){$scope.messages.push({text:message})}),updateVisibility(!0),timer&&$timeout.cancel(timer),timer=$timeout(hideNext,4e3)})}]),angular.module("SNAP.controllers").controller("ScreensaverCtrl",["$scope","$timeout","ShellManager","ActivityMonitor","DataProvider",function($scope,$timeout,ShellManager,ActivityMonitor,DataProvider){function showImages(values){$timeout(function(){$scope.images=values.map(function(item){return{src:ShellManager.getMediaUrl(item.media,1920,1080,"jpg"),type:ShellManager.getMediaType(item.media)}})})}$scope.visible=!1,showImages(ShellManager.model.screensavers),ShellManager.model.screensaversChanged.add(showImages),ActivityMonitor.activeChanged.add(function(value){$timeout(function(){$scope.visible=value===!1&&$scope.images&&$scope.images.length>0})})}]),angular.module("SNAP.controllers").controller("SignInCtrl",["$scope","$timeout","CustomerManager","DialogManager","NavigationManager","SessionManager","SocialManager","SNAPConfig","WebBrowser",function($scope,$timeout,CustomerManager,DialogManager,NavigationManager,SessionManager,SocialManager,SNAPConfig,WebBrowser){function socialLogin(auth){CustomerManager.loginSocial(auth).then(function(){socialBusyEnd(),$timeout(function(){return $scope.step=STEP_GUESTS})},function(){socialBusyEnd(),DialogManager.alert(ALERT_GENERIC_ERROR)})}function socialError(){socialBusyEnd(),DialogManager.alert(ALERT_GENERIC_ERROR)}function socialBusy(){socialBusyEnd(),socialJob=DialogManager.startJob(),socialTimer=$timeout(socialBusyEnd,12e4)}function socialBusyEnd(){socialJob&&(DialogManager.endJob(socialJob),socialJob=null),socialTimer&&($timeout.cancel(socialTimer),socialTimer=null)}function endSignIn(){NavigationManager.location={type:"home"}}var STEP_SPLASH=1,STEP_LOGIN=2,STEP_REGISTRATION=3,STEP_GUESTS=4,STEP_EVENT=5,STEP_RESET=6;$scope.STEP_SPLASH=STEP_SPLASH,$scope.STEP_LOGIN=STEP_LOGIN,$scope.STEP_REGISTRATION=STEP_REGISTRATION,$scope.STEP_GUESTS=STEP_GUESTS,$scope.STEP_EVENT=STEP_EVENT,$scope.STEP_RESET=STEP_RESET,$scope.locationName=SNAPConfig.location_name,$scope.login=function(){$scope.credentials={},$scope.step=STEP_LOGIN},$scope.guestLogin=function(){var job=DialogManager.startJob();CustomerManager.guestLogin().then(function(){DialogManager.endJob(job),$timeout(function(){return $scope.step=STEP_GUESTS})},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})},$scope.doLogin=function(credentials){var job=DialogManager.startJob();CustomerManager.login(credentials||$scope.credentials).then(function(){DialogManager.endJob(job),$timeout(function(){return $scope.step=STEP_GUESTS})},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_GENERIC_ERROR)})},$scope.loginFacebook=function(){socialBusy(),SocialManager.loginFacebook().then(socialLogin,socialError)},$scope.loginTwitter=function(){socialBusy(),SocialManager.loginTwitter().then(socialLogin,socialError)},$scope.loginGoogle=function(){socialBusy(),SocialManager.loginGooglePlus().then(socialLogin,socialError)},$scope.register=function(){$scope.registration={},$scope.step=STEP_REGISTRATION},$scope.doRegistration=function(){var job=DialogManager.startJob();$scope.registration.username=$scope.registration.email,CustomerManager.signUp($scope.registration).then(function(){$timeout(function(){$scope.doLogin({login:$scope.registration.username,password:$scope.registration.password})}),DialogManager.endJob(job)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})},$scope.session={guestCount:1,special:!1},$scope.submitGuestCount=function(){$scope.session.guestCount>1?(SessionManager.guestCount=$scope.session.guestCount,$scope.step=STEP_EVENT):endSignIn()},$scope.submitSpecialEvent=function(value){$scope.session.special=SessionManager.specialEvent=Boolean(value),endSignIn()},$scope.resetPassword=function(){$scope.passwordreset={},$scope.step=STEP_RESET},$scope.passwordResetSubmit=function(){var job=DialogManager.startJob();CustomerManager.resetPassword($scope.passwordreset).then(function(){DialogManager.endJob(job),$scope.passwordReset=!1,DialogManager.alert(ALERT_PASSWORD_RESET_COMPLETE)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})},$scope.passwordResetCancel=function(){$scope.step=STEP_SPLASH};var socialJob,socialTimer;if(!CustomerManager.model.isEnabled||CustomerManager.model.isAuthenticated)return endSignIn();$scope.initialized=!0,$scope.step=STEP_SPLASH;var modal=DialogManager.startModal();$scope.$on("$destroy",function(){WebBrowser.close(),DialogManager.endModal(modal)})}]),angular.module("SNAP.controllers").controller("StartupCtrl",["$scope","CommandStartup",function($scope,CommandStartup){alert("lol-ctrl")}]),angular.module("SNAP.controllers").controller("SurveyCtrl",["$scope","$timeout","AnalyticsModel","CustomerManager","CustomerModel","DialogManager","NavigationManager","OrderManager","SurveyManager",function($scope,$timeout,AnalyticsModel,CustomerManager,CustomerModel,DialogManager,NavigationManager,OrderManager,SurveyManager){if(!SurveyManager.model.isEnabled||!SurveyManager.model.feedbackSurvey||SurveyManager.model.feedbackSurveyComplete)return void(NavigationManager.location={type:"home"});$scope.comment="",$scope.email="",$scope.had_problems=!1,$scope.pages=[];var pages=$scope.$watchAsProperty("pages");$scope.pageIndex=-1;var pageIndex=$scope.$watchAsProperty("pageIndex");pageIndex.changes().subscribe(function(){$scope.page=$scope.pageIndex>-1?$scope.pages[$scope.pageIndex]:{questions:[]},$timeout(function(){$scope.page.forEach(function(item){1===item.type&&$("#rate-"+item.token).rateit({min:0,max:5,step:1,resetable:!1,backingfld:"#range-"+item.token}).bind("rated",function(event,value){item.feedback=value})})})}),$scope.pageCount=0,pages.changes().subscribe(function(){$scope.pageCount=$scope.pages.length});var generatePassword=function(){for(var length=8,charset="abcdefghknpqrstuvwxyzABCDEFGHKMNPQRSTUVWXYZ23456789",result="",i=0,n=charset.length;length>i;i++)result+=charset.charAt(Math.floor(Math.random()*n));return result},submitFeedback=function(){if($scope.pages.reduce(function(answers,page){return page.reduce(function(answers,question){var value=parseInt(question.feedback);return value>0&&answers.push({survey:SurveyManager.model.feedbackSurvey.token,question:question.token,value:value}),answers},answers)},[]).forEach(function(answer){return AnalyticsModel.logAnswer(answer)}),$scope.comment&&$scope.comment.length>0&&AnalyticsModel.logComment({type:"feedback",text:$scope.comment}),SurveyManager.model.feedbackSurveyComplete=!0,$scope.had_problems&&!OrderManager.model.assistanceRequest&&OrderManager.requestAssistance(),CustomerModel.isGuest&&$scope.email&&$scope.email.length>0){var job=DialogManager.startJob(),password=generatePassword();CustomerManager.login({email:$scope.email,password:password}).then(function(){CustomerManager.login({login:$scope.email,password:password}).then(function(){DialogManager.endJob(job),NavigationManager.location={type:"home"}},function(){DialogManager.endJob(job),NavigationManager.location={type:"home"}})},function(){DialogManager.endJob(job),NavigationManager.location={type:"home"}})}else NavigationManager.location={type:"home"}};$scope.previousPage=function(){$scope.pageIndex>0&&$scope.pageIndex--},$scope.nextPage=function(){$scope.pageIndex<$scope.pageCount-1?$scope.pageIndex++:$scope.nextStep()},$scope.nextStep=function(){CustomerModel.isGuest&&$scope.step<3?$scope.step++:!CustomerModel.isGuest&&$scope.step<2?$scope.step++:submitFeedback()},$scope.submitProblem=function(status){$scope.had_problems=Boolean(status),$scope.nextStep()},$scope.exit=function(){$scope.step>0&&submitFeedback(),NavigationManager.location={type:"home"}},function(){function buildSurvey(){SurveyManager.model.feedbackSurvey.questions.forEach(function(item){1===item.type&&((!page||page.length>4)&&(page=[],$scope.pages.push(page)),item.feedback=0,page.push(item))})}var page;$scope.has_email=CustomerModel.hasCredentials,SurveyManager.model.isEnabled&&SurveyManager.model.feedbackSurvey&&buildSurvey(),SurveyManager.model.feedbackSurveyChanged.add(function(){return buildSurvey()}),$scope.pageIndex=0,$scope.step=0}()}]),angular.module("SNAP.controllers").controller("UrlCtrl",["$scope","NavigationManager","WebBrowser",function($scope,NavigationManager,WebBrowser){WebBrowser.open(NavigationManager.location.url),$scope.$on("$destroy",function(){WebBrowser.close()})}]),angular.module("SNAP.controllers").controller("WebCtrl",["$scope","$timeout","ActivityMonitor","WebBrowser",function($scope,$timeout,ActivityMonitor,WebBrowser){$scope.navigated=function(e){return WebBrowser.navigated(e.target.src)},WebBrowser.onOpen.add(function(url){ActivityMonitor.enabled=!1,WebBrowser.isExternal||$timeout(function(){$scope.browserUrl=url,$scope.visible=!0})}),WebBrowser.onClose.add(function(){ActivityMonitor.enabled=!0,WebBrowser.isExternal||$timeout(function(){$scope.browserUrl=WebBrowser.getAppUrl("/blank"),$scope.visible=!1})})}]),angular.module("SNAP.directives",["angular-bacon"]),angular.module("SNAP.directives").directive("gallery",["ActivityMonitor","ShellManager","$timeout",function(ActivityMonitor,ShellManager,$timeout){var slider,settings={mode:"fade",wrapperClass:"photo-gallery"};return{restrict:"E",replace:!1,scope:{images:"=",imagewidth:"=?",imageheight:"=?"},templateUrl:ShellManager.getPartialUrl("gallery"),link:function(scope,elem,attrs){elem.ready(function(){slider=$(".bxslider",elem).bxSlider(settings)}),scope.$watch("images",function(){scope.medias=(scope.images||[]).map(function(image){return ShellManager.getMediaUrl(image,attrs.imagewidth,attrs.imageheight)}),settings.pager=scope.medias.length>1,$timeout(function(){return slider.reloadSlider(settings)})})}}}]),angular.module("SNAP.directives").directive("onIframeLoad",function(){return{restrict:"A",scope:{callback:"&onIframeLoad"},link:function(scope,element,attrs){element.bind("load",function(e){"function"==typeof scope.callback&&scope.callback({event:e})})}}}),angular.module("SNAP.directives").directive("onKeydown",function(){return{restrict:"A",link:function(scope,elem,attrs){var functionToCall=scope.$eval(attrs.onKeydown);elem.on("keydown",function(e){functionToCall(e.which)})}}}),angular.module("SNAP.directives").directive("quantity",["$timeout","ShellManager",function($timeout,ShellManager){return{restrict:"E",replace:!0,scope:{quantity:"=",min:"=",max:"="},link:function(scope,elem){scope.min=scope.min||1,scope.max=scope.max||9,scope.data={min:scope.min,max:scope.max,quantity:parseInt(scope.quantity)},scope.decrease=function(){scope.quantity=scope.data.quantity=scope.data.quantity>scope.data.min?scope.data.quantity-1:scope.data.min},scope.increase=function(){scope.quantity=scope.data.quantity=scope.data.quantity<scope.data.max?scope.data.quantity+1:scope.data.max}},templateUrl:ShellManager.getPartialUrl("input-quantity")}}]),angular.module("SNAP.directives").directive("scroller",["ActivityMonitor","SNAPEnvironment",function(ActivityMonitor,SNAPEnvironment){return{restrict:"C",replace:!1,link:function(scope,elem){"desktop"===SNAPEnvironment.platform&&$(elem).kinetic({y:!1,stopped:function(){ActivityMonitor.activityDetected()}})}}}]),angular.module("SNAP.directives").directive("scrollglue",["$parse",function($parse){function unboundState(initValue){var activated=initValue;return{getValue:function(){return activated},setValue:function(value){activated=value}}}function oneWayBindingState(getter,scope){return{getValue:function(){return getter(scope)},setValue:function(){}}}function twoWayBindingState(getter,setter,scope){return{getValue:function(){return getter(scope)},setValue:function(value){value!==getter(scope)&&scope.$apply(function(){setter(scope,value)})}}}function createActivationState(attr,scope){if(""!==attr){var getter=$parse(attr);return void 0!==getter.assign?twoWayBindingState(getter,getter.assign,scope):oneWayBindingState(getter,scope)}return unboundState(!0)}return{priority:1,restrict:"A",link:function(scope,$el,attrs){function scrollToBottom(){el.scrollTop=el.scrollHeight}function onScopeChanges(){activationState.getValue()&&!shouldActivateAutoScroll()&&scrollToBottom()}function shouldActivateAutoScroll(){return el.scrollTop+el.clientHeight+1>=el.scrollHeight}function onScroll(){activationState.setValue(shouldActivateAutoScroll())}var el=$el[0],activationState=createActivationState(attrs.scrollglue,scope);scope.$watch(onScopeChanges),$el.bind("scroll",onScroll)}}}]),angular.module("SNAP.directives").directive("slider",["$timeout","ShellManager",function($timeout,ShellManager){return{restrict:"AE",replace:!0,scope:{source:"=",slideclick:"=",slideshow:"=",timeout:"="},link:function(scope,elem){var timeout=scope.timeout||5e3;scope.source=scope.source||[],scope.currentIndex=-1;var changeImage=function(){if(0!==scope.source.length&&!scope.disabled){$timeout.cancel(timer),scope.source.forEach(function(entry,i){entry.visible=!1});var entry=scope.source[scope.currentIndex];if(entry.visible=!0,scope.slideshow&&scope.slideshow(entry),"video"===entry.type){var v=$("video",elem);v.attr("src",entry.src);var video=v.get(0);if(!video)return void(timer=$timeout(sliderFunc,300));var onVideoEnded=function onVideoEnded(){video.removeEventListener("ended",onVideoEnded,!1),$timeout(function(){scope.next()})},onVideoError=function onVideoError(error){video.removeEventListener("error",onVideoError,!1),$timeout(function(){scope.next()})};video.addEventListener("ended",onVideoEnded,!1),video.addEventListener("error",onVideoError,!1);try{video.load(),video.play()}catch(e){console.error("Unable to play video: "+e)}}else timer=$timeout(sliderFunc,timeout)}};scope.next=function(){scope.currentIndex<scope.source.length-1?scope.currentIndex++:scope.currentIndex=0,changeImage()},scope.prev=function(){scope.currentIndex>0?scope.currentIndex--:scope.currentIndex=scope.source.length-1,changeImage()};var timer,sliderFunc=function(){0===scope.source.length||scope.disabled||scope.next()};scope.$watch("source",function(){scope.currentIndex=-1,sliderFunc()}),scope.$watch("disabled",function(){scope.currentIndex=-1,sliderFunc()}),sliderFunc(),scope.$on("$destroy",function(){$timeout.cancel(timer)})},templateUrl:ShellManager.getPartialUrl("slider")}}]),angular.module("SNAP.directives").directive("switch",["$timeout","ShellManager",function($timeout,ShellManager){return{restrict:"E",replace:!0,scope:{disabled:"=?",selected:"=?"},link:function(scope,elem){scope.disabled=Boolean(scope.disabled),scope.selected=Boolean(scope.selected),scope.data={disabled:Boolean(scope.disabled),selected:Boolean(scope.selected),changed:!1},scope.toggle=function(){scope.disabled||(scope.selected=scope.data.selected=!scope.data.selected,scope.data.changed=!0)}},templateUrl:ShellManager.getPartialUrl("input-switch")}}]),angular.module("SNAP.filters",[]),angular.module("SNAP.filters").filter("partial",["ShellManager",function(ShellManager){return function(name){return ShellManager.getPartialUrl(name)}}]),angular.module("SNAP.filters").filter("thumbnail",["ShellManager",function(ShellManager){return function(media,width,height,extension){return ShellManager.getMediaUrl(media,width,height,extension)}}]),angular.module("SNAP.filters").filter("trustUrl",["$sce",function($sce){return function(val){return $sce.trustAsResourceUrl(val)}}]),angular.module("SNAP.services",["ngResource","SNAP.configs"]).factory("Logger",["SNAPEnvironment",function(SNAPEnvironment){return new app.Logger(SNAPEnvironment)}]).factory("$exceptionHandler",["Logger",function(Logger){return function(exception,cause){throw Logger.fatal(exception.stack,cause,exception),exception}}]).factory("CardReader",["ManagementService",function(ManagementService){return window.SnapCardReader=new app.CardReader(ManagementService),window.SnapCardReader}]).factory("DtsApi",["SNAPHosts","SessionProvider",function(SNAPHosts,SessionProvider){return new app.BackendApi(SNAPHosts,SessionProvider)}]).factory("ManagementService",["$resource","SNAPEnvironment",function($resource,SNAPEnvironment){return new app.ManagementService($resource,SNAPEnvironment)}]).factory("SessionService",["$resource",function($resource){return new app.SessionService($resource)}]).factory("SocketClient",["SessionProvider","Logger",function(SessionProvider,Logger){return new app.SocketClient(SessionProvider,Logger)}]).factory("TelemetryService",["$resource",function($resource){return new app.TelemetryService($resource)}]).factory("WebBrowser",["$window","AnalyticsModel","ManagementService","SNAPEnvironment","SNAPHosts",function($window,AnalyticsModel,ManagementService,SNAPEnvironment,SNAPHosts){return window.SnapWebBrowser=new app.WebBrowser($window,AnalyticsModel,ManagementService,SNAPEnvironment,SNAPHosts),window.SnapWebBrowser}]).factory("AppCache",["Logger",function(Logger){return new app.AppCache(Logger)}]).factory("AnalyticsModel",["StorageProvider","HeatMap",function(StorageProvider,HeatMap){return new app.AnalyticsModel(StorageProvider,HeatMap)}]).factory("CartModel",function(){return new app.CartModel}).factory("ChatModel",["SNAPConfig","SNAPEnvironment","StorageProvider",function(SNAPConfig,SNAPEnvironment,StorageProvider){return new app.ChatModel(SNAPConfig,SNAPEnvironment,StorageProvider)}]).factory("CustomerModel",["SNAPConfig","StorageProvider",function(SNAPConfig,StorageProvider){return new app.CustomerModel(SNAPConfig,StorageProvider)}]).factory("DataProvider",["SNAPConfig","DtsApi",function(SNAPConfig,DtsApi){return new app.DataProvider(SNAPConfig,DtsApi)}]).factory("HeatMap",function(){return new app.HeatMap(document.body)}).factory("LocationModel",["SNAPEnvironment","StorageProvider",function(SNAPEnvironment,StorageProvider){return new app.LocationModel(SNAPEnvironment,StorageProvider)}]).factory("OrderModel",["StorageProvider",function(StorageProvider){return new app.OrderModel(StorageProvider)}]).factory("ShellModel",function(){return new app.ShellModel}).factory("SurveyModel",["SNAPConfig","StorageProvider",function(SNAPConfig,StorageProvider){return new app.SurveyModel(SNAPConfig,StorageProvider)}]).factory("SessionProvider",["SessionService","StorageProvider",function(SessionService,StorageProvider){return new app.SessionProvider(SessionService,StorageProvider)}]).factory("StorageProvider",function(){return function(id){return new app.LocalStorageStore(id)}}).factory("ActivityMonitor",["$rootScope","$timeout",function($rootScope,$timeout){var monitor=new app.ActivityMonitor($rootScope,$timeout);return monitor.timeout=3e4,monitor}]).factory("AnalyticsManager",["TelemetryService","AnalyticsModel","Logger",function(TelemetryService,AnalyticsModel,Logger){return new app.AnalyticsManager(TelemetryService,AnalyticsModel,Logger)}]).factory("CustomerManager",["SNAPConfig","SNAPEnvironment","DtsApi","CustomerModel",function(SNAPConfig,SNAPEnvironment,DtsApi,CustomerModel){return new app.CustomerManager(SNAPConfig,SNAPEnvironment,DtsApi,CustomerModel)}]).factory("ChatManager",["AnalyticsModel","ChatModel","CustomerModel","LocationModel","SocketClient",function(AnalyticsModel,ChatModel,CustomerModel,LocationModel,SocketClient){return new app.ChatManager(AnalyticsModel,ChatModel,CustomerModel,LocationModel,SocketClient)}]).factory("DataManager",["DataProvider","Logger","SNAPEnvironment",function(DataProvider,Logger,SNAPEnvironment){return new app.DataManager(DataProvider,Logger,SNAPEnvironment)}]).factory("DialogManager",function(){return new app.DialogManager}).factory("NavigationManager",["$rootScope","$location","$window","AnalyticsModel",function($rootScope,$location,$window,AnalyticsModel){return new app.NavigationManager($rootScope,$location,$window,AnalyticsModel)}]).factory("OrderManager",["ChatModel","CustomerModel","DataProvider","DtsApi","LocationModel","OrderModel",function(ChatModel,CustomerModel,DataProvider,DtsApi,LocationModel,OrderModel){return new app.OrderManager(ChatModel,CustomerModel,DataProvider,DtsApi,LocationModel,OrderModel)}]).factory("SessionManager",["SNAPEnvironment","AnalyticsModel","CustomerModel","LocationModel","OrderModel","SurveyModel","StorageProvider","Logger",function(SNAPEnvironment,AnalyticsModel,CustomerModel,LocationModel,OrderModel,SurveyModel,StorageProvider,Logger){return new app.SessionManager(SNAPEnvironment,AnalyticsModel,CustomerModel,LocationModel,OrderModel,SurveyModel,StorageProvider,Logger)}]).factory("ShellManager",["$sce","DataProvider","ShellModel","SNAPConfig","SNAPEnvironment","SNAPHosts",function($sce,DataProvider,ShellModel,SNAPConfig,SNAPEnvironment,SNAPHosts){var manager=new app.ShellManager($sce,DataProvider,ShellModel,SNAPConfig,SNAPEnvironment,SNAPHosts);return DataProvider._getMediaUrl=function(media,width,height,extension){return manager.getMediaUrl(media,width,height,extension)},manager}]).factory("SocialManager",["SNAPEnvironment","DtsApi","WebBrowser","Logger",function(SNAPEnvironment,DtsApi,WebBrowser,Logger){return new app.SocialManager(SNAPEnvironment,DtsApi,WebBrowser,Logger)}]).factory("SoftwareManager",["SNAPEnvironment",function(SNAPEnvironment){return new app.SoftwareManager(SNAPEnvironment)}]).factory("SurveyManager",["DataProvider","SurveyModel",function(DataProvider,SurveyModel){return new app.SurveyManager(DataProvider,SurveyModel)}]);
//# sourceMappingURL=snap.min.js.map