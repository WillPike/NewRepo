"use strict";function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _get=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;desc=parent=getter=void 0,_again=!1,null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return void 0;_x=parent,_x2=property,_x3=receiver,_again=!0}},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();window.app={};var ALERT_REQUEST_SUBMIT_ERROR=1,ALERT_REQUEST_ASSISTANCE_SENT=10,ALERT_REQUEST_ASSISTANCE_RECEIVED=11,ALERT_REQUEST_CLOSEOUT_SENT=20,ALERT_REQUEST_CLOSEOUT_RECEIVED=21,ALERT_REQUEST_ORDER_SENT=30,ALERT_REQUEST_ORDER_RECEIVED=31,ALERT_SIGNIN_REQUIRED=40,ALERT_TABLE_RESET=50,ALERT_TABLE_ASSISTANCE=51,ALERT_TABLE_CLOSEOUT=52,ALERT_GENERIC_ERROR=100,ALERT_DELET_CARD=200,ALERT_PASSWORD_RESET_COMPLETE=210,ALERT_SOFTWARE_OUTDATED=220,ALERT_CARDREADER_ERROR=310,ALERT_ERROR_NO_SEAT=410,ALERT_ERROR_STARTUP=510;window.app.AnalyticsData=function(){function AnalyticsData(name,storageProvider,defaultValue){_classCallCheck(this,AnalyticsData),this._defaultValue=defaultValue||function(){return[]},this._name=name,this._data=this._defaultValue(),this._store=storageProvider("snap_analytics_"+name)}return _createClass(AnalyticsData,[{key:"initialize",value:function(){var self=this;return this._store.read().then(function(data){return self._data=data||self._data})}},{key:"push",value:function(item){this._data.push(item),this.store()}},{key:"reset",value:function(){return this._data=this._defaultValue(),this.store()}},{key:"store",value:function(){return this._store.write(this._data)}},{key:"name",get:function(){return this._name}},{key:"data",get:function(){return this._data},set:function(value){this._data=value,this.store()}},{key:"length",get:function(){return this._data.length}},{key:"last",get:function(){return this._data[this.length-1]}}]),AnalyticsData}(),window.app.CartItem=function(){function CartItem(item,quantity,name,modifiers,request){_classCallCheck(this,CartItem),this.item=item,this.quantity=quantity,this.name=name,this.request=request,this.hasModifiers?modifiers?this.modifiers=modifiers:this.modifiers=item.modifiers.map(function(category){return new app.CartModifierCategory(category,category.items.map(function(modifier){return new app.CartModifier(modifier)}))}):this.modifiers=[]}return _createClass(CartItem,[{key:"clone",value:function(count){return new app.CartItem(this.item,this.quantity,this.name,this.modifiers.map(function(category){return category.clone()}),this.request)}},{key:"cloneMany",value:function(count){count=count||this.quantity;for(var result=[],i=0;count>i;i++)result.push(new app.CartItem(this.item,1,this.name,this.modifiers.map(function(category){return category.clone()}),this.request));return result}},{key:"restore",value:function(data){return new app.CartItem(data.item,data.quantity,data.name,data.modifiers.map(app.CartModifierCategory.prototype.restore),data.request)}},{key:"hasModifiers",get:function(){return null!==this.item.modifiers&&this.item.modifiers.length>0}},{key:"selectedModifiers",get:function(){return this.modifiers.reduce(function(previousCategory,category,i,array){return array.concat(category.items.filter(function(modifier){return modifier.isSelected}))},[])}}]),CartItem}(),function(){var CartModifier=function(data,isSelected){this.data=data,this.isSelected=isSelected||!1};CartModifier.prototype.clone=function(){return new app.CartModifier(this.data,this.isSelected)},CartModifier.prototype.restore=function(data){return new app.CartModifier(data.data,data.isSelected)},window.app.CartModifier=CartModifier;var CartModifierCategory=function(data,modifiers){this.data=data,this.modifiers=modifiers};CartModifierCategory.prototype.clone=function(){var modifiers=this.modifiers.map(function(modifier){return modifier.clone()});return new app.CartModifierCategory(this.data,modifiers)},CartModifierCategory.prototype.restore=function(data){return new app.CartModifierCategory(data.data,data.modifiers.map(CartModifier.prototype.restore))},window.app.CartModifierCategory=CartModifierCategory}(),window.app.RequestWatcher=function(){function RequestWatcher(ticket,DtsApi){_classCallCheck(this,RequestWatcher),this._token=ticket.token,this._remote=DtsApi,this.POLLING_INTERVAL=5e3,this.REQUEST_STATUS_PENDING=1,this.REQUEST_STATUS_RECEIVED=2,this.REQUEST_STATUS_ACCEPTED=3,this.REQUEST_STATUS_EXPIRED=255;var self=this;this._promise=new Promise(function(resolve,reject){self._statusUpdateResolve=resolve,self._statusUpdateReject=reject}),this._ticket={status:0},this._watchStatus()}return _createClass(RequestWatcher,[{key:"dispose",value:function(){this._timeoutId&&window.clearTimeout(this._timeoutId),this._ticket.status<this.REQUEST_STATUS_ACCEPTED&&this._statusUpdateReject()}},{key:"_watchStatus",value:function(){var self=this;self._timeoutId&&window.clearTimeout(self._timeoutId);var onTimeout=function(){self._remote.waiter.getStatus(self._token).then(function(response){self._setTicket(response),self._watchStatus()},function(){self._watchStatus()})};self._ticket.status===self.REQUEST_STATUS_ACCEPTED?self._statusUpdateResolve():self._ticket.status!==self.REQUEST_STATUS_EXPIRED&&(self._timeoutId=window.setTimeout(onTimeout,this.POLLING_INTERVAL))}},{key:"_setTicket",value:function(value){var self=this;self._ticket.status!==value.status&&(self._ticket=value,self._watchStatus())}},{key:"token",get:function(){return this._token}},{key:"ticket",get:function(){return this._ticket}},{key:"promise",get:function(){return this._promise}}]),RequestWatcher}(),window.app.WebBrowserReference=function(){function WebBrowserReference(type,initialUrl){var _this=this;_classCallCheck(this,WebBrowserReference),this.type=type,this._initialUrl=this._url=initialUrl,this.onNavigated=new signals.Signal,this.onExit=new signals.Signal,this.onNavigated.add(function(url){return _this._url=url})}return _createClass(WebBrowserReference,[{key:"attach",value:function(reference){if(this._reference)throw new Error("Web browser reference is already attached.");this._reference=reference}},{key:"navigate",value:function(url){this.onNavigated.dispatch(url)}},{key:"exit",value:function(){this.onExit.dispatch(),this.onNavigated.dispose(),this.onExit.dispose()}},{key:"url",get:function(){return this._url}}]),WebBrowserReference}(),window.app.IframeWebBrowserReference=function(_app$WebBrowserReference){function IframeWebBrowserReference(initialUrl){_classCallCheck(this,IframeWebBrowserReference),_get(Object.getPrototypeOf(IframeWebBrowserReference.prototype),"constructor",this).call(this,"iframe",initialUrl)}return _inherits(IframeWebBrowserReference,_app$WebBrowserReference),_createClass(IframeWebBrowserReference,[{key:"attach",value:function(reference){function onLoad(e){self.onNavigated.dispatch(e.url)}_get(Object.getPrototypeOf(IframeWebBrowserReference.prototype),"attach",this).call(this,reference);var self=this;this._onLoad=onLoad,this._reference.addEventListener("loadstart",this._onLoad),this._reference.src=this._initialUrl}},{key:"exit",value:function(){_get(Object.getPrototypeOf(IframeWebBrowserReference.prototype),"exit",this).call(this),this._reference&&(this._reference.removeEventListener("loadstart",this._onLoad),this._reference.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),this._reference=null}}]),IframeWebBrowserReference}(app.WebBrowserReference),window.app.WebViewBrowserReference=function(_app$WebBrowserReference2){function WebViewBrowserReference(initialUrl){_classCallCheck(this,WebViewBrowserReference),_get(Object.getPrototypeOf(WebViewBrowserReference.prototype),"constructor",this).call(this,"webview",initialUrl)}return _inherits(WebViewBrowserReference,_app$WebBrowserReference2),_createClass(WebViewBrowserReference,[{key:"attach",value:function(reference){function onLoad(e){self.onNavigated.dispatch(self._reference.getUrl())}_get(Object.getPrototypeOf(WebViewBrowserReference.prototype),"attach",this).call(this,reference);var self=this;this._onLoad=onLoad,this._reference.addEventListener("did-stop-loading",this._onLoad),this._reference.src=this._initialUrl}},{key:"exit",value:function(){_get(Object.getPrototypeOf(WebViewBrowserReference.prototype),"exit",this).call(this),this._reference&&(this._reference.removeEventListener("did-stop-loading",this._onLoad),this._reference.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),this._reference=null}}]),WebViewBrowserReference}(app.WebBrowserReference),window.app.CordovaWebBrowserReference=function(_app$WebBrowserReference3){function CordovaWebBrowserReference(initialUrl){_classCallCheck(this,CordovaWebBrowserReference),_get(Object.getPrototypeOf(CordovaWebBrowserReference.prototype),"constructor",this).call(this,"external",initialUrl)}return _inherits(CordovaWebBrowserReference,_app$WebBrowserReference3),_createClass(CordovaWebBrowserReference,[{key:"attach",value:function(reference){function onLoadStart(e){self.onNavigated.dispatch(e.url)}function onExit(){self.exit()}_get(Object.getPrototypeOf(CordovaWebBrowserReference.prototype),"attach",this).call(this,reference);var self=this;this._onLoadStart=onLoadStart,this._onExit=onExit,this._reference.addEventListener("loadstart",this._onLoadStart),this._reference.addEventListener("exit",this._onExit),this.onNavigated.dispatch(this._initialUrl)}},{key:"exit",value:function(){_get(Object.getPrototypeOf(CordovaWebBrowserReference.prototype),"exit",this).call(this),this._reference&&(this._reference.removeEventListener("loadstart",this._onLoadStart),this._reference.removeEventListener("exit",this._onExit),this._reference.close()),this._reference=null}}]),CordovaWebBrowserReference}(app.WebBrowserReference),window.app.AbstractManager=function(){function AbstractManager(Logger){_classCallCheck(this,AbstractManager),this._Logger=Logger}return _createClass(AbstractManager,[{key:"initialize",value:function(){return this._Logger.debug("Initializing "+this.constructor.name+"..."),Promise.resolve()}},{key:"reset",value:function(){this._Logger.debug("Resetting "+this.constructor.name+"...")}}]),AbstractManager}(),function(){var ActivityMonitor=function($rootScope,$timeout){this.$$rootScope=$rootScope,this.$$timeout=$timeout,this._timeout=1e4,this._activeChanged=new signals.Signal,this.enabled=!0;var self=this;this.$$rootScope.$on("$locationChangeSuccess",function(){self.enabled&&self.activityDetected()}),this.activityDetected()};ActivityMonitor.prototype={},Object.defineProperty(ActivityMonitor.prototype,"timeout",{get:function(){return this._timeout},set:function(value){value>0&&(this._timeout=value,this.activityDetected())}}),Object.defineProperty(ActivityMonitor.prototype,"enabled",{get:function(){return this._enabled},set:function(value){this._enabled=value}}),Object.defineProperty(ActivityMonitor.prototype,"active",{get:function(){return null!==this._timer}}),Object.defineProperty(ActivityMonitor.prototype,"activeChanged",{get:function(){return this._activeChanged}}),ActivityMonitor.prototype.activityDetected=function(){var changed;this._timer?this.$$timeout.cancel(this._timer):null===this._timer&&(changed=!0);var self=this,onTimeout=function(){self._timer=null,self.$$rootScope.$apply(function(){self.enabled&&self.activeChanged.dispatch(self.active)})};this._timer=this.$$timeout(onTimeout,this._timeout),changed&&this.enabled&&this.activeChanged.dispatch(this.active)},window.app.ActivityMonitor=ActivityMonitor}(),window.app.AnalyticsManager=function(_app$AbstractManager){function AnalyticsManager(TelemetryService,AnalyticsModel,Logger){_classCallCheck(this,AnalyticsManager),_get(Object.getPrototypeOf(AnalyticsManager.prototype),"constructor",this).call(this,Logger),this._TelemetryService=TelemetryService,this._AnalyticsModel=AnalyticsModel}return _inherits(AnalyticsManager,_app$AbstractManager),_createClass(AnalyticsManager,[{key:"initialize",value:function(){return _get(Object.getPrototypeOf(AnalyticsManager.prototype),"initialize",this).call(this),this.model.initialize()}},{key:"reset",value:function(){return _get(Object.getPrototypeOf(AnalyticsManager.prototype),"reset",this).call(this),this.model.reset()}},{key:"submit",value:function(){return this._Logger.debug("Submitting analytics data with "+(this.model.sessions.length+" seat sessions, ")+(this.model.answers.length+" answers, ")+(this.model.chats.length+" chats, ")+(this.model.comments.length+" comments, ")+(this.model.clicks.length+" clicks, ")+(this.model.pages.length+" pages, ")+(this.model.advertisements.length+" advertisements and ")+(this.model.urls.length+" URLs.")),this.reset()}},{key:"model",get:function(){return this._AnalyticsModel}}]),AnalyticsManager}(app.AbstractManager),window.app.AuthenticationManager=function(_app$AbstractManager2){function AuthenticationManager(BackendApi,SessionModel,SNAPEnvironment,WebBrowser,Logger){_classCallCheck(this,AuthenticationManager),_get(Object.getPrototypeOf(AuthenticationManager.prototype),"constructor",this).call(this,Logger),this._BackendApi=BackendApi,this._SessionModel=SessionModel,this._SNAPEnvironment=SNAPEnvironment,this._WebBrowser=WebBrowser}return _inherits(AuthenticationManager,_app$AbstractManager2),_createClass(AuthenticationManager,[{key:"validate",value:function(){var _this2=this,model=this._SessionModel;return this._Logger.debug("Validating access token..."),new Promise(function(resolve,reject){model.initialize().then(function(){var token=model.apiToken;token&&_this2._validateToken(token)?(_this2._Logger.debug("Validating authorization session..."),_this2._BackendApi.oauth2.getSession().then(function(session){session=URI("?"+session).query(!0),session&&"true"===session.valid?(_this2._Logger.debug("Authorization is valid.",session),resolve(!0)):(_this2._Logger.debug("Authorization is not valid or expired.",session),resolve(!1))},function(e){_this2._Logger.debug("Unable to validate authorization.",e),resolve(null)})):(_this2._Logger.debug("Authorization is not valid."),resolve(!1))},function(e){_this2._Logger.debug("Error validating authorization.",e),resolve(null)})})}},{key:"authorize",value:function(){var _this3=this;this._Logger.debug("Authorizing API access...");var self=this;return new Promise(function(resolve,reject){_this3._SessionModel.clear().then(function(){var application=_this3._SNAPEnvironment.main_application,authUrl=_this3._BackendApi.oauth2.getTokenAuthorizeUrl(application.client_id,application.callback_url,application.scope);_this3._WebBrowser.open(authUrl).then(function(browser){function handleCallback(url){if(0===url.indexOf(application.callback_url)){complete=!0,browser.exit();for(var callbackResponse=url.split("#")[1],responseParameters=callbackResponse.split("&"),parameterMap=[],i=0;i<responseParameters.length;i++)parameterMap[responseParameters[i].split("=")[0]]=responseParameters[i].split("=")[1];if(void 0!==parameterMap.access_token&&null!==parameterMap.access_token){var token={access_token:parameterMap.access_token,expires_in:parameterMap.expires_in};return self._Logger.debug("New access token issued.",token),self._SessionModel.apiToken=token,resolve()}self._Logger.debug("Problem issuing new access token.",parameterMap),reject("Problem authenticating: "+url)}}var complete=!1;browser.onNavigated.add(function(url){return handleCallback(url)}),browser.onExit.add(function(){complete||reject("Canceled")})},reject)},reject)})}},{key:"customerLoginRegular",value:function(credentials){var _this4=this;return new Promise(function(resolve,reject){var application=_this4._SNAPEnvironment.customer_application;_this4._BackendApi.oauth2.getTokenWithCredentials(application.client_id,credentials.login,credentials.password).then(function(result){if(!result)return reject();if(result=JSON.parse(result),result.error||!result.access_token)return reject(result.error);var session={access_token:result.access_token};result.expires_in&&(session.expires=moment().add(result.expires_in,"seconds").unix()),_this4._SessionModel.customerToken=session,resolve()},reject)})}},{key:"customerLoginSocial",value:function(token){var _this5=this;return new Promise(function(resolve,reject){var session={access_token:token.access_token};token.expires_in&&(session.expires=moment().add(token.expires_in,"seconds").unix()),_this5._SessionModel.customerToken=session,resolve()})}},{key:"_validateToken",value:function(token){if(!token||!token.access_token)return!1;if(token.expires){var expires=moment.unix(token.expires);if(expires.isBefore(moment()))return!1}return!0}}]),AuthenticationManager}(app.AbstractManager),window.app.ChatManager=function(_app$AbstractManager3){function ChatManager(AnalyticsModel,ChatModel,CustomerModel,LocationModel,SocketClient,Logger){_classCallCheck(this,ChatManager),_get(Object.getPrototypeOf(ChatManager.prototype),"constructor",this).call(this,Logger);var self=this;this.MESSAGE_TYPES={LOCATION:"location",DEVICE:"device"},this.MESSAGE_STATUSES={CHAT_REQUEST:"chat_request",CHAT_REQUEST_ACCEPTED:"chat_request_accepted",CHAT_REQUEST_DECLINED:"chat_request_declined",GIFT_REQUEST:"gift_request",GIFT_REQUEST_ACCEPTED:"gift_request_accepted",GIFT_REQUEST_DECLINED:"gift_request_declined",CHAT_CLOSED:"chat_closed"},this.OPERATIONS={CHAT_MESSAGE:"chat_message",STATUS_REQUEST:"status_request",STATUS_UPDATE:"status_update"},this.ROOMS={LOCATION:"location_",DEVICE:"device_"},this._AnalyticsModel=AnalyticsModel,this._ChatModel=ChatModel,this._CustomerModel=CustomerModel,this._LocationModel=LocationModel,this._SocketClient=SocketClient,this._ChatModel.isEnabledChanged.add(function(){return self._sendStatusUpdate()}),this._ChatModel.isPresentChanged.add(function(){return self._sendStatusUpdate()}),this._CustomerModel.profileChanged.add(function(){return self._sendStatusUpdate()}),this._LocationModel.seatChanged.add(function(){return self._sendStatusUpdate()}),this._SocketClient.isConnectedChanged.add(function(isConnected){self.model.isConnected=isConnected,self._sendStatusUpdate(),self._sendStatusRequest()}),this._SocketClient.subscribe(this.ROOMS.LOCATION+this._LocationModel.location.token,function(message){switch(message.operation){case self.OPERATIONS.CHAT_MESSAGE:self._onMessage(message);break;case self.OPERATIONS.STATUS_REQUEST:self._onStatusRequest(message);break;case self.OPERATIONS.STATUS_UPDATE:self._onStatusUpdate(message)}}),this._SocketClient.subscribe(this.ROOMS.DEVICE+this._LocationModel.device,function(message){switch(message.operation){case self.OPERATIONS.CHAT_MESSAGE:self._onMessage(message);break;case self.OPERATIONS.STATUS_UPDATE:self._onStatusUpdate(message)}})}return _inherits(ChatManager,_app$AbstractManager3),_createClass(ChatManager,[{key:"reset",value:function(){return _get(Object.getPrototypeOf(ChatManager.prototype),"reset",this).call(this),this.model.reset(),Promise.resolve()}},{key:"sendMessage",value:function(message){message.device=this._LocationModel.device,message.operation=this.OPERATIONS.CHAT_MESSAGE,message.type=message.to_device?this.MESSAGE_TYPES.DEVICE:this.MESSAGE_TYPES.LOCATION,this._addMessageID(message),this.model.addHistory(message);var topic=this._getTopic(message);this._SocketClient.send(topic,message),this._AnalyticsModel.logChat(message)}},{key:"approveDevice",value:function(token){var device=this._LocationModel.getDevice(token);this.model.setLastRead(token,moment().unix()),this.model.isPendingDevice(device)?(this.model.removePendingDevice(device),this.sendMessage({status:this.MESSAGE_STATUSES.CHAT_REQUEST_ACCEPTED,to_device:device.token})):this.sendMessage({status:this.MESSAGE_STATUSES.CHAT_REQUEST,to_device:device.token}),this.model.isActiveDevice(device)||this.model.addActiveDevice(device)}},{key:"declineDevice",value:function(token){var device=this._LocationModel.getDevice(token);this.model.isActiveDevice(device)?(this.model.removeActiveDevice(device),this.sendMessage({status:this.MESSAGE_STATUSES.CHAT_CLOSED,to_device:device.token})):this.sendMessage({status:this.MESSAGE_STATUSES.CHAT_REQUEST_DECLINED,to_device:device.token})}},{key:"getMessageName",value:function(message){return this._LocationModel.device===message.device?"Me":message.username||this.getDeviceName(message.device)}},{key:"getDeviceName",value:function(token){var device=this._LocationModel.getDevice(token);if(device){if(this._LocationModel.device===device.token)return"Me";if(device.username)return device.username;for(var p in this._LocationModel.seats)if(this._LocationModel.seats[p].token===device.seat)return this._LocationModel.seats[p].name}return"Guest"}},{key:"checkIfUnread",value:function(device_token,message){var lastRead=this.model.getLastRead(device_token);return lastRead?message?moment.unix(message.received).isAfter(moment.unix(lastRead)):this.getUnreadCount(device_token)>0:!1}},{key:"getUnreadCount",value:function(device_token){var lastRead=this.model.getLastRead(device_token);if(!lastRead)return 0;var self=this,fromDate=moment.unix(lastRead);return this.model.history.filter(function(message){return message.type===self.MESSAGE_TYPES.DEVICE&&message.device===device_token}).filter(function(message){return moment.unix(message.received).isAfter(fromDate)}).length}},{key:"markAsRead",value:function(device_token){this.model.setLastRead(device_token,moment().unix())}},{key:"sendGift",value:function(items){this.model.giftDevice&&this.sendMessage({status:this.MESSAGE_STATUSES.GIFT_REQUEST,to_device:this.model.giftDevice,text:items.reduce(function(result,item){return""!==result&&(result+=", "),result+=item.item.title},"")})}},{key:"acceptGift",value:function(device){this.sendMessage({status:this.MESSAGE_STATUSES.GIFT_REQUEST_ACCEPTED,to_device:device.token})}},{key:"declineGift",value:function(device){this.sendMessage({status:this.MESSAGE_STATUSES.GIFT_REQUEST_DECLINED,to_device:device.token})}},{key:"startGift",value:function(device_token){var device=this._LocationModel.getDevice(device_token);this.model.giftDevice=device_token,this.model.giftSeat=device.seat}},{key:"endGift",value:function(){this.model.giftDevice=null,this.model.giftSeat=null}},{key:"_onMessage",value:function(message){if(message.id&&!(this.model.history.filter(function(msg){return msg.id===message.id}).length>0)){message.received=moment().unix();var device=this._LocationModel.getDevice(message.device),giftDevice=this.model.giftDevice;this._LocationModel.seat.token;device&&(message.status!==this.MESSAGE_STATUSES.CHAT_REQUEST||this.model.isPendingDevice(device)||this.model.isActiveDevice(device)||(this.model.addPendingDevice(device),this.model.chatRequestReceived.dispatch(device.token)),message.status===this.MESSAGE_STATUSES.GIFT_REQUEST&&this.model.isActiveDevice(device)&&this.model.giftRequestReceived.dispatch(device,message.text),message.to_device&&(message.status===this.MESSAGE_STATUSES.GIFT_REQUEST_ACCEPTED?giftDevice&&giftDevice===message.device&&(this.model.giftAccepted.dispatch(!0),this.model.giftDevice=null):message.status===this.MESSAGE_STATUSES.GIFT_REQUEST_DECLINED?giftDevice&&giftDevice===message.device&&(this.model.giftAccepted.dispatch(!1),this.model.giftDevice=null):message.status===this.MESSAGE_STATUSES.CHAT_REQUEST_DECLINED&&this.declineDevice(device)),message.operation===this.OPERATIONS.CHAT_MESSAGE&&(message.username=this.getDeviceName(device),this.model.addHistory(message)),this.model.messageReceived.dispatch(message))}}},{key:"_onStatusRequest",value:function(message){message.device!==this._LocationModel.device&&this._sendStatusUpdate(message.device)}},{key:"_onStatusUpdate",value:function(message){if(message.device!==this._LocationModel.device){var device=this._LocationModel.getDevice(message.device);if(device||(device={token:message.device},this._LocationModel.addDevice(device)),!message.is_available&&device.is_available){var _history={operation:this.OPERATIONS.CHAT_MESSAGE,type:this.MESSAGE_TYPES.DEVICE,device:device.token,status:this.MESSAGE_STATUSES.CHAT_CLOSED,to_device:this._LocationModel.device};this._addMessageID(_history),this.model.addHistory(_history)}device.is_available=Boolean(message.is_available),device.is_present=Boolean(message.is_present),device.seat=message.seat,device.username=message.username,this._LocationModel.devicesChanged.dispatch(this._LocationModel.devices)}}},{key:"_sendStatusRequest",value:function(){if(this.model.isConnected){var message={operation:this.OPERATIONS.STATUS_REQUEST,device:this._LocationModel.device};this._SocketClient.send(this._getTopic(message),message)}}},{key:"_sendStatusUpdate",value:function(device){if(this.model.isConnected){var profile=this._CustomerModel.profile,username=void 0;profile&&profile.first_name&&(username=profile.first_name+" "+profile.last_name);var message={operation:this.OPERATIONS.STATUS_UPDATE,to_device:device,device:this._LocationModel.device,seat:this._LocationModel.seat.token,is_available:this.model.isEnabled,is_present:this.model.isPresent,username:username};this._SocketClient.send(this._getTopic(message),message)}}},{key:"_getTopic",value:function(message){return message.to_device?this.ROOMS.DEVICE+message.to_device:this.ROOMS.LOCATION+this._LocationModel.location.token}},{key:"_addMessageID",value:function(message){message.id=message.id||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"===c?r:3&r|8;return v.toString(16)})}},{key:"model",get:function(){return this._ChatModel}}]),ChatManager}(app.AbstractManager),window.app.CustomerManager=function(_app$AbstractManager4){function CustomerManager(DtsApi,CustomerModel,SessionModel,Logger,SNAPEnvironment){_classCallCheck(this,CustomerManager),_get(Object.getPrototypeOf(CustomerManager.prototype),"constructor",this).call(this,Logger),this._DtsApi=DtsApi,this._CustomerModel=CustomerModel,this._SessionModel=SessionModel,this._customerAppId=SNAPEnvironment.customer_application.client_id}return _inherits(CustomerManager,_app$AbstractManager4),_createClass(CustomerManager,[{key:"reset",value:function(){return _get(Object.getPrototypeOf(CustomerManager.prototype),"reset",this).call(this),this.logout()}},{key:"logout",value:function(){var self=this;return new Promise(function(resolve){self._SessionModel.customerToken=null,self._CustomerModel.profile=null,resolve()})}},{key:"guestLogin",value:function(){var self=this;return new Promise(function(resolve){self._CustomerModel.profile="guest",resolve()})}},{key:"login",value:function(){return this._loadProfile()}},{key:"loginSocial",value:function(){return this._loadProfile()}},{key:"signUp",value:function(registration){var self=this;return new Promise(function(resolve,reject){registration.client_id=self._customerAppId,self._DtsApi.customer.signUp(registration).then(function(){self.login({login:registration.username,password:registration.password}).then(resolve,reject)},reject)})}},{key:"updateProfile",value:function(profile){var self=this;return new Promise(function(resolve,reject){self._DtsApi.customer.updateProfile(profile).then(function(){self._CustomerModel.profile=profile,resolve()},reject)})}},{key:"changePassword",value:function(request){var self=this;return new Promise(function(resolve,reject){self._DtsApi.customer.changePassword(request).then(function(){self.login({login:self._CustomerModel.email,password:request.new_password}).then(resolve,reject)},reject)})}},{key:"resetPassword",value:function(request){var self=this;return new Promise(function(resolve,reject){self._DtsApi.customer.resetPassword(request).then(function(){resolve()},reject)})}},{key:"_loadProfile",value:function(){var self=this;return new Promise(function(resolve,reject){self._DtsApi.customer.getProfile().then(function(profile){self._CustomerModel.profile=profile,resolve()},reject)})}},{key:"model",get:function(){return this._CustomerModel}},{key:"customerName",get:function(){if(this.model.isEnabled&&this.model.isAuthenticated&&!this.model.isGuest){var name="";return this.model.profile.first_name&&(name+=this.model.profile.first_name),this.model.profile.last_name&&(name+=" "+this.model.profile.last_name),name}return null}}]),CustomerManager}(app.AbstractManager),window.app.DataManager=function(_app$AbstractManager5){function DataManager(DataModel,Logger,SNAPEnvironment){_classCallCheck(this,DataManager),_get(Object.getPrototypeOf(DataManager.prototype),"constructor",this).call(this,Logger),this._DataModel=DataModel,this._SNAPEnvironment=SNAPEnvironment,this.homeChanged=new signals.Signal,this.menuChanged=new signals.Signal,this.categoryChanged=new signals.Signal,this.itemChanged=new signals.Signal,this._CACHEABLE_MEDIA_KINDS=[11,41,51,58,61]}return _inherits(DataManager,_app$AbstractManager5),_createClass(DataManager,[{key:"initialize",value:function(){_get(Object.getPrototypeOf(DataManager.prototype),"initialize",this).call(this);var self=this;return this._cache={menu:{},category:{},item:{},media:{}},this.model.digest().then(function(digest){var menuSets=(digest.menu_sets||[]).map(function(menu){return new Promise(function(resolve,reject){self.model.menu(menu.token).then(function(data){return self._cache.menu[menu.token]=self._filterMenu(data)}).then(resolve,resolve)})}),menuCategories=(digest.menu_categories||[]).map(function(category){return new Promise(function(resolve,reject){self.model.category(category.token).then(function(data){return self._cache.category[category.token]=self._filterCategory(data)}).then(resolve,resolve)})}),menuItems=(digest.menu_items||[]).map(function(item){return new Promise(function(resolve,reject){self.model.item(item.token).then(function(data){return self._cache.item[item.token]=data}).then(resolve,resolve)})}),medias=(digest.media||[]).filter(function(media){return-1!==self._CACHEABLE_MEDIA_KINDS.indexOf(media.kind)}).map(function(media){var width,height;switch(media.kind){case 11:width=1920,height=1080;break;case 41:case 51:width=370,height=370;break;case 58:width=600,height=600;break;case 61:width=100,height=100}return media.width=width,media.height=height,media}).map(function(media){return new Promise(function(resolve,reject){self.model.media(media).then(function(img){return self._cache.media[media.token]=img}).then(resolve,resolve)})});self._Logger.debug("Digest contains "+menuSets.length+" menus, "+(menuCategories.length+" categories, ")+(menuItems.length+" items and ")+(medias.length+" files."));var tasks=[].concat(menuSets).concat(menuCategories).concat(menuItems);Promise.all(tasks).then(function(){Promise.all(medias)})})}},{key:"reset",value:function(){return _get(Object.getPrototypeOf(DataManager.prototype),"reset",this).call(this),this.model.clear()}},{key:"_cached",value:function(group,id){return this._cache?id&&this._cache[group]&&this._cache[group][id]?this._cache[group][id]:!id&&this._cache[group]?this._cache[group]:null:null}},{key:"_filterHome",value:function(data){var self=this;return data.menus=data.menus.filter(function(menu){return"desktop"===self._SNAPEnvironment.platform||3!==menu.type;
}),data}},{key:"_filterMenu",value:function(data){return data}},{key:"_filterCategory",value:function(data){var self=this;return data.items=data.items.filter(function(item){return"desktop"===self._SNAPEnvironment.platform||3!==item.type}),data}},{key:"model",get:function(){return this._DataModel}},{key:"home",get:function(){return this._home},set:function(value){if(this._home!==value)if(value){var self=this;this._home=value,this.model.home().then(function(home){self._home&&(home=self._filterHome(home),self.homeChanged.dispatch(home))})}else this._home=void 0,this.homeChanged.dispatch(void 0)}},{key:"menu",get:function(){return this._menu},set:function(value){if(this._menu!==value)if(value){var self=this;this._menu=value;var data=this._cached("menu",value);if(data)return this.menuChanged.dispatch(data);this.model.menu(value).then(function(menu){self._menu&&(menu=self._filterMenu(menu),self.menuChanged.dispatch(menu))})}else this._menu=void 0,this.menuChanged.dispatch(void 0)}},{key:"category",get:function(){return this._category},set:function(value){if(this._category!==value)if(value){var self=this;this._category=value;var data=this._cached("category",value);if(data)return this.categoryChanged.dispatch(data);this.model.category(value).then(function(category){self._category&&(category=self._filterCategory(category),self.categoryChanged.dispatch(category))})}else this._category=void 0,this.categoryChanged.dispatch(void 0)}},{key:"item",get:function(){return this._item},set:function(value){if(this._item!==value)if(value){var self=this;this._item=value;var data=this._cached("item",value);if(data)return this.itemChanged.dispatch(data);this.model.item(value).then(function(item){self._item&&self.itemChanged.dispatch(item)})}else this._item=void 0,this.itemChanged.dispatch(void 0)}}]),DataManager}(app.AbstractManager),window.app.DialogManager=function(_app$AbstractManager6){function DialogManager(Logger){_classCallCheck(this,DialogManager),_get(Object.getPrototypeOf(DialogManager.prototype),"constructor",this).call(this,Logger),this.alertRequested=new signals.Signal,this.notificationRequested=new signals.Signal,this.confirmRequested=new signals.Signal,this.jobStarted=new signals.Signal,this.jobEnded=new signals.Signal,this._jobs=0}return _inherits(DialogManager,_app$AbstractManager6),_createClass(DialogManager,[{key:"alert",value:function(message,title){var self=this;return new Promise(function(resolve,reject){self.alertRequested.dispatch(message,title,resolve,reject)})}},{key:"notification",value:function(message){this.notificationRequested.dispatch(message)}},{key:"confirm",value:function(message){var self=this;return new Promise(function(resolve,reject){self.confirmRequested.dispatch(message,resolve,reject)})}},{key:"startJob",value:function(){return this._jobs++,1===this._jobs&&this.jobStarted.dispatch(),this._jobs}},{key:"endJob",value:function(id){this._jobs--,0===this._jobs&&this.jobEnded.dispatch()}},{key:"jobs",get:function(){return this._jobs}}]),DialogManager}(app.AbstractManager),window.app.LocationManager=function(_app$AbstractManager7){function LocationManager(DataModel,DtsApi,LocationModel,Logger){_classCallCheck(this,LocationManager),_get(Object.getPrototypeOf(LocationManager.prototype),"constructor",this).call(this,Logger),this._DataModel=DataModel,this._DtsApi=DtsApi,this._LocationModel=LocationModel}return _inherits(LocationManager,_app$AbstractManager7),_createClass(LocationManager,[{key:"loadConfig",value:function(){var self=this,model=self._LocationModel;return new Promise(function(resolve,reject){function loadConfig(){self._Logger.debug("Loading location config..."),model.fetch("location").then(function(location){self._Logger.debug("New '"+location.location_name+"' location config loaded."),resolve(location)},function(e){return model.location?(self._Logger.debug("Fallback to stored location '"+model.location.location_name+"'."),void resolve(model.location)):reject(e)})}model.initialize().then(function(){self._Logger.debug("Loading device info..."),model.fetch("device").then(function(device){self._Logger.debug("New device loaded: token="+device.token+";location="+device.location_token),loadConfig()},function(e){return model.device?(self._Logger.debug("Fallback to stored device: token="+model.device.token+";location="+model.device.location_token),void loadConfig()):reject(e)})},reject)})}},{key:"loadSeats",value:function(){var self=this,model=self._LocationModel;return new Promise(function(resolve,reject){function loadSeat(){self._Logger.debug("Loading current seat info..."),model.fetch("seat").then(function(seat){self._Logger.debug("New seat data loaded for #"+seat.token+"."),resolve(seat)},function(e){return model.seat?(self._Logger.debug("Fallback to stored seat #"+model.seat.token+"."),void resolve(model.seat)):reject(e)})}model.initialize().then(function(){self._Logger.debug("Loading location seats..."),model.fetch("seats").then(function(seats){self._Logger.debug("Location seats loaded ("+seats.length+")."),loadSeat()},function(e){return model.seats?(self._Logger.debug("Fallback to stored seats ("+model.seats.length+")."),void loadSeat()):reject(e)})},reject)})}},{key:"model",get:function(){return this._LocationModel}}]),LocationManager}(app.AbstractManager),window.app.NavigationManager=function(_app$AbstractManager8){function NavigationManager($rootScope,$location,$window,AnalyticsModel,Logger){var _this6=this;_classCallCheck(this,NavigationManager),_get(Object.getPrototypeOf(NavigationManager.prototype),"constructor",this).call(this,Logger),this.$$location=$location,this.$$window=$window,this._AnalyticsModel=AnalyticsModel,this.locationChanging=new signals.Signal,this.locationChanged=new signals.Signal,$rootScope.$on("$locationChangeSuccess",function(){var path=_this6.$$location.path();path!==_this6._path&&(_this6._path=path,_this6._location=_this6.getLocation(path),_this6.locationChanging.dispatch(_this6.location)),_this6.locationChanged.dispatch(_this6.location)}),this.locationChanged.add(function(location){return _this6._AnalyticsModel.logNavigation(location)})}return _inherits(NavigationManager,_app$AbstractManager8),_createClass(NavigationManager,[{key:"getPath",value:function(location){return location?location.token?"/"+location.type+"/"+location.token:location.url?"/"+location.type+"/"+encodeURIComponent(location.url):"home"===location.type?"/":"/"+location.type:null}},{key:"getLocation",value:function(path){var match=/\/(\w+)?(\/(.+))?/.exec(path);if(match&&match.length>1){var type=match[1],param=match[3];if(void 0!==param)switch(type){case"url":return{type:type,url:decodeURIComponent(param)};default:return{type:type,token:param}}return type||(type="home"),{type:type}}return{}}},{key:"goBack",value:function(){"home"!==this.location.type&&"signin"!==this.location.type&&this.$$window.history.back()}},{key:"getQueryParameter",value:function(name){var regex=new RegExp(name+"=([^&#]*)"),results=regex.exec(window.location.hash);return null===results?void 0:decodeURIComponent(results[1].replace(/\+/g," "))}},{key:"path",get:function(){return this._path},set:function(value){var i=value.indexOf("#"),path=-1!==i?value.substring(i+1):value;this.location=this.getLocation(path)}},{key:"location",get:function(){return this._location},set:function(value){this._location!==value&&(this.location.type!==value.type||this.location.token!==value.token)&&(this._location=value,this.locationChanging.dispatch(this.location),this._path=this.getPath(this.location),this.$$location.path(this._path))}}]),NavigationManager}(app.AbstractManager),window.app.OrderManager=function(_app$AbstractManager9){function OrderManager(ChatModel,CustomerModel,DtsApi,OrderModel,Logger){var _this7=this;_classCallCheck(this,OrderManager),_get(Object.getPrototypeOf(OrderManager.prototype),"constructor",this).call(this,Logger),this._DtsApi=DtsApi,this._ChatModel=ChatModel,this._CustomerModel=CustomerModel,this._OrderModel=OrderModel,this._ChatModel.giftSeatChanged.add(function(giftSeat){0===_this7.model.orderCartStash.length&&(_this7.model.orderCartStash=_this7.model.orderCart,_this7.model.orderCart=[]),giftSeat||(_this7.model.orderCart=_this7.model.orderCartStash)})}return _inherits(OrderManager,_app$AbstractManager9),_createClass(OrderManager,[{key:"reset",value:function(){var _this8=this;return _get(Object.getPrototypeOf(OrderManager.prototype),"reset",this).call(this),new Promise(function(resolve){_this8.model.clearWatcher(_this8.model.REQUEST_KIND_ORDER),_this8.model.clearWatcher(_this8.model.REQUEST_KIND_ASSISTANCE),_this8.model.clearWatcher(_this8.model.REQUEST_KIND_CLOSEOUT),_this8.clearCart(),_this8.clearCheck(),_this8.model.orderTicket={},resolve()})}},{key:"addToCart",value:function(item){return this.model.orderCart.push(item),this.model.orderCartChanged.dispatch(this.model.orderCart),this._ChatModel.giftSeat&&this._ChatModel.giftReady.dispatch(),this.model.orderCart}},{key:"removeFromCart",value:function(item){return this.model.orderCart=this.model.orderCart.filter(function(entry){return entry!==item}),this.model.orderCart}},{key:"clearCart",value:function(){this.model.orderCart=[],this.model.orderCartStash=[],this._ChatModel.giftSeat=null}},{key:"clearCheck",value:function(items){var result=[];items&&(result=this.model.orderCheck,items.forEach(function(item){for(var i=0;i<result.length;i++)if(result[i].request===item.request){result[i].quantity-=item.quantity;break}}),result=result.filter(function(item){return item.quantity>0})),this.model.orderCheck=result}},{key:"submitCart",value:function(options){if(0!==this.model.orderCart.length){options=options||0,this._ChatModel.giftSeat&&(options|=4);var self=this,request={kind:this.model.REQUEST_KIND_ORDER,items:this.model.orderCart.map(function(entry){return{token:entry.item.order.token,quantity:entry.quantity,modifiers:entry.modifiers.reduce(function(result,category){return result.concat(category.modifiers.reduce(function(result,modifier){return modifier.isSelected&&result.push(modifier.data.token),result},[]))},[]),note:entry.name||""}}),ticket_token:self.model.orderTicket.token,seat_token:self._ChatModel.giftSeat,options:options};return new Promise(function(resolve,reject){self._DtsApi.waiter.placeOrder(request).then(function(response){if(response.item_tokens)for(var i=0;i<response.item_tokens.length;i++)self.model.orderCart[i].request=response.item_tokens[i];self.model.orderTicket={token:response.ticket_token},self.model.orderCheck=self.model.orderCheck.concat(self.model.orderCart),self.clearCart(),self._ChatModel.giftSeat=null;var watcher=self._createWatcher(self.model.REQUEST_KIND_ORDER,response);resolve(watcher)},reject)})}}},{key:"requestCloseout",value:function(){var self=this,request={kind:this.model.REQUEST_KIND_CLOSEOUT,ticket_token:this.model.orderTicket.token};return this._DtsApi.waiter.placeRequest(request).then(function(response){return self.model.orderTicket={token:response.ticket_token},self._createWatcher(self.model.REQUEST_KIND_CLOSEOUT,response)})}},{key:"requestAssistance",value:function(){var self=this,request={kind:this.model.REQUEST_KIND_ASSISTANCE,ticket_token:this.model.orderTicket.token};return this._DtsApi.waiter.placeRequest(request).then(function(response){return self._saveTicket(response),self._createWatcher(self.model.REQUEST_KIND_ASSISTANCE,response)})}},{key:"copyItems",value:function(items){return items.slice(0).map(function(item){return item.clone()})}},{key:"calculatePrice",value:function(entry){var modifiers=entry.modifiers.reduce(function(total,category){return total+category.modifiers.reduce(function(total,modifier){return total+(modifier.isSelected&&modifier.data.price>0?modifier.data.price:0)},0)},0);return entry.quantity*(modifiers+entry.item.order.price)}},{key:"calculateTotalPrice",value:function(entries){return entries?entries.reduce(function(total,entry){return total+OrderManager.prototype.calculatePrice(entry)},0):0}},{key:"calculateTax",value:function(entries){return this.calculateTotalPrice(entries)*this.model.tax}},{key:"uploadSignature",value:function(data){return this._DtsApi.upload.uploadTemp(data,"image/png","signature.png").then(function(response){return response.token})}},{key:"generatePaymentToken",value:function(){var self=this;return this._CustomerModel.isAuthenticated&&!this._CustomerModel.isGuest?this._DtsApi.customer.initializePayment().then(function(response){self._savePaymentToken(response)}):this._DtsApi.waiter.initializePayment().then(function(response){self._savePaymentToken(response)})}},{key:"payOrder",value:function(request){return request.ticket_token=this.model.orderTicket.token,request.payment_token=this.model.orderTicket.payment_token,this._DtsApi.waiter.submitCheckoutPayment(request)}},{key:"requestReceipt",value:function(request){return request.ticket_token=this.model.orderTicket.token,this._DtsApi.waiter.requestReceipt(request)}},{key:"_saveTicket",value:function(response){this.model.orderTicket={token:response.ticket_token,payment_token:this.model.orderTicket.payment_token}}},{key:"_savePaymentToken",value:function(response){this.model.orderTicket={token:this.model.orderTicket.token,payment_token:response.token}}},{key:"_createWatcher",value:function(kind,ticket){var watcher=new app.RequestWatcher(ticket,this._DtsApi);return this.model.addWatcher(kind,watcher),watcher}},{key:"model",get:function(){return this._OrderModel}}]),OrderManager}(app.AbstractManager),window.app.SessionManager=function(_app$AbstractManager10){function SessionManager(SNAPEnvironment,AnalyticsModel,CustomerModel,LocationModel,OrderModel,SurveyModel,storageProvider,Logger){var _this9=this;_classCallCheck(this,SessionManager),_get(Object.getPrototypeOf(SessionManager.prototype),"constructor",this).call(this,Logger);var self=this;this.sessionStarted=new signals.Signal,this.sessionEnded=new signals.Signal,this._SNAPEnvironment=SNAPEnvironment,this._AnalyticsModel=AnalyticsModel,this._CustomerModel=CustomerModel,this._LocationModel=LocationModel,this._OrderModel=OrderModel,this._SurveyModel=SurveyModel,this._store=storageProvider("snap_seat_session"),this._CustomerModel.profileChanged.add(function(customer){self._session&&customer&&(self._session.customer=customer.token,self._store.write(_this9._session))}),this._LocationModel.seatChanged.add(function(seat){self._session&&seat&&(self._session.seat=seat.token,self._store.write(_this9._session))}),this._OrderModel.orderTicketChanged.add(function(ticket){self._session&&ticket&&ticket.token&&(self._session.ticket=ticket.token,self._store.write(_this9._session))})}return _inherits(SessionManager,_app$AbstractManager10),_createClass(SessionManager,[{key:"initialize",value:function(){_get(Object.getPrototypeOf(SessionManager.prototype),"initialize",this).call(this);var self=this;return new Promise(function(resolve,reject){self._store.read().then(function(data){self._session=data,data||self._startSession(),resolve()},reject)})}},{key:"reset",value:function(){return _get(Object.getPrototypeOf(SessionManager.prototype),"reset",this).call(this),this._store.clear()}},{key:"endSession",value:function(){var self=this;return new Promise(function(resolve,reject){self._store.read().then(function(s){self._session=null,s&&(self._Logger.debug("Seat session "+s.id+" ended."),s.ended=new Date,self._AnalyticsModel.logSession(s),self.sessionEnded.dispatch(s)),self._store.clear().then(resolve,reject)},reject)})}},{key:"_startSession",value:function(){var seat=this._LocationModel.seat;this._session={id:this._generateID(),seat:seat?seat.token:void 0,platform:this._SNAPEnvironment.platform,started:new Date},this._Logger.debug("Seat session "+this._session.id+" started."),this._store.write(this._session),this.sessionStarted.dispatch(this._session)}},{key:"_generateID",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"===c?r:3&r|8;return v.toString(16)})}},{key:"session",get:function(){return this._session}},{key:"guestCount",get:function(){return this._session.guest_count||1},set:function(value){this._session.guest_count!==value&&(this._session.guest_count=value,this._store.write(this._session))}},{key:"specialEvent",get:function(){return this._session.special_event},set:function(value){this._session.special_event!==value&&(this._session.special_event=value,this._store.write(this._session))}}]),SessionManager}(app.AbstractManager),window.app.ShellManager=function(_app$AbstractManager11){function ShellManager(DataModel,LocationModel,ShellModel,SNAPLocation,Environment,Hosts,Logger){var _this10=this;_classCallCheck(this,ShellManager),_get(Object.getPrototypeOf(ShellManager.prototype),"constructor",this).call(this,Logger),this._DataModel=DataModel,this._LocationModel=LocationModel,this._ShellModel=ShellModel,this._SNAPLocation=SNAPLocation,this._Environment=Environment,this._Hosts=Hosts,this.locale=this._LocationModel.location.locale,this._LocationModel.locationChanged.add(function(location){_this10.locale=location.locale})}return _inherits(ShellManager,_app$AbstractManager11),_createClass(ShellManager,[{key:"initialize",value:function(){_get(Object.getPrototypeOf(ShellManager.prototype),"initialize",this).call(this);var self=this,taskBackgrounds=this._DataModel.backgrounds().then(function(response){self._ShellModel.backgrounds=response.main.map(function(item){return{media:item.src}}),self._ShellModel.screensavers=response.screensaver.map(function(item){return{media:item.src}}),self._ShellModel.pageBackgrounds=response.pages.map(function(item){return{media:item.background.src,destination:item.destination}})}),taskElements=this._DataModel.elements().then(function(response){var layout=self._SNAPLocation.theme.layout,elements={};switch(layout){case"classic":elements={button_home:self.getAssetUrl("images/button-home.png"),button_back:self.getAssetUrl("images/button-back.png"),button_cart:self.getAssetUrl("images/button-cart.png"),button_rotate:self.getAssetUrl("images/button-rotate.png"),button_waiter:self.getAssetUrl("images/button-assistance.png"),button_check:self.getAssetUrl("images/button-closeout.png"),button_survey:self.getAssetUrl("images/button-survey.png"),button_chat:self.getAssetUrl("images/button-chat.png")};break;case"galaxies":elements={button_back:self.getAssetUrl("images/button-back.png"),button_rotate:self.getAssetUrl("images/button-rotate.png"),button_settings:self.getAssetUrl("images/button-settings.png"),location_logo:self.getAssetUrl("images/button-logo.png")}}for(var i=0;i<response.elements.length;i++){var element=response.elements[i];elements[element.slot]=element.src}self._ShellModel.elements=elements});return Promise.all([taskBackgrounds,taskElements])}},{key:"formatPrice",value:function(price){return this._ShellModel.priceFormat.replace(/{(\d+)}/g,function(){return price.toFixed(2)})}},{key:"getPageBackgrounds",value:function(location){return this._ShellModel.pageBackgrounds.filter(function(item){return item.destination.type===location.type&&(item.destination.token===location.token&&location.token||item.destination.url===location.url&&location.url)})}},{key:"getAssetUrl",value:function(file){var path=this._getPath(this._Hosts["static"]);return path+"assets/"+this._SNAPLocation.theme.layout+"/"+file}},{key:"getPartialUrl",value:function(name){return this.getAssetUrl("partials/"+name+".html")}},{key:"getMediaUrl",value:function(media,width,height,extension){if(!media)return null;var path=this._getPath(this._Hosts.media);if("string"==typeof media||media instanceof String)return-1===media.indexOf("/")&&-1===media.indexOf(".")?(extension=extension||"jpg",path+"media/"+media+"_"+width+"_"+height+"."+extension):media;if(!media.token)return media;var type=this.getMediaType(media),url=path+"media/"+media.token;if(!type)return null;if("video"===type)url+=".webm";else if("flash"===type)url+=".swf";else if("image"===type)if(width&&height&&(url+="_"+width+"_"+height),extension)url+="."+extension;else{if(!media||!media.mime_type)return void 0;switch(media.mime_type){case"image/png":url+=".png";break;default:url+=".jpg"}}return url}},{key:"getMediaType",value:function(media){return media&&media.mime_type?"image"===media.mime_type.substring(0,5)?"image":"video"===media.mime_type.substring(0,5)?"video":"application/x-shockwave-flash"===media.mime_type?"flash":void 0:void 0}},{key:"_getPath",value:function(res){var path="";return res.protocol?path+=res.profocol+"://":res.secure?path+="https://":res.secure===!1&&(path+="http://"),res.host&&(res.protocol||""!==path||(path+="//"),path+=res.host),res.path&&(path+=res.path),path.length>0&&!path.endsWith("/")&&(path+="/"),path}},{key:"locale",get:function(){return this._locale},set:function(value){if(this._locale!==value){this._locale=value;var format="{0}",currency="";switch(this._locale){case"ro_MD":format="{0} Lei",currency="";break;case"zh_MO":format="MOP$ {0}",currency="";break;case"en_US":format="${0}",currency="USD"}this._ShellModel.priceFormat=format,this._ShellModel.currency=currency}}},{key:"model",get:function(){return this._ShellModel}},{key:"tileStyle",get:function(){var style="tile";switch(this._SNAPLocation.theme.tiles_style){case"regular":style+=" tile-regular"}return style}},{key:"predicateEven",get:function(){var index=0;return function(){return index++%2===1}}},{key:"predicateOdd",get:function(){var index=0;return function(){return index++%2===0}}}]),ShellManager}(app.AbstractManager),function(){var SocialManager=function(SNAPEnvironment,DtsApi,WebBrowser,Logger){this._SNAPEnvironment=SNAPEnvironment,this._DtsApi=DtsApi,this._WebBrowser=WebBrowser,this._Logger=Logger};window.app.SocialManager=SocialManager,SocialManager.prototype.loginFacebook=function(){var self=this,facebookApp=this._SNAPEnvironment.facebook_application,customerApp=this._SNAPEnvironment.customer_application;return new Promise(function(resolve,reject){function dispose(){self._WebBrowser.onNavigated.remove(onNavigated),self._WebBrowser.close()}function onNavigated(url){if(0===url.indexOf(facebookApp.redirect_url)){var facebookAuth=URI("?"+URI(url).fragment()).search(!0);if(facebookAuth.error||!facebookAuth.access_token)return self._Logger.debug("Facebook callback error: "+facebookAuth.error),reject(facebookAuth.error);self._Logger.debug("Facebook callback received."),self._DtsApi.customer.signUpFacebook({access_token:facebookAuth.access_token,client_id:customerApp.client_id}).then(function(ticket){self._Logger.debug("Facebook signin complete.");var url=self._DtsApi.oauth2.getAuthConfirmUrl(ticket.ticket_id,{client_id:customerApp.client_id,response_type:"token",redirect_uri:customerApp.callback_url});self._WebBrowser.open(url)},reject)}else if(0===url.indexOf(customerApp.callback_url)){var customerAuth=URI("?"+URI(url).fragment()).search(!0);if(customerAuth.error||!customerAuth.access_token)return self._Logger.debug("Facebook customer callback error: "+customerAuth.error),reject(customerAuth.error);self._Logger.debug("Facebook customer login complete."),resolve(customerAuth)}}var _reject=reject,_resolve=resolve;reject=function(e){self._Logger.debug("Unable to login with Facebook: "+e),dispose(),_reject(e)},resolve=function(data){self._Logger.debug("Facebook login complete."),dispose(),_resolve(data)},self._WebBrowser.onNavigated.add(onNavigated),self._Logger.debug("Logging in with Facebook.");var url=URI("https://www.facebook.com/dialog/oauth").addSearch("client_id",facebookApp.client_id).addSearch("redirect_uri",facebookApp.redirect_url).addSearch("response_type","token").addSearch("scope","public_profile,email").toString();self._WebBrowser.open(url)})},SocialManager.prototype.loginGooglePlus=function(){var self=this,googleplusApp=this._SNAPEnvironment.googleplus_application,customerApp=this._SNAPEnvironment.customer_application;return new Promise(function(resolve,reject){function dispose(){self._WebBrowser.onNavigated.remove(onNavigated),self._WebBrowser.close()}function onNavigated(url){if(0===url.indexOf(googleplusApp.redirect_url)){var googleplusAuth=URI(url).search(!0);if(googleplusAuth.error||!googleplusAuth.code||googleplusAuth.state!==state)return self._Logger.debug("Google callback error: "+googleplusAuth.error),reject(googleplusAuth.error);self._Logger.debug("Google callback received."),self._DtsApi.customer.signUpGooglePlus({code:googleplusAuth.code,client_id:customerApp.client_id}).then(function(ticket){self._Logger.debug("Google signin complete.");var url=self._DtsApi.oauth2.getAuthConfirmUrl(ticket.ticket_id,{client_id:customerApp.client_id,response_type:"token",redirect_uri:customerApp.callback_url});self._WebBrowser.open(url)},reject)}else if(0===url.indexOf(customerApp.callback_url)){var customerAuth=URI("?"+URI(url).fragment()).search(!0);if(customerAuth.error||!customerAuth.access_token)return self._Logger.debug("Google customer callback error: "+customerAuth.error),reject(customerAuth.error);self._Logger.debug("Google customer login complete."),resolve(customerAuth)}}var state=self._generateToken(),_reject=reject,_resolve=resolve;reject=function(e){self._Logger.debug("Unable to login with Google: "+e),dispose(),_reject(e)},resolve=function(data){self._Logger.debug("Google login complete."),dispose(),_resolve(data)},self._WebBrowser.onNavigated.add(onNavigated),self._Logger.debug("Logging in with Google.");var url=URI("https://accounts.google.com/o/oauth2/auth").addSearch("client_id",googleplusApp.client_id).addSearch("redirect_uri",googleplusApp.redirect_url).addSearch("response_type","code").addSearch("scope","https://www.googleapis.com/auth/plus.login email").addSearch("access_type","offline").addSearch("state",state).toString();self._WebBrowser.open(url)})},SocialManager.prototype.loginTwitter=function(){var self=this,twitterApp=this._SNAPEnvironment.twitter_application,customerApp=this._SNAPEnvironment.customer_application;return new Promise(function(resolve,reject){function dispose(){self._WebBrowser.onNavigated.remove(onNavigated),self._WebBrowser.close()}function onNavigated(url){if(0===url.indexOf(twitterApp.redirect_url)){var twitterAuth=URI(url).search(!0);if(twitterAuth.error||!twitterAuth.oauth_verifier)return self._Logger.debug("Twitter callback error: "+twitterAuth.error),reject(twitterAuth.error);self._Logger.debug("Twitter callback received."),self._DtsApi.customer.signUpTwitter({client_id:customerApp.client_id,request_token:twitterAuth.oauth_token,request_token_secret:tokenSecret,request_token_verifier:twitterAuth.oauth_verifier}).then(function(ticket){self._Logger.debug("Twitter signin complete.");var url=self._DtsApi.oauth2.getAuthConfirmUrl(ticket.ticket_id,{client_id:customerApp.client_id,response_type:"token",redirect_uri:customerApp.callback_url});self._WebBrowser.open(url)},reject)}else if(0===url.indexOf(customerApp.callback_url)){var customerAuth=URI("?"+URI(url).fragment()).search(!0);if(customerAuth.error||!customerAuth.access_token)return self._Logger.debug("Twitter customer callback error: "+customerAuth.error),reject(customerAuth.error);self._Logger.debug("Twitter customer login complete."),resolve(customerAuth)}}var tokenSecret,_reject=reject,_resolve=resolve;reject=function(e){self._Logger.debug("Unable to login with Twitter: "+e),dispose(),_reject(e)},resolve=function(data){self._Logger.debug("Twitter login complete."),dispose(),_resolve(data)},self._WebBrowser.onNavigated.add(onNavigated),self._Logger.debug("Logging in with Twitter."),self._DtsApi.customer.signUpTwitterRequestToken({oauth_callback:twitterApp.redirect_url}).then(function(token){var url=URI("https://api.twitter.com/oauth/authenticate").addSearch("oauth_token",token.oauth_token).addSearch("force_login","true").toString();self._Logger.debug("Twitter request token received."),tokenSecret=token.oauth_token_secret,self._WebBrowser.open(url)},reject)})},SocialManager.prototype._generateToken=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"===c?r:3&r|8;return v.toString(16)})}}(),function(){var SoftwareManager=function(SNAPEnvironment){this._SNAPEnvironment=SNAPEnvironment};window.app.SoftwareManager=SoftwareManager,Object.defineProperty(SoftwareManager.prototype,"currentVersion",{get:function(){var pattern=/(SNAP)\/([0-9.]+)/,match=pattern.exec(navigator.userAgent);return match?match[1]:"8.8.8.8"}}),Object.defineProperty(SoftwareManager.prototype,"requiredVersion",{get:function(){return this._SNAPEnvironment.requirements[this._SNAPEnvironment.platform]}}),Object.defineProperty(SoftwareManager.prototype,"updateRequired",{get:function(){return-1===this._versionCompare(this.currentVersion,this.requiredVersion)}}),SoftwareManager.prototype._versionCompare=function(v1,v2,options){function isValidPart(x){return(lexicographical?/^\d+[A-Za-z]*$/:/^\d+$/).test(x)}if(!v1||!v2)return 0;var lexicographical=options&&options.lexicographical,zeroExtend=options&&options.zeroExtend,v1parts=v1.split("."),v2parts=v2.split(".");if(!v1parts.every(isValidPart)||!v2parts.every(isValidPart))return NaN;if(zeroExtend){for(;v1parts.length<v2parts.length;)v1parts.push("0");for(;v2parts.length<v1parts.length;)v2parts.push("0")}lexicographical||(v1parts=v1parts.map(Number),v2parts=v2parts.map(Number));for(var i=0;i<v1parts.length;++i){if(v2parts.length===i)return 1;if(v1parts[i]!==v2parts[i])return v1parts[i]>v2parts[i]?1:-1}return v1parts.length!==v2parts.length?-1:0}}(),window.app.SurveyManager=function(_app$AbstractManager12){function SurveyManager(DataModel,SurveyModel,Logger){_classCallCheck(this,SurveyManager),_get(Object.getPrototypeOf(SurveyManager.prototype),"constructor",this).call(this,Logger),this._DataModel=DataModel,this._SurveyModel=SurveyModel}return _inherits(SurveyManager,_app$AbstractManager12),_createClass(SurveyManager,[{key:"initialize",value:function(){var _this11=this;return _get(Object.getPrototypeOf(SurveyManager.prototype),"initialize",this).call(this),this.model.isEnabled&&this._DataModel.surveys().then(function(data){_this11.model.feedbackSurvey=data.surveys[0]}),Promise.resolve()}},{key:"reset",value:function(){var _this12=this;return _get(Object.getPrototypeOf(SurveyManager.prototype),"reset",this).call(this),new Promise(function(resolve,reject){_this12.model.isEnabled&&(_this12.model.feedbackSurveyComplete=!1),resolve()})}},{key:"model",get:function(){return this._SurveyModel}}]),SurveyManager}(app.AbstractManager),window.app.AbstractModel=function(){function AbstractModel(storageProvider){_classCallCheck(this,AbstractModel),this._storageProvider=storageProvider,this._properties={}}return _createClass(AbstractModel,[{key:"_defineProperty",value:function(name,storeName,defaultValue,providerFunction){var self=this,property=this._properties[name]={name:"_"+name};storeName&&(property.store=this._storageProvider(storeName)),providerFunction&&(property.provider=providerFunction),this[name+"Changed"]=property.signal=new signals.Signal,Object.defineProperty(this,name,{get:function(){return self[property.name]||defaultValue},set:function(value){value!==self[property.name]&&(self[property.name]=value,property.store&&property.store.write(value).then(function(){property.signal.dispatch(value)}))}})}},{key:"_initProperty",value:function(name){var self=this,property=this._properties[name];if(!property)throw new Error("Property '"+name+"' not found.");if(property.initialized)throw new Error("Property '"+name+"' is already initialized.");return property.store?property.store.read().then(function(value){property.initialized=!0,self[property.name]=value,property.signal.dispatch(value)}):(property.initialized=!0,Promise.resolve())}},{key:"initialize",value:function(){var _this13=this;return Promise.all(Object.keys(this._properties).filter(function(key){return!_this13._properties[key].initialized}).map(function(key){return _this13._initProperty(key)}))}},{key:"fetch",value:function(propertyName){var property=this._properties[propertyName];if(!property)throw new Error("Property '"+propertyName+"' not found.");if(!property.provider)throw new Error("Property '"+propertyName+"' has no provider.");
var self=this;return property.provider().then(function(value){return self[propertyName]=value,value})}},{key:"fetchAll",value:function(){var _this14=this;return Promise.all(Object.keys(this._properties).filter(function(key){return _this14._properties[key].provider}).map(function(key){return _this14.fetch(key)}))}},{key:"clear",value:function(){var _this15=this;return Promise.all(Object.keys(this._properties).filter(function(key){return _this15._properties[key].store}).map(function(key){return _this15._properties[key].store.clear()}))}},{key:"_propertyChanged",value:function(name){var property=this._properties[name];property.signal.dispatch(this[property.name]),property.store&&property.store.write(this[property.name])}}]),AbstractModel}(),window.app.AnalyticsModel=function(){function AnalyticsModel(storageProvider,heatmap,Logger){_classCallCheck(this,AnalyticsModel);var self=this;this._data=[new app.AnalyticsData("sessions",storageProvider),new app.AnalyticsData("advertisements",storageProvider),new app.AnalyticsData("answers",storageProvider),new app.AnalyticsData("chats",storageProvider),new app.AnalyticsData("comments",storageProvider),new app.AnalyticsData("clicks",storageProvider),new app.AnalyticsData("pages",storageProvider),new app.AnalyticsData("urls",storageProvider)].reduce(function(result,item){return result[item.name]=item,result},{}),heatmap.clicked.add(function(click){self._logClick(click)}),this._Logger=Logger}return _createClass(AnalyticsModel,[{key:"initialize",value:function(){return Q.allSettled(this._datas.map(function(d){return d.initialize()}))}},{key:"logSession",value:function(session){this._data.sessions.push(session)}},{key:"logNavigation",value:function(destination){this._data.pages.push({time:new Date,destination:destination}),this._data.clicks.store()}},{key:"logAdvertisement",value:function(advertisement){this._data.advertisements.push({time:new Date,advertisement:advertisement})}},{key:"logAnswer",value:function(answer){this._data.answers.push({time:new Date,answer:answer})}},{key:"logChat",value:function(chat){this._data.chats.push({time:new Date,chat:chat})}},{key:"logComment",value:function(comment){this._data.comments.push({time:new Date,comment:comment})}},{key:"logUrl",value:function(url){this._data.urls.push({time:new Date,url:url})}},{key:"reset",value:function(){return Q.allSettled(this._datas.map(function(d){return d.reset()}))}},{key:"_logClick",value:function(click){click.time=new Date,this._data.clicks.data.push(click)}},{key:"sessions",get:function(){return this._data.sessions}},{key:"pages",get:function(){return this._data.pages}},{key:"advertisements",get:function(){return this._data.advertisements}},{key:"answers",get:function(){return this._data.answers}},{key:"chats",get:function(){return this._data.chats}},{key:"comments",get:function(){return this._data.comments}},{key:"urls",get:function(){return this._data.urls}},{key:"clicks",get:function(){return this._data.clicks.store(),this._data.clicks}},{key:"_datas",get:function(){var _this16=this;return Object.keys(this._data).map(function(x){return _this16._data[x]})}}]),AnalyticsModel}(),window.app.CartModel=function(){function CartModel(){_classCallCheck(this,CartModel),this.STATE_CART="cart",this.STATE_HISTORY="history",this._isCartOpen=!1,this.isCartOpenChanged=new signals.Signal,this._cartState=this.STATE_CART,this.cartStateChanged=new signals.Signal,this._editableItem=null,this.editableItemChanged=new signals.Signal}return _createClass(CartModel,[{key:"openEditor",value:function(item,isNew){this._editableItem!==item&&(this._editableItemNew=isNew||!1,this._editableItem=item,this.editableItemChanged.dispatch(item))}},{key:"closeEditor",value:function(){this._editableItemNew=!1,this._editableItem=null,this.editableItemChanged.dispatch(null)}},{key:"isCartOpen",get:function(){return this._isCartOpen},set:function(value){this._isCartOpen!==value&&(this._isCartOpen=value,this.isCartOpenChanged.dispatch(value))}},{key:"cartState",get:function(){return this._cartState},set:function(value){this._cartState!==value&&(this._cartState=value,this.cartStateChanged.dispatch(value))}},{key:"editableItem",get:function(){return this._editableItem}},{key:"editableItemNew",get:function(){return this._editableItemNew}}]),CartModel}(),window.app.ChatModel=function(){function ChatModel(SNAPLocation,SNAPEnvironment,storageProvider){_classCallCheck(this,ChatModel);var self=this;this._preferencesStore=storageProvider("snap_chat_preferences"),this._historyStore=storageProvider("snap_chat_history"),this.isConnectedChanged=new signals.Signal,this.isEnabledChanged=new signals.Signal,this.isPresentChanged=new signals.Signal,this.activeDevicesChanged=new signals.Signal,this.pendingDevicesChanged=new signals.Signal,this.chatRequestReceived=new signals.Signal,this.historyChanged=new signals.Signal,this.messageReceived=new signals.Signal,this.giftRequestReceived=new signals.Signal,this.giftAccepted=new signals.Signal,this._giftSeat=null,this.giftSeatChanged=new signals.Signal,this._giftDevice=null,this.giftDeviceChanged=new signals.Signal,this.giftReady=new signals.Signal,this.giftAccepted=new signals.Signal,this._isEnabled=SNAPLocation.chat,this._pendingDevices=[],this._activeDevices=[],this._lastReads={},this._preferencesStore.read().then(function(prefs){prefs&&(self._isEnabled=Boolean(prefs.is_enabled),self._activeDevices=prefs.active_devices||[],self._pendingDevices=prefs.pending_devices||[],self._lastReads=prefs.last_reads||{})}),this._historyStore.read().then(function(history){self._history=history||[]})}return _createClass(ChatModel,[{key:"isActiveDevice",value:function(device){return-1!==this.activeDevices.indexOf(device.token||device)}},{key:"isPendingDevice",value:function(device){return-1!==this.pendingDevices.indexOf(device.token||device)}},{key:"addActiveDevice",value:function(device){this._activeDevices.push(device.token||device),this.activeDevices=this._activeDevices}},{key:"addPendingDevice",value:function(device){this._pendingDevices.push(device.token||device),this.pendingDevices=this._pendingDevices}},{key:"removeActiveDevice",value:function(device){var index=this.activeDevices.indexOf(device.token||device);this._activeDevices.splice(index,1),this.activeDevices=this._activeDevices}},{key:"removePendingDevice",value:function(device){var index=this.pendingDevices.indexOf(device.token||device);this._pendingDevices.splice(index,1),this.pendingDevices=this._pendingDevices}},{key:"addHistory",value:function(message){this._history.push(message),this.history=this._history}},{key:"getLastRead",value:function(device){var token=device.token||device;return this._lastReads[token]||null}},{key:"setLastRead",value:function(device,value){var token=device.token||device;this._lastReads[token]=value,this._updatePreferences()}},{key:"save",value:function(){this._updateHistory(),this._updatePreferences()}},{key:"reset",value:function(){this._isConnected=this._isEnabled=this._isPresent=!1,this._history=[],this._activeDevices=[],this._pendingDevices=[],this._historyStore.clear(),this._preferencesStore.clear()}},{key:"_updateHistory",value:function(){this._historyStore.write(this.history)}},{key:"_updatePreferences",value:function(){this._preferencesStore.write({is_enabled:this.isEnabled,active_devices:this.activeDevices,pending_devices:this.pendingDevices,last_reads:this._lastReads})}},{key:"isConnected",get:function(){return this._isConnected},set:function(value){this._isConnected!==value&&(this._isConnected=Boolean(value),this.isConnectedChanged.dispatch(this._isConnected))}},{key:"isEnabled",get:function(){return this._isEnabled},set:function(value){this._isEnabled!==value&&(this._isEnabled=Boolean(value),this.isEnabledChanged.dispatch(this._isEnabled),this._updatePreferences())}},{key:"isPresent",get:function(){return this._isPresent},set:function(value){this._isPresent!==value&&(this._isPresent=Boolean(value),this.isPresentChanged.dispatch(this._isPresent))}},{key:"giftDevice",get:function(){return this._giftDevice},set:function(value){this._giftDevice!==value&&(this._giftDevice=value,this.giftDeviceChanged.dispatch(this._giftDevice))}},{key:"giftSeat",get:function(){return this._giftSeat},set:function(value){this._giftSeat!==value&&(this._giftSeat=value,this.giftSeatChanged.dispatch(this._giftSeat))}},{key:"pendingDevices",get:function(){return this._pendingDevices},set:function(value){this._pendingDevices=value||[],this.pendingDevicesChanged.dispatch(this.pendingDevices)}},{key:"activeDevices",get:function(){return this._activeDevices},set:function(value){this._activeDevices=value||[],this.activeDevicesChanged.dispatch(this.activeDevices)}},{key:"history",get:function(){return this._history},set:function(value){this._history=value||[],this.historyChanged.dispatch(this._history),this._updateHistory()}}]),ChatModel}(),window.app.CustomerModel=function(){function CustomerModel(Config,storageProvider){_classCallCheck(this,CustomerModel);var self=this;this._accountStore=storageProvider("snap_customer"),this._profile=null,this._isGuest=!1,this._isEnabled=Boolean(Config.accounts),this.profileChanged=new signals.Signal,this._accountStore.read().then(function(account){self._isGuest=account&&account.is_guest,!account||account.is_guest?self._profile=null:self._profile=account.profile,self.profileChanged.dispatch(self._profile)})}return _createClass(CustomerModel,[{key:"isEnabled",get:function(){return Boolean(this._isEnabled)}},{key:"isAuthenticated",get:function(){return this.isEnabled&&(Boolean(this.profile)||this.isGuest)}},{key:"isGuest",get:function(){return this.isEnabled&&Boolean(this._isGuest)}},{key:"hasCredentials",get:function(){return Boolean(this.isAuthenticated&&!this.isGuest&&1===this.profile.type)}},{key:"profile",get:function(){return this._profile},set:function(value){var self=this;this._profile=value||null,this._isGuest="guest"===value,value?this._accountStore.write({profile:this._profile,is_guest:this._isGuest}).then(function(){self.profileChanged.dispatch(self._profile),(!value||self._isGuest)&&(self.session=null)}):this._accountStore.clear().then(function(){self._isGuest=!1,self.profileChanged.dispatch(self._profile),self.session=null})}}]),CustomerModel}(),window.app.DataModel=function(){function DataModel(config,service,storageProvider){_classCallCheck(this,DataModel),this._config=config,this._service=service,this._cache={},this._storageProvider=storageProvider}return _createClass(DataModel,[{key:"clear",value:function(){var self=this;return new Promise(function(resolve,reject){self._cache={},resolve()})}},{key:"digest",value:function(){return this._service.snap.getDigest(this._config.location)}},{key:"home",value:function(){return this._getSnapData("home","getMenus")}},{key:"advertisements",value:function(){return this._getSnapData("advertisements","getAdvertisements")}},{key:"backgrounds",value:function(){return this._getSnapData("backgrounds","getBackgrounds")}},{key:"elements",value:function(){return this._getSnapData("elements","getElements")}},{key:"menu",value:function(id){return this._getSnapData("menu","getMenu",id)}},{key:"category",value:function(id){return this._getSnapData("category","getMenuCategory",id)}},{key:"item",value:function(id){return this._getSnapData("item","getMenuItem",id)}},{key:"surveys",value:function(){return this._getSnapData("surveys","getSurveys")}},{key:"seats",value:function(){var self=this;return this._cached("seats")||this._service.location.getSeats().then(function(data){return data=data||[],self._store(data,"seats"),data})}},{key:"media",value:function(_media){var self=this,token=_media.token+"_"+_media.width+"_"+_media.height;return this._cached("media",token)||new Promise(function(resolve,reject){if(_media.width&&_media.height){var img=new Image;img.onload=function(){return resolve(img)},img.onerror=function(e){return reject(e)},img.src=self._getMediaUrl(_media,_media.width,_media.height,_media.extension),self._store(img,"media",token),img.complete&&resolve(img)}else reject("Missing image dimensions")})}},{key:"_getSnapData",value:function(name,method,id){var _this17=this,cached=this._cached(name,id);if(cached)return Promise.resolve(cached);if(navigator.onLine===!1){var stored=this._stored(name,id);return stored?Promise.resolve(stored):Promise.reject("Data is not available: /"+name+"/"+id)}return this._service.snap[method](this._config.location,id).then(function(data){return data=data||[],_this17._store(data,name,id),data})}},{key:"_cached",value:function(group,id){return id&&this._cache[group]&&this._cache[group][id]?Promise.resolve(this._cache[group][id]):!id&&this._cache[group]?Promise.resolve(this._cache[group]):null}},{key:"_stored",value:function(group,id){var storage=this._getStorage(group,id);return storage.readSync()}},{key:"_store",value:function(data,group,id){if(id?(this._cache[group]||(this._cache[group]={}),this._cache[group][id]=data):this._cache[group]=data,"media"!==group){var storage=this._getStorage(group,id);storage.write(data)}}},{key:"_getStorage",value:function(group,id){return id?this._storageProvider("snap_cache_"+group+"_"+id):this._storageProvider("snap_cache_"+group)}},{key:"_getMediaUrl",value:function(){}}]),DataModel}(),window.app.LocationModel=function(_app$AbstractModel){function LocationModel(DtsApi,SNAPEnvironment,SNAPLocation,storageProvider){_classCallCheck(this,LocationModel),_get(Object.getPrototypeOf(LocationModel.prototype),"constructor",this).call(this,storageProvider);var self=this;this._defineProperty("device","snap_device",null,function(){return DtsApi.hardware.getCurrentDevice()}),this._defineProperty("devices",void 0,[]),this._defineProperty("seat","snap_seat",null,function(){return DtsApi.location.getCurrentSeat()}),this._defineProperty("seats","snap_seats",[],function(){return DtsApi.location.getSeats()}),this._defineProperty("location","snap_location",SNAPLocation,function(){return self.device?DtsApi.snap.getConfig(self.device.location_token):Promise.reject("Device data is missing.")}),this.initialize()}return _inherits(LocationModel,_app$AbstractModel),_createClass(LocationModel,[{key:"addDevice",value:function(device){this.devices.push(device),this._propertyChanged("device")}},{key:"getSeat",value:function(token){return this.seats.filter(function(seat){return seat.token===token})[0]||null}},{key:"getDevice",value:function(device){return this.devices.filter(function(d){return(device.token||device)===d.token})[0]||null}}]),LocationModel}(app.AbstractModel),window.app.OrderModel=function(){function OrderModel(storageProvider){function prepareCartData(items){return items}function restoreCartData(items){return items.map?items.map(app.CartItem.prototype.restore):[]}_classCallCheck(this,OrderModel);var self=this;this.REQUEST_KIND_ORDER=1,this.REQUEST_KIND_ASSISTANCE=2,this.REQUEST_KIND_CLOSEOUT=3,this.priceFormat="{0}",this.tax=0,this._orderCart=[],this._orderCartStash=[],this._orderCheck=[],this._orderTicket={},this._requestWatchers={},this.orderCartChanged=new signals.Signal,this.orderCartStashChanged=new signals.Signal,this.orderCheckChanged=new signals.Signal,this.orderTicketChanged=new signals.Signal,this.orderRequestChanged=new signals.Signal,this.assistanceRequestChanged=new signals.Signal,this.closeoutRequestChanged=new signals.Signal,this._orderCartStorage=storageProvider("snap_order_cart"),this._orderCartStorage.read().then(function(value){self.orderCart=restoreCartData(value||[]),self.orderCartChanged.dispatch(self.orderCart),self.orderCartChanged.add(function(items){self._orderCartStorage.write(prepareCartData(items))})}),this._orderCartStashStorage=storageProvider("snap_order_cart_stash"),this._orderCartStashStorage.read().then(function(value){self.orderCartStash=restoreCartData(value||[]),self.orderCartStashChanged.dispatch(self.orderCartStash),self.orderCartStashChanged.add(function(items){self._orderCartStashStorage.write(prepareCartData(items))})}),this._orderCheckStorage=storageProvider("snap_order_check"),this._orderCheckStorage.read().then(function(value){self.orderCheck=restoreCartData(value||[]),self.orderCheckChanged.dispatch(self.orderCheck),self.orderCheckChanged.add(function(items){self._orderCheckStorage.write(prepareCartData(items))})}),this._orderTicketStorage=storageProvider("snap_order_ticket"),this._orderTicketStorage.read().then(function(value){self.orderTicket=value||{},self.orderTicketChanged.dispatch(self.orderTicket),self.orderTicketChanged.add(function(data){self._orderTicketStorage.write(data)})})}return _createClass(OrderModel,[{key:"getWatcher",value:function(kind){return this._requestWatchers[kind]||null}},{key:"addWatcher",value:function(kind,watcher){this.clearWatcher(kind);var self=this;watcher.promise.then(function(){self.getWatcher(kind)===watcher&&self.clearWatcher(kind)}),this._requestWatchers[kind]=watcher,this._notifyChange(kind)}},{key:"clearWatcher",value:function(kind){var watcher=this.getWatcher(kind);watcher&&watcher.dispose(),delete this._requestWatchers[kind],this._notifyChange(kind)}},{key:"_notifyChange",value:function(kind){var signal;switch(kind){case this.REQUEST_KIND_ORDER:signal=this.orderRequestChanged;break;case this.REQUEST_KIND_ASSISTANCE:signal=this.assistanceRequestChanged;break;case this.REQUEST_KIND_CLOSEOUT:signal=this.closeoutRequestChanged}signal&&signal.dispatch(this.getWatcher(kind))}},{key:"orderCart",get:function(){return this._orderCart},set:function(value){this._orderCart=value||[],this.orderCartChanged.dispatch(this.orderCart)}},{key:"orderCartStash",get:function(){return this._orderCartStash},set:function(value){this._orderCartStash=value||[],this.orderCartStashChanged.dispatch(this.orderCartStash)}},{key:"orderCheck",get:function(){return this._orderCheck},set:function(value){this._orderCheck=value||[],this.orderCheckChanged.dispatch(this.orderCheck)}},{key:"orderTicket",get:function(){return this._orderTicket},set:function(value){this._orderTicket=value||{},this.orderTicketChanged.dispatch(this.orderTicket)}},{key:"orderRequest",get:function(){return this.getWatcher(this.REQUEST_KIND_ORDER)}},{key:"assistanceRequest",get:function(){return this.getWatcher(this.REQUEST_KIND_ASSISTANCE)}},{key:"closeoutRequest",get:function(){return this.getWatcher(this.REQUEST_KIND_CLOSEOUT)}}]),OrderModel}(),window.app.SessionModel=function(_app$AbstractModel2){function SessionModel(storageProvider){_classCallCheck(this,SessionModel),_get(Object.getPrototypeOf(SessionModel.prototype),"constructor",this).call(this,storageProvider),this._defineProperty("apiToken","snap_accesstoken"),this._defineProperty("customerToken","snap_customer_accesstoken"),this.initialize()}return _inherits(SessionModel,_app$AbstractModel2),SessionModel}(app.AbstractModel),window.app.ShellModel=function(){function ShellModel(){_classCallCheck(this,ShellModel),this._backgrounds=[],this.backgroundsChanged=new signals.Signal,this._screensavers=[],this.screensaversChanged=new signals.Signal,this._pageBackgrounds=[],this.pageBackgroundsChanged=new signals.Signal,this._elements=[],this.elementsChanged=new signals.Signal,this._priceFormat="{0}",this.priceFormatChanged=new signals.Signal,this._currency="",this.currencyChanged=new signals.Signal}return _createClass(ShellModel,[{key:"backgrounds",get:function(){return this._backgrounds},set:function(value){this._backgrounds=value,this.backgroundsChanged.dispatch(value)}},{key:"screensavers",get:function(){return this._screensavers},set:function(value){this._screensavers=value,this.screensaversChanged.dispatch(value)}},{key:"pageBackgrounds",get:function(){return this._pageBackgrounds},set:function(value){this._pageBackgrounds=value,this.pageBackgroundsChanged.dispatch(value)}},{key:"elements",get:function(){return this._elements},set:function(value){this._elements=value,this.elementsChanged.dispatch(value)}},{key:"priceFormat",get:function(){return this._priceFormat},set:function(value){this._priceFormat=value,this.priceFormatChanged.dispatch(value)}},{key:"currency",get:function(){return this._currency},set:function(value){this._currency=value,this.currencyChanged.dispatch(value)}}]),ShellModel}(),window.app.SurveyModel=function(){function SurveyModel(SNAPLocation,storageProvider){_classCallCheck(this,SurveyModel);var self=this;this._isEnabled=Boolean(SNAPLocation.surveys),this._surveys={},this._store=storageProvider("snap_survey"),this._feedbackSurvey=null,this.feedbackSurveyChanged=new signals.Signal,this.surveyCompleted=new signals.Signal,this._store.read().then(function(value){self._surveys=value||self._surveys})}return _createClass(SurveyModel,[{key:"isEnabled",get:function(){return Boolean(this._isEnabled)}},{key:"feedbackSurvey",get:function(){return this._feedbackSurvey},set:function(value){this._feedbackSurvey=value,this.feedbackSurveyChanged.dispatch(this._feedbackSurvey)}},{key:"feedbackSurveyComplete",get:function(){return Boolean(this._surveys.feedback)},set:function(value){this._surveys.feedback=Boolean(value),this._store.write(this._surveys),this.surveyCompleted.dispatch(this.feedbackSurvey)}}]),SurveyModel}(),window.app.CordovaLocalStorageStore=function(){function CordovaLocalStorageStore(id,Logger){if(_classCallCheck(this,CordovaLocalStorageStore),this._id=id,this._Logger=Logger,!localStorage)throw Error("Cordova not found.")}return _createClass(CordovaLocalStorageStore,[{key:"clear",value:function(){try{return localStorage.removeItem(this._id),Promise.resolve()}catch(e){return this._Logger.warn("Unable to clear store #"+this._id+": "+e.message),Promise.reject(e)}}},{key:"read",value:function(){try{var value=JSON.parse(localStorage.getItem(this._id));return Promise.resolve(value)}catch(e){return this._Logger.warn("Unable to read from store #"+this._id+": "+e.message),Promise.reject(e)}}},{key:"readSync",value:function(){try{var value=JSON.parse(localStorage.getItem(this._id));return value}catch(e){return void this._Logger.warn("Unable to read from store #"+this._id+": "+e.message)}}},{key:"write",value:function(value){try{return localStorage.setItem(this._id,JSON.stringify(value)),Promise.resolve()}catch(e){return this._Logger.warn("Unable to write to store #"+this._id+": "+e.message),Promise.reject(e)}}}]),CordovaLocalStorageStore}(),window.app.InMemoryStore=function(){function InMemoryStore(){_classCallCheck(this,InMemoryStore),this._storage=null}return _createClass(InMemoryStore,[{key:"clear",value:function(){return this._storage=void 0,Promise.resolve()}},{key:"read",value:function(){return Promise.resolve(this._storage)}},{key:"readSync",value:function(){return this._storage}},{key:"write",value:function(value){return this._storage=value,Promise.resolve()}}]),InMemoryStore}(),window.app.LocalStorageStore=function(){function LocalStorageStore(id){if(_classCallCheck(this,LocalStorageStore),this._id=id,!store)throw Error("Store.js not found.")}return _createClass(LocalStorageStore,[{key:"clear",value:function(){try{return store.remove(this._id),Promise.resolve()}catch(e){return Promise.reject(e)}}},{key:"read",value:function(){try{var value=store.get(this._id);return Promise.resolve(value)}catch(e){return Promise.reject(e)}}},{key:"readSync",value:function(){try{return store.get(this._id)}catch(e){return void 0}}},{key:"write",value:function(value){try{return store.set(this._id,value),Promise.resolve()}catch(e){return Promise.reject(e)}}}]),LocalStorageStore}(),window.app.BackendApi=function BackendApi(Hosts,SessionModel){function businessTokenProvider(){return self._SessionModel.apiToken?Promise.resolve(self._SessionModel.apiToken.access_token):Promise.reject()}function customerTokenProvider(){return self._SessionModel.customerToken?Promise.resolve(self._SessionModel.customerToken.access_token):Promise.reject()}_classCallCheck(this,BackendApi),this._SessionModel=SessionModel;var self=this;for(var key in DtsApiClient){var config={host:{domain:Hosts.api.host,secure:"true"===Hosts.api.secure}},provider=businessTokenProvider;"snap"===key?config.host.domain=Hosts.content.host:"customer"===key&&(provider=customerTokenProvider),this[key]=new DtsApiClient[key](config,provider)}},window.app.CordovaCardReader=function(){function CordovaCardReader(){if(_classCallCheck(this,CordovaCardReader),this.onReceived=new signals.Signal,this.onError=new signals.Signal,!window.IDTech)throw new Error("Card reader is not available.")}return _createClass(CordovaCardReader,[{key:"received",value:function(card){this.onReceived.dispatch(card)}},{key:"error",value:function(e){this.onError.dispatch(e)}},{key:"start",value:function(){var _this18=this;this._active||(this._active=!0,window.IDTech.startCardReader(function(data){return _this18._onReceived(data)},function(e){return _this18._onError(e)}))}},{key:"stop",value:function(){this._active&&(this._active=!1,window.IDTech.stopCardReader(function(){},function(e){}))}},{key:"_onReceived",value:function(data){this._active&&this.received({data:data})}},{key:"_onError",value:function(data){this._active&&this.error({cause:parseInt(data)||2})}}]),CordovaCardReader}(),function(){var CardReader=function(ManagementService){this._ManagementService=ManagementService,this.onReceived=new signals.Signal,this.onError=new signals.Signal};CardReader.prototype.received=function(card){this.onReceived.dispatch(card)},CardReader.prototype.error=function(e){this.onError.dispatch(e)},CardReader.prototype.start=function(){var _this19=this;this._active||(this._ManagementService.startCardReader().then(function(data){_this19.received(data)},function(e){_this19.error(e)}),this._active=!0)},CardReader.prototype.stop=function(){this._active&&(this._ManagementService.stopCardReader(),this._active=!1)},window.app.CardReader=CardReader}(),window.app.CordovaManagementService=function(){function CordovaManagementService(){if(_classCallCheck(this,CordovaManagementService),!window.cordova)throw new Error("Cordova is not available.");window.screen&&(this._orientation=window.screen.orientation)}return _createClass(CordovaManagementService,[{key:"loadReset",value:function(){return new Promise(function(){return window.open("reset.html","_self")})}},{key:"loadStartup",value:function(){return new Promise(function(){return window.open("startup.html","_self")})}},{key:"loadApplication",value:function(location){return new Promise(function(){return window.open("snap_"+location.theme.layout+".html","_self")})}},{key:"rotateScreen",value:function(){if(!window.screen||!this._orientation)return Promise.resolve();var self=this;return new Promise(function(resolve){var orientation;switch(self._orientation.type){case"landscape":case"landscape-primary":orientation="landscape-secondary";break;case"landscape-secondary":orientation="landscape-primary";break;default:orientation="landscape-primary"}window.screen.lockOrientation(orientation),resolve()})}},{key:"openBrowser",value:function(url){return new Promise(function(resolve){var settings={location:"yes",clearcache:"yes",clearsessioncache:"yes",zoom:"no",hardwareback:"no"},ref=new app.CordovaWebBrowserReference(url);ref.attach(window.open(url,"_blank",Object.keys(settings).map(function(x){return x+"="+settings[x]}).join(","))),resolve(ref)})}},{key:"closeBrowser",value:function(reference){return new Promise(function(resolve){reference.exit(),resolve()})}},{key:"getSoundVolume",value:function(){return window.volume?new Promise(function(resolve,reject){window.volume.getVolume(resolve,reject)}):Promise.resolve(100)}},{key:"setSoundVolume",value:function(value){return value>=0&&100>=value?window.volume?new Promise(function(resolve,reject){window.volume.setVolume(value,resolve,reject)}):Promise.resolve():Promise.reject("Invalid value: "+value)}},{key:"getDisplayBrightness",value:function(){return window.brightness?new Promise(function(resolve,reject){window.brightness.getBrightness(function(value){return 0>value?resolve(50):(value=parseInt(100*value),value=Math.min(100,value),value=Math.max(0,value),void resolve(value))},reject)}):Promise.resolve(100)}},{key:"setDisplayBrightness",value:function(value){return value>=0&&100>=value?window.brightness?new Promise(function(resolve,reject){window.brightness.setBrightness(value/100,function(){return resolve()},reject)}):Promise.resolve():Promise.reject("Invalid value: "+value)}},{key:"startCardReader",value:function(){return new Promise(function(resolve,reject){IDTech.startCardReader(resolve,reject)})}},{key:"stopCardReader",value:function(){return new Promise(function(resolve,reject){IDTech.stopCardReader(resolve,reject)})}}]),CordovaManagementService}(),window.app.ElectronManagementService=function(){function ElectronManagementService(){if(_classCallCheck(this,ElectronManagementService),!require)throw new Error("Node.js context not found.");if(this._ipc=require("ipc"),!this._ipc)throw new Error("IPC module not found.")}return _createClass(ElectronManagementService,[{key:"loadReset",value:function(){return new Promise(function(){return window.location.assign("reset.html")})}},{key:"loadStartup",value:function(){return new Promise(function(){return window.location.assign("startup.html")})}},{key:"loadApplication",value:function(location){return new Promise(function(){return window.location.assign("snap_"+location.theme.layout+".html")})}},{key:"openBrowser",value:function(url){return Promise.resolve(new app.WebViewBrowserReference(url))}},{key:"closeBrowser",value:function(reference){return new Promise(function(resolve){reference.exit(),resolve()})}},{key:"rotateScreen",value:function(){var _this20=this;return new Promise(function(resolve){_this20._ipc.send("rotate-screen"),resolve()})}},{key:"getSoundVolume",value:function(){var _this21=this;return new Promise(function(resolve){_this21._ipc.on("get-sound-volume-result",function(value){resolve(100*parseFloat(value))}),_this21._ipc.send("get-sound-volume")})}},{key:"setSoundVolume",value:function(){var _this22=this;return value>=0&&value<=100?new Promise(function(resolve){_this22._ipc.send("set-sound-volume",.01*value),resolve()}):Promise.reject("Invalid value: "+value)}},{key:"getDisplayBrightness",value:function(){var _this23=this;return new Promise(function(resolve){_this23._ipc.on("get-display-brightness-result",function(value){resolve(100*parseFloat(value))}),_this23._ipc.send("get-display-brightness")})}},{key:"setDisplayBrightness",value:function(value){var _this24=this;return value>=0&&100>=value?new Promise(function(resolve){_this24._ipc.send("set-display-brightness",.01*value),resolve()}):Promise.reject("Invalid value: "+value)}},{key:"startCardReader",value:function(){var _this25=this;return new Promise(function(resolve,reject){_this25._ipc.on("card-reader-result",function(data){resolve(data)}),_this25._ipc.on("card-reader-error",function(){reject()}),_this25._ipc.send("start-card-reader")})}},{key:"stopCardReader",value:function(){var _this26=this;return new Promise(function(resolve){_this26._ipc.send("stop-card-reader"),resolve()})}}]),ElectronManagementService}(),window.app.GenericManagementService=function(){function GenericManagementService(){_classCallCheck(this,GenericManagementService)}return _createClass(GenericManagementService,[{key:"loadReset",value:function(){return new Promise(function(){return window.location.assign("reset.html")})}},{key:"loadStartup",value:function(){return new Promise(function(){return window.location.assign("startup.html")})}},{key:"loadApplication",value:function(location){return new Promise(function(){return window.location.assign("snap_"+location.theme.layout+".html")})}},{key:"openBrowser",value:function(url){return Promise.resolve(new app.IframeWebBrowserReference(url))}},{key:"closeBrowser",value:function(reference){return new Promise(function(resolve){reference.exit(),resolve()})}},{key:"rotateScreen",value:function(){return Promise.reject()}},{key:"getSoundVolume",value:function(){return Promise.reject()}},{key:"setSoundVolume",value:function(){return Promise.reject()}},{key:"getDisplayBrightness",value:function(){return Promise.reject()}},{key:"setDisplayBrightness",
value:function(){return Promise.reject()}},{key:"startCardReader",value:function(){return Promise.reject()}},{key:"stopCardReader",value:function(){return Promise.reject()}}]),GenericManagementService}(),window.app.SocketClient=function(){function SocketClient(SessionModel,Hosts,Logger){_classCallCheck(this,SocketClient);var self=this;this._SessionModel=SessionModel,this._Logger=Logger,this.isConnectedChanged=new signals.Signal,this._channels={},this._isConnected=!1,this._socket=socketCluster.connect({hostname:Hosts.socket.host,path:Hosts.socket.path,port:Hosts.socket.port,secure:Hosts.socket.secure}),this._socket.on("connect",function(status){self._Logger.debug("Socket connected."),self._authenticate()}),this._socket.on("disconnect",function(){self._Logger.debug("Socket disconnected."),self._isConnected=!1,self.isConnectedChanged.dispatch(self.isConnected)})}return _createClass(SocketClient,[{key:"subscribe",value:function(topic,handler){this._getChannel(topic).watch(handler)}},{key:"send",value:function(topic,data){this._getChannel(topic).publish(data)}},{key:"_getChannel",value:function(topic){return this._channels[topic]||(this._channels[topic]=this._socket.subscribe(topic))}},{key:"_authenticate",value:function(){var self=this;self._socket.emit("authenticate",{access_token:self._SessionModel.apiToken},function(err){return err?void self._Logger.warn("Unable to authenticate socket: "+err.message):(self._isConnected=!0,void self.isConnectedChanged.dispatch(self.isConnected))})}},{key:"isConnected",get:function(){return this._isConnected}}]),SocketClient}(),window.app.TelemetryService=function(){function TelemetryService($resource){_classCallCheck(this,TelemetryService),this._api={submitTelemetry:$resource("/snap/telemetry",{},{query:{method:"POST"}}),submitLogs:$resource("/snap/logs",{},{query:{method:"POST"}})}}return _createClass(TelemetryService,[{key:"submitTelemetry",value:function(data){return this._api.submitTelemetry.query(data).$promise}},{key:"submitLogs",value:function(data){return this._api.submitLogs.query(data).$promise}}]),TelemetryService}(),window.app.WebBrowser=function(){function WebBrowser(AnalyticsModel,ManagementService,SNAPEnvironment,SNAPHosts){_classCallCheck(this,WebBrowser),this._AnalyticsModel=AnalyticsModel,this._ManagementService=ManagementService,this._SNAPEnvironment=SNAPEnvironment,this._localHosts=Object.keys(SNAPHosts).map(function(p){return SNAPHosts[p].host}).filter(function(h){return Boolean(h)}),this._localHosts.push("localhost"),this.onOpened=new signals.Signal,this.onClosed=new signals.Signal,this.onNavigated=new signals.Signal,this._browser=null}return _createClass(WebBrowser,[{key:"open",value:function(url){var _this27=this;return this._browser?(this._browser.navigate(url),Promise.resolve(this._browser)):new Promise(function(resolve,reject){_this27._ManagementService.openBrowser(url).then(function(browser){_this27._browser=browser,_this27.onOpened.dispatch(_this27._browser),_this27._browser.onNavigated.add(function(url){_this27.onNavigated.dispatch(url);var host=URI(url).hostname();-1===_this27._localHosts.indexOf(host)&&_this27._AnalyticsModel.logUrl(url)}),_this27._browser.onExit.addOnce(function(){_this27.onClosed.dispatch(),_this27._browser=null}),resolve(browser)},reject)})}},{key:"close",value:function(){var _this28=this;return this._browser?this._ManagementService.closeBrowser(this._browser).then(function(){_this28._browser=null,_this28.onClosed.dispatch()}):Promise.resolve()}},{key:"getFlashUrl",value:function(url,width,height){return"flash.html#media="+encodeURIComponent(url)+("&width="+encodeURIComponent(width))+("&height="+encodeURIComponent(height))}},{key:"isPrivateUrl",value:function(url){return!url.startsWith("http")||-1!==this._localHosts.indexOf(URI(url).hostname())}}]),WebBrowser}(),window.app.FlashStarter=function(){function FlashStarter(Logger,SNAPHosts){_classCallCheck(this,FlashStarter),this._Logger=Logger,this._SNAPHosts=SNAPHosts}return _createClass(FlashStarter,[{key:"start",value:function(containerId,url,width,height){var flashvars={},params={menu:"false",wmode:"direct",allowFullScreen:"false"},attributes={id:containerId,name:containerId},self=this;swfobject.embedSWF(url,containerId,width,height,"16.0.0","expressInstall.swf",flashvars,params,attributes,function(res){res.success!==!0&&self._Logger.warn("Unable to start Flash in container #"+containerId+": "+url+" "+width+"/"+height)})}}]),FlashStarter}(),window.app.HeatMap=function(){function HeatMap(element){_classCallCheck(this,HeatMap);var self=this;this._listener=function(e){self._onClick(e)},this._element=element,this._element.addEventListener("click",this._listener),this.clicked=new signals.Signal}return _createClass(HeatMap,[{key:"dispose",value:function(){this._element.removeEventListener("click",this._listener)}},{key:"_onClick",value:function(e){var data={x:e.layerX/this._element.clientWidth,y:e.layerY/this._element.clientHeight};data.x<0||data.y<0||data.x>1||data.y>1||this.clicked.dispatch(data)}}]),HeatMap}(),window.app.Logger=function(){function _class(SNAPEnvironment){_classCallCheck(this,_class),this._SNAPEnvironment=SNAPEnvironment,this._log=log4javascript.getLogger();var ajaxAppender=new log4javascript.AjaxAppender("/snap/log");ajaxAppender.setWaitForResponse(!0),ajaxAppender.setLayout(new log4javascript.JsonLayout),ajaxAppender.setThreshold(log4javascript.Level.ERROR),this._log.addAppender(ajaxAppender),this._log.addAppender(new log4javascript.BrowserConsoleAppender)}return _createClass(_class,[{key:"debug",value:function(){var _log;(_log=this._log).debug.apply(_log,arguments)}},{key:"info",value:function(){var _log2;(_log2=this._log).info.apply(_log2,arguments)}},{key:"warn",value:function(){var _log3;(_log3=this._log).warn.apply(_log3,arguments)}},{key:"error",value:function(){var _log4;(_log4=this._log).error.apply(_log4,arguments)}},{key:"fatal",value:function(){var _log5;(_log5=this._log).fatal.apply(_log5,arguments)}}]),_class}(),window.app.ApplicationBootstraper=function(){function ApplicationBootstraper(name,options){_classCallCheck(this,ApplicationBootstraper),this.name=name,this.options=options||{},this.hosts={api:{host:"api2.managesnap.com",secure:!0},content:{host:"content.managesnap.com",secure:!1},media:{host:"content.managesnap.com",secure:!1},"static":{path:this.options.static_path||"/"},socket:{host:"web-dev.managesnap.com",secure:!0,port:8080,path:"/socket/"},games:{host:"static.managesnap.com"}},this.environment={debug:this.options.debug||!1,platform:this.options.platform||"web",version:SNAP_VERSION||"0.0.0",main_application:{client_id:"d67610b1c91044d8abd55cbda6c619f0",callback_url:"https://api2.managesnap.com/callback/api",scope:""},customer_application:{client_id:"91381a86b3b444fd876df80b22d7fa6e"},facebook_application:{client_id:"349729518545313",redirect_url:"https://web.managesnap.com/callback/facebook"},googleplus_application:{client_id:"678998250941-1dmebp4ksni9tsjth45tsht8l7cl1mrn.apps.googleusercontent.com",redirect_url:"https://web.managesnap.com/callback/googleplus"},twitter_application:{consumer_key:"yQ8XJ15PmaPOi4L5DJPikGCI0",redirect_url:"https://web.managesnap.com/callback/twitter"}},this.dependencies=["ngRoute","ngAnimate","ngTouch","ngSanitize","SNAP.configs","SNAP.controllers","SNAP.directives","SNAP.filters","SNAP.services"]}return _createClass(ApplicationBootstraper,[{key:"configure",value:function(){var _this29=this;return new Promise(function(resolve,reject){_this29.options.access_token&&_this29._getStore("snap_accesstoken").write(_this29.options.access_token);_this29._getStore("snap_location");_this29._getStore("snap_location").read().then(function(config){_this29.location=config||null,!_this29.location&&_this29.options.location&&_this29._getStore("snap_location").write(_this29.options.location),angular.module("SNAP.configs",[]).constant("SNAPLocation",_this29.location).constant("SNAPEnvironment",_this29.environment).constant("SNAPHosts",_this29.hosts),_this29.hosts["static"].host&&$sceDelegateProvider.resourceUrlWhitelist(["self",new RegExp(".*"+_this29.hosts["static"].host+".*")]);var app=angular.module(_this29.name,_this29.dependencies);resolve(app)},reject)})}},{key:"run",value:function(){angular.bootstrap(document,[this.name])}},{key:"_getPartialUrl",value:function(name){if(!this.hosts)throw new Error("Missing hosts configuration.");if(!this.location)throw new Error("Missing location configuration.");var path=this.hosts["static"].host?"//"+this.hosts["static"].host+this.hosts["static"].path:""+this.hosts["static"].path;return path+"assets/"+this.location.theme.layout+"/partials/"+name+".html"}},{key:"_getStore",value:function(id){switch(this.environment.platform){case"mobile":return new app.CordovaLocalStorageStore(id);default:return new app.LocalStorageStore(id)}}}]),ApplicationBootstraper}(),window.app.SnapApplicationBootstraper=function(_app$ApplicationBootstraper){function SnapApplicationBootstraper(options){_classCallCheck(this,SnapApplicationBootstraper),_get(Object.getPrototypeOf(SnapApplicationBootstraper.prototype),"constructor",this).call(this,"SNAPApplication",options)}return _inherits(SnapApplicationBootstraper,_app$ApplicationBootstraper),_createClass(SnapApplicationBootstraper,[{key:"configure",value:function(){var _this30=this;return _get(Object.getPrototypeOf(SnapApplicationBootstraper.prototype),"configure",this).call(this).then(function(app){return app.config(["$locationProvider","$routeProvider","$sceDelegateProvider",function($locationProvider,$routeProvider,$sceDelegateProvider){$locationProvider.html5Mode(!1),$routeProvider.when("/",{template:" ",controller:"HomeBaseCtrl"}),$routeProvider.when("/menu/:token",{template:" ",controller:"MenuBaseCtrl"}),$routeProvider.when("/category/:token",{template:" ",controller:"CategoryBaseCtrl"}),$routeProvider.when("/item/:token",{template:" ",controller:"ItemBaseCtrl"}),$routeProvider.when("/checkout",{templateUrl:_this30._getPartialUrl("checkout"),controller:"CheckoutCtrl"}),$routeProvider.when("/signin",{templateUrl:_this30._getPartialUrl("signin"),controller:"SignInCtrl"}),$routeProvider.when("/account",{templateUrl:_this30._getPartialUrl("account"),controller:"AccountCtrl"}),$routeProvider.when("/chat",{templateUrl:_this30._getPartialUrl("chat"),controller:"ChatCtrl"}),$routeProvider.when("/chatmap",{templateUrl:_this30._getPartialUrl("chatmap"),controller:"ChatMapCtrl"}),$routeProvider.when("/survey",{templateUrl:_this30._getPartialUrl("survey"),controller:"SurveyCtrl"}),$routeProvider.otherwise({redirectTo:"/"})}])})}}]),SnapApplicationBootstraper}(app.ApplicationBootstraper),window.app.StartupApplicationBootstraper=function(_app$ApplicationBootstraper2){function StartupApplicationBootstraper(options){_classCallCheck(this,StartupApplicationBootstraper),_get(Object.getPrototypeOf(StartupApplicationBootstraper.prototype),"constructor",this).call(this,"SNAPStartup",options)}return _inherits(StartupApplicationBootstraper,_app$ApplicationBootstraper2),StartupApplicationBootstraper}(app.ApplicationBootstraper),window.app.ResetApplicationBootstraper=function(_app$ApplicationBootstraper3){function ResetApplicationBootstraper(options){_classCallCheck(this,ResetApplicationBootstraper),_get(Object.getPrototypeOf(ResetApplicationBootstraper.prototype),"constructor",this).call(this,"SNAPReset",options)}return _inherits(ResetApplicationBootstraper,_app$ApplicationBootstraper3),ResetApplicationBootstraper}(app.ApplicationBootstraper),window.app.FlashApplicationBootstraper=function(_app$ApplicationBootstraper4){function FlashApplicationBootstraper(options){_classCallCheck(this,FlashApplicationBootstraper),_get(Object.getPrototypeOf(FlashApplicationBootstraper.prototype),"constructor",this).call(this,"SNAPFlash",options)}return _inherits(FlashApplicationBootstraper,_app$ApplicationBootstraper4),FlashApplicationBootstraper}(app.ApplicationBootstraper),window.app.SnapAuxiliaresApplicationBootstraper=function(_app$ApplicationBootstraper5){function SnapAuxiliaresApplicationBootstraper(options){_classCallCheck(this,SnapAuxiliaresApplicationBootstraper),_get(Object.getPrototypeOf(SnapAuxiliaresApplicationBootstraper.prototype),"constructor",this).call(this,"SNAPAuxiliares",options)}return _inherits(SnapAuxiliaresApplicationBootstraper,_app$ApplicationBootstraper5),_createClass(SnapAuxiliaresApplicationBootstraper,[{key:"configure",value:function(){var _this31=this;return _get(Object.getPrototypeOf(SnapAuxiliaresApplicationBootstraper.prototype),"configure",this).call(this).then(function(app){return app.config(["$locationProvider","$routeProvider",function($locationProvider,$routeProvider){$locationProvider.html5Mode(!1),$routeProvider.when("/",{templateUrl:_this31._getPartialUrl("chatroom"),controller:"ChatRoomCtrl"}),$routeProvider.otherwise({redirectTo:"/"})}])})}}]),SnapAuxiliaresApplicationBootstraper}(app.ApplicationBootstraper),angular.module("SNAP.controllers",["angular-bacon"]),angular.module("SNAP.controllers").controller("AccountCtrl",["$scope","CustomerManager","DialogManager","NavigationManager",function($scope,CustomerManager,DialogManager,NavigationManager){if(!CustomerManager.model.isEnabled||!CustomerManager.model.isAuthenticated)return void(NavigationManager.location={type:"home"});$scope.profile=CustomerManager.model.profile,$scope.canChangePassword=CustomerManager.model.hasCredentials;$scope.$watchAsProperty("profile");CustomerManager.model.profileChanged.add(function(value){$scope.profile=value,$scope.canChangePassword=CustomerManager.model.hasCredentials,$scope.canChangeEmail=CustomerManager.model.hasCredentials}),$scope.editProfile=function(){$scope.profileedit=angular.copy($scope.profile),$scope.showProfileEdit=!0},$scope.editPassword=function(){$scope.passwordedit={old_password:"",new_password:""},$scope.showProfileEdit=!1,$scope.showPasswordEdit=!0},$scope.editPayment=function(){$scope.showPaymentEdit=!0},$scope.profileEditSubmit=function(){var job=DialogManager.startJob();CustomerManager.updateProfile($scope.profileedit).then(function(){DialogManager.endJob(job),$scope.showProfileEdit=!1},function(e){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})},$scope.profileEditCancel=function(){$scope.showProfileEdit=!1},$scope.passwordEditSubmit=function(){var job=DialogManager.startJob();CustomerManager.changePassword($scope.passwordedit).then(function(){DialogManager.endJob(job),$scope.showPasswordEdit=!1},function(e){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})},$scope.passwordEditCancel=function(){$scope.showPasswordEdit=!1}}]),angular.module("SNAP.controllers").controller("BackgroundCtrl",["$scope","$timeout","ShellManager","NavigationManager",function($scope,$timeout,ShellManager,NavigationManager){function showImages(values){$timeout(function(){$scope.images=values.map(function(item){return{src:ShellManager.getMediaUrl(item.media,1920,1080,"jpg"),type:ShellManager.getMediaType(item.media)}})})}var backgrounds=ShellManager.model.backgrounds,pageBackgrounds=null;showImages(backgrounds),ShellManager.model.backgroundsChanged.add(function(value){backgrounds=value,showImages(backgrounds)}),NavigationManager.locationChanged.add(function(location){var newPageBackgrounds=ShellManager.getPageBackgrounds(location);if(newPageBackgrounds.length>0)return pageBackgrounds=newPageBackgrounds,void showImages(pageBackgrounds);if(pageBackgrounds)switch(location.type){case"menu":case"category":case"item":return}pageBackgrounds=null,showImages(backgrounds)})}]),angular.module("SNAP.controllers").controller("CartCtrl",["$scope","$timeout","$sce","CustomerManager","ShellManager","NavigationManager","OrderManager","DialogManager","CartModel","LocationModel","ChatManager",function($scope,$timeout,$sce,CustomerManager,ShellManager,NavigationManager,OrderManager,DialogManager,CartModel,LocationModel,ChatManager){$scope.getMediaUrl=function(media,width,height,extension){return ShellManager.getMediaUrl(media,width,height,extension)},$scope.formatPrice=function(value){return ShellManager.formatPrice(value)},$scope.options={},$scope.state=CartModel.cartState,CartModel.cartStateChanged.add(function(state){return $timeout(function(){return $scope.state=state})}),$scope.currentOrder=OrderManager.model.orderCart,OrderManager.model.orderCartChanged.add(function(value){return $scope.currentOrder=value}),$scope.totalOrder=OrderManager.model.orderCheck,OrderManager.model.orderCheckChanged.add(function(value){return $scope.totalOrder=value}),$scope.giftSeat=LocationModel.getSeat(ChatManager.model.giftSeat),ChatManager.model.giftSeatChanged.add(function(token){$timeout(function(){return $scope.giftSeat=LocationModel.getSeat(token)})}),$scope.requestAssistanceAvailable=!0,$scope.requestCloseoutAvailable=!0,$scope.checkoutEnabled=CustomerManager.model.isEnabled,$scope.toGoOrder=!1,$scope.visible=CartModel.isCartOpen,NavigationManager.locationChanging.add(function(location){"category"!==location.type&&(CartModel.isCartOpen=!1)}),CartModel.isCartOpenChanged.add(function(value){$scope.showCart(),$scope.visible=value}),$scope.seat_name=LocationModel.seat?LocationModel.seat.name:"Table",LocationModel.seatChanged.add(function(seat){return $scope.seat_name=seat?seat.name:"Table"});var refreshAssistanceRequest=function(){$scope.requestAssistanceAvailable=null===OrderManager.model.assistanceRequest},refreshCloseoutRequest=function(){$scope.requestCloseoutAvailable=null===OrderManager.model.closeoutRequest};OrderManager.model.assistanceRequestChanged.add(refreshAssistanceRequest),OrderManager.model.closeoutRequestChanged.add(refreshCloseoutRequest),refreshAssistanceRequest(),refreshCloseoutRequest(),$scope.calculateDescription=function(entry){var result=entry.name||entry.item.title;return result+=entry.modifiers.reduce(function(output,category){return output+category.modifiers.reduce(function(output,modifier){return output+(modifier.isSelected?"<br/>- "+modifier.data.title:"")},"")},""),$sce.trustAsHtml(result)},$scope.calculatePrice=function(entry){return OrderManager.calculatePrice(entry)},$scope.calculateTotalPrice=function(entries){return OrderManager.calculateTotalPrice(entries)},$scope.editItem=function(entry){return CartModel.openEditor(entry,!1)},$scope.removeFromCart=function(entry){return $scope.currentOrder=OrderManager.removeFromCart(entry)},$scope.reorderItem=function(entry){return $scope.currentOrder=OrderManager.addToCart(entry.clone())},$scope.submitCart=function(){var job=DialogManager.startJob(),options=$scope.options.to_go_order?2:0;OrderManager.submitCart(options).then(function(){DialogManager.endJob(job),$scope.$apply(function(){$scope.currentOrder=OrderManager.model.orderCart,$scope.totalOrder=OrderManager.model.orderCheck,$scope.toGoOrder=!1}),DialogManager.alert(ALERT_REQUEST_ORDER_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})},$scope.clearCart=function(){$scope.toGoOrder=!1,$scope.currentOrder=OrderManager.clearCart()},$scope.closeCart=function(){CartModel.isCartOpen=!1,$scope.showCart()},$scope.showHistory=function(){return CartModel.cartState=CartModel.STATE_HISTORY},$scope.showCart=function(){return CartModel.cartState=CartModel.STATE_CART},$scope.payCheck=function(){return NavigationManager.location={type:"checkout"}},$scope.requestAssistance=function(){$scope.requestAssistanceAvailable&&DialogManager.confirm(ALERT_TABLE_ASSISTANCE).then(function(){var job=DialogManager.startJob();OrderManager.requestAssistance().then(function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_ASSISTANCE_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})})},$scope.requestCloseout=function(){if($scope.requestCloseoutAvailable){var job=DialogManager.startJob();OrderManager.requestCloseout().then(function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_CLOSEOUT_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})}}}]),angular.module("SNAP.controllers").controller("CategoryBaseCtrl",["$scope","$timeout","DataManager","NavigationManager",function($scope,$timeout,DataManager,NavigationManager){}]),angular.module("SNAP.controllers").controller("CategoryCtrl",["$scope","$timeout","DataManager","NavigationManager","SNAPEnvironment","ShellManager",function($scope,$timeout,DataManager,NavigationManager,SNAPEnvironment,ShellManager){var CategoryList=React.createClass({displayName:"CategoryList",render:function(){var tileClassName=ShellManager.tileStyle,rows=this.props.tiles.map(function(tile,i){return React.DOM.td({className:tileClassName,key:i},React.DOM.a({onClick:function(e){e.preventDefault(),NavigationManager.location=tile.destination},style:{backgroundImage:"url("+ShellManager.getMediaUrl(tile.image,370,370)+")"}},React.DOM.span(null,tile.title)))}).reduce(function(result,value,i){return result[i%2].push(value),result},[[],[]]).map(function(row,i){return React.DOM.tr({key:i},row)});return React.DOM.table({className:"tile-table"},rows)}});NavigationManager.locationChanging.add(function(location){DataManager.category="category"===location.type?location.token:void 0,$scope.visible=Boolean(DataManager.category),$timeout(function(){$scope.$apply()})}),DataManager.categoryChanged.add(function(data){if(data){var tiles,categories=data.categories||[];tiles=data.items||[],tiles=categories.concat(tiles),"desktop"!==SNAPEnvironment.platform&&(tiles=tiles.filter(function(tile){return 3!==tile.type})),tiles.forEach(function(tile){tile.url="#"+NavigationManager.getPath(tile.destination)}),React.render(React.createElement(CategoryList,{tiles:tiles}),document.getElementById("content-category"))}})}]),angular.module("SNAP.controllers").controller("ChatCtrl",["$scope","$timeout","CustomerManager","ChatManager","DialogManager","NavigationManager","LocationModel","ShellManager","SNAPLocation",function($scope,$timeout,CustomerManager,ChatManager,DialogManager,NavigationManager,LocationModel,ShellManager,SNAPLocation){if(!SNAPLocation.chat)return void(NavigationManager.location={type:"home"});$scope.locationName=SNAPLocation.location_name,$scope.getPartialUrl=function(name){return ShellManager.getPartialUrl(name)},$scope.chatEnabled=ChatManager.model.isEnabled,ChatManager.model.isEnabledChanged.add(function(value){$timeout(function(){return $scope.chatEnabled=value})}),$scope.activeDevices=ChatManager.model.activeDevices,ChatManager.model.activeDevicesChanged.add(function(value){$timeout(function(){return $scope.activeDevices=value})}),$scope.giftSeat=LocationModel.getSeat(ChatManager.model.giftSeat),ChatManager.model.giftSeatChanged.add(function(token){$timeout(function(){return $scope.giftSeat=LocationModel.getSeat(token)})}),$scope.giftDevice=ChatManager.model.giftDevice,ChatManager.model.giftDeviceChanged.add(function(value){$timeout(function(){return $scope.giftDevice=value})}),$scope.toggleChat=function(){ChatManager.model.isEnabled=!ChatManager.model.isEnabled},$scope.openMap=function(){NavigationManager.location={type:"chatmap"}},$scope.getDeviceName=function(device_token){return ChatManager.getDeviceName(device_token)},$scope.getSeatNumber=function(device_token){var device=LocationModel.getDevice(device_token);for(var p in LocationModel.seats)if(LocationModel.seats[p].token===device.seat){var match=LocationModel.seats[p].name.match(/\d+/);return match?match[0]||"":""}return""},$scope.closeChat=function(device_token){DialogManager.confirm("Are you sure you would like to close the chat with "+$scope.getDeviceName(device_token)+"?").then(function(){ChatManager.declineDevice(device_token)})},$scope.getUnreadCount=function(device_token){return ChatManager.getUnreadCount(device_token)},$scope.sendGift=function(device_token){var device=LocationModel.getDevice(device_token),seat=LocationModel.getSeat(device.seat);seat&&DialogManager.confirm("Are you sure that you want to send a gift to "+seat.name+"?").then(function(){ChatManager.startGift(device_token),NavigationManager.location={type:"home"}})},$scope.cancelGift=function(){return ChatManager.endGift()},ChatManager.isPresent=!0;var watchLocation=!0;$scope.$on("$locationChangeStart",function(){watchLocation&&(ChatManager.model.isPresent=!1,watchLocation=!1)})}]),angular.module("SNAP.controllers").controller("ChatBoxCtrl",["$scope","$timeout","$attrs","ChatManager","LocationModel",function($scope,$timeout,$attrs,ChatManager,LocationModel){function showMessages(){$timeout(function(){$scope.messages=ChatManager.model.history.filter(function(message){return message.type===type&&(message.device===to_device||message.to_device===to_device)})})}var to_device=$scope.device,type=to_device?ChatManager.MESSAGE_TYPES.DEVICE:ChatManager.MESSAGE_TYPES.LOCATION;to_device?LocationModel.getDevice(to_device):null;$scope.readonly=Boolean($attrs.readonly),$scope.chat={},$scope.messages=[],$scope.chatEnabled=ChatManager.model.isEnabled,ChatManager.model.isEnabledChanged.add(function(value){$timeout(function(){return $scope.chatEnabled=value})}),$scope.isConnected=ChatManager.model.isConnected,ChatManager.model.isConnectedChanged.add(function(value){$timeout(function(){return $scope.isConnected=value})}),$scope.sendMessage=function(){if($scope.isConnected&&$scope.chat.message){var message={type:type,to_device:to_device,text:$scope.chat.message};ChatManager.sendMessage(message),$scope.chat.message=""}},$scope.getFromName=function(message){return ChatManager.getMessageName(message)},$scope.getStatusText=function(message){if(message.to_device===to_device)switch(message.status){case ChatManager.MESSAGE_STATUSES.CHAT_REQUEST:return"You have requested to chat with "+ChatManager.getDeviceName(message.to_device);case ChatManager.MESSAGE_STATUSES.CHAT_REQUEST_ACCEPTED:return"Accepted chat request";case ChatManager.MESSAGE_STATUSES.CHAT_REQUEST_DECLINED:return"Declined chat request";case ChatManager.MESSAGE_STATUSES.CHAT_CLOSED:return"Closed the chat";case ChatManager.MESSAGE_STATUSES.GIFT_REQUEST:return"Gift request sent";case ChatManager.MESSAGE_STATUSES.GIFT_REQUEST_ACCEPTED:return"Accepted a gift";case ChatManager.MESSAGE_STATUSES.GIFT_REQUEST_DECLINED:return"Declined a gift"}else if(message.device===to_device)switch(message.status){case ChatManager.MESSAGE_STATUSES.CHAT_REQUEST:return $scope.getFromName(message)+" would like to chat with you";case ChatManager.MESSAGE_STATUSES.CHAT_REQUEST_ACCEPTED:return"Accepted chat request";case ChatManager.MESSAGE_STATUSES.CHAT_REQUEST_DECLINED:return"Declined chat request";case ChatManager.MESSAGE_STATUSES.CHAT_CLOSED:return"Closed the chat";case ChatManager.MESSAGE_STATUSES.GIFT_REQUEST:return"Would like to send you a gift";case ChatManager.MESSAGE_STATUSES.GIFT_REQUEST_ACCEPTED:return"Accepted a gift";case ChatManager.MESSAGE_STATUSES.GIFT_REQUEST_DECLINED:return"Declined a gift"}},$scope.isUnread=function(message){return message.to_device===to_device?!1:ChatManager.checkIfUnread(to_device,message)},$scope.markAsRead=function(){to_device&&ChatManager.markAsRead(to_device)},$scope.onKeydown=function(keycode){13===keycode&&$timeout(function(){$scope.sendMessage()})},LocationModel.devicesChanged.add(showMessages),LocationModel.seatsChanged.add(showMessages),ChatManager.model.historyChanged.add(showMessages),showMessages()}]),angular.module("SNAP.controllers").controller("ChatMapCtrl",["$scope","$timeout","ChatManager","ShellManager","DialogManager","NavigationManager","LocationModel",function($scope,$timeout,ChatManager,ShellManager,DialogManager,NavigationManager,LocationModel){function buildMap(){LocationModel.seat&&$timeout(function(){$scope.seats=LocationModel.seats.filter(function(seat){return seat.token!==LocationModel.seat.token}).map(function(seat){var devices=LocationModel.devices.filter(function(device){return device.seat===seat.token}).map(function(device){return{token:device.token,seat:device.seat,is_available:device.is_available,username:device.username}});return{token:seat.token,name:seat.name,devices:devices,map_position_x:seat.map_position_x,map_position_y:seat.map_position_y,is_available:devices.filter(function(device){return device.is_available}).length>0}})})}$scope.seats=[],$scope.mapImage=ShellManager.model.elements.location_map,ShellManager.model.elementsChanged.add(function(){$timeout(function(){return $scope.mapImage=ShellManager.model.elements.location_map})}),LocationModel.devicesChanged.add(buildMap),LocationModel.seatsChanged.add(buildMap),LocationModel.seatChanged.add(buildMap),buildMap(),$scope.chooseSeat=function(seat){var device=seat.devices[0];if(!seat.is_available||!device){var deviceName=device&&device.username?device.username:seat.name;return void DialogManager.alert(deviceName+" is unavailable for chat")}ChatManager.approveDevice(device.token),$scope.exitMap()},$scope.exitMap=function(){NavigationManager.location={type:"chat"}}}]),angular.module("SNAP.controllers").controller("ChatRoomCtrl",["$scope","$timeout","ChatManager","NavigationManager","ShellManager","SNAPLocation",function($scope,$timeout,ChatManager,NavigationManager,ShellManager,SNAPLocation){return SNAPLocation.chat?($scope.locationName=SNAPLocation.location_name,void($scope.getPartialUrl=function(name){return ShellManager.getPartialUrl(name)})):void(NavigationManager.location={type:"home"})}]),angular.module("SNAP.controllers").controller("CheckoutCtrl",["$scope","$timeout","CustomerManager","OrderManager","DialogManager","NavigationManager","SessionManager","ShellManager","LocationModel","SurveyManager",function($scope,$timeout,CustomerManager,OrderManager,DialogManager,NavigationManager,SessionManager,ShellManager,LocationModel,SurveyManager){function startNextCheck(){$scope.current;return $scope.options.index===$scope.options.count-1?(OrderManager.clearCheck(),void(NavigationManager.location={type:SurveyManager.model.isEnabled?"survey":"home"})):void $timeout(function(){$scope.options.index++,$scope.options.step=$scope.STEP_TIPPING})}$scope.CHECK_SPLIT_NONE=0,$scope.CHECK_SPLIT_BY_ITEMS=1,$scope.CHECK_SPLIT_EVENLY=2,$scope.PAYMENT_METHOD_CARD=1,$scope.PAYMENT_METHOD_CASH=2,$scope.PAYMENT_METHOD_PAYPAL=3,$scope.RECEIPT_METHOD_NONE=0,$scope.RECEIPT_METHOD_EMAIL=1,$scope.RECEIPT_METHOD_SMS=2,$scope.RECEIPT_METHOD_PRINT=3,$scope.STEP_CHECK_SPLIT=0,$scope.STEP_PAYMENT=1,$scope.STEP_TIPPING=2,$scope.STEP_SIGNATURE=3,$scope.STEP_RECEIPT=4,$scope.STEP_COMPLETE=5,$scope.options={},$scope.data=[{items:OrderManager.model.orderCheck}];var data=$scope.$watchAsProperty("data");data.changes().subscribe(function(value){if(value.value){var data=value.value();$scope.options.count=data.length}$scope.options.index=0}),$scope.options.guest_count_min=2,$scope.options.guest_count_max=9,$scope.options.guest_count=SessionManager.guestCount,$scope.options.check_split=$scope.CHECK_SPLIT_NONE,$scope.options.index=0;var index=$scope.$watchAsProperty("options.index");Bacon.combineAsArray(index,data).subscribe(function(){$scope.current=$scope.data[$scope.options.index],CustomerManager.model.isAuthenticated&&!CustomerManager.model.isGuest&&($scope.current.receipt_phone=$scope.current.receipt_phone||CustomerManager.model.profile.phone,$scope.current.receipt_email=CustomerManager.model.hasCredentials?CustomerManager.model.profile.email:$scope.current.receipt_email),$scope.current.items&&($scope.current.subtotal=OrderManager.calculateTotalPrice($scope.current.items),$scope.current.tax=OrderManager.calculateTax($scope.current.items)),$scope.current.tip||($scope.current.tip=0),$scope.checkName=$scope.current.name&&$scope.options.step!==$scope.STEP_CHECK_SPLIT?$scope.current.name:CustomerManager.customerName+" Bill"}),$scope.options.step=$scope.options.guest_count_max>1?$scope.STEP_CHECK_SPLIT:$scope.STEP_TIPPING;var step=$scope.$watchAsProperty("options.step");return step.skipDuplicates().subscribe(function(value){if(value.value){var step=value.value();step===$scope.STEP_COMPLETE&&startNextCheck()}}),$scope.options.seat=LocationModel.seat?LocationModel.seat.name:"Table",
LocationModel.seatChanged.add(function(seat){$scope.options.seat=seat?seat.name:"Table"}),$scope.currency=ShellManager.model.currency,ShellManager.model.currencyChanged.add(function(currency){return $timeout(function(){return $scope.currency=currency})}),$scope.checkName=null,$scope.getPartialUrl=function(name){return ShellManager.getPartialUrl(name)},$scope.calculateTitle=function(entry){return entry.name||entry.item.title},$scope.calculatePrice=function(entry){return OrderManager.calculatePrice(entry)},$scope.calculateTotalPrice=function(entries){return OrderManager.calculateTotalPrice(entries)},$scope.formatPrice=function(value){return ShellManager.formatPrice(value||0)},CustomerManager.model.isAuthenticated?void($scope.initialized=!0):void(NavigationManager.location={type:"signin"})}]),angular.module("SNAP.controllers").controller("CheckoutPaymentCtrl",["$scope","$timeout","CustomerModel","CardReader","DialogManager","OrderManager","Logger","SNAPEnvironment",function($scope,$timeout,CustomerModel,CardReader,DialogManager,OrderManager,Logger,SNAPEnvironment){function generatePaymentToken(){var job=DialogManager.startJob();OrderManager.generatePaymentToken().then(function(){DialogManager.endJob(job)},function(e){Logger.debug("Payment token generation error: "+JSON.stringify(e)),DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})}function cardDataReceived(card){$timeout(function(){$scope.current.items&&OrderManager.clearCheck($scope.current.items),$scope.current.card_data=card.data,$scope.options.step=$scope.STEP_SIGNATURE})}CardReader.onReceived.add(function(data){Logger.debug("Card reader result: "+JSON.stringify(data));var card={number:data.card_number,month:data.expiration_month,year:data.expiration_year,data:data.data};CardReader.stop(),cardDataReceived(card)}),CardReader.onError.add(function(e){Logger.debug("Card reader error: "+JSON.stringify(e)),DialogManager.alert(ALERT_CARDREADER_ERROR).then(function(){$timeout(function(){return $scope.payCardCancel()})})}),$scope.$on("$locationChangeStart",function(){CardReader.stop()}),$scope.canPayCard="web"!==SNAPEnvironment.platform,$scope.payCard=function(){$scope.current.payment_method=$scope.PAYMENT_METHOD_CARD,CardReader.start()},$scope.payCardCancel=function(){$scope.current.payment_method=void 0,CardReader.stop()},$scope.payCash=function(){if($scope.current.payment_method=$scope.PAYMENT_METHOD_CASH,null!==OrderManager.model.closeoutRequest)return DialogManager.alert(ALERT_REQUEST_CLOSEOUT_SENT),void $timeout(function(){$scope.current.items&&OrderManager.clearCheck($scope.current.items),$scope.options.step=$scope.STEP_COMPLETE});var job=DialogManager.startJob();OrderManager.requestCloseout().then(function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_CLOSEOUT_SENT),$timeout(function(){$scope.current.items&&OrderManager.clearCheck($scope.current.items),$scope.options.step=$scope.STEP_COMPLETE})},function(e){Logger.debug("Request closeout error: "+JSON.stringify(e)),DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})},generatePaymentToken()}]),angular.module("SNAP.controllers").controller("CheckoutReceiptCtrl",["$scope","$timeout","DialogManager","OrderManager",function($scope,$timeout,DialogManager,OrderManager){function requestReceipt(){var item=$scope.current,request={checkout_token:item.checkout_token,receipt_method:item.receipt_method};item.receipt_method===$scope.RECEIPT_METHOD_EMAIL?request.receipt_email=item.receipt_email:item.receipt_method===$scope.RECEIPT_METHOD_SMS&&(request.receipt_phone=item.receipt_phone);var job=DialogManager.startJob();OrderManager.requestReceipt(request).then(function(){DialogManager.endJob(job),$timeout(function(){$scope.options.step=$scope.STEP_COMPLETE,$scope.emailEditorOpen=!1})},function(e){$timeout(function(){$scope.emailEditorOpen=!1}),DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})}$scope.emailEditorOpen=!1,$scope.receiptNone=function(){$scope.current.receipt_method=$scope.RECEIPT_METHOD_NONE,$scope.options.step=$scope.STEP_COMPLETE},$scope.receiptEmail=function(){$scope.current.receipt_email&&($scope.current.receipt_method=$scope.RECEIPT_METHOD_EMAIL,requestReceipt())},$scope.receiptSms=function(){$scope.current.receipt_phone&&($scope.current.receipt_phone=$scope.RECEIPT_METHOD_SMS,requestReceipt())},$scope.receiptPrint=function(){$scope.current.receipt_method=$scope.RECEIPT_METHOD_PRINT,requestReceipt()},$scope.receiptEditEmail=function(){$scope.emailEditorOpen=!0}}]),angular.module("SNAP.controllers").controller("CheckoutSignatureCtrl",["$scope","$timeout","DialogManager","OrderManager","Logger",function($scope,$timeout,DialogManager,OrderManager,Logger){function completeCheckout(){var item=$scope.current,job=DialogManager.startJob(),request={amount_subtotal:item.subtotal,amount_tax:item.tax,amount_tip:item.tip,card_data:item.card_data,signature_token:item.signature_token,order_tokens:null!==item.items?item.items.reduce(function(result,item){for(var i=0;i<item.quantity;i++)result.push(item.request);return result},[]):null};OrderManager.payOrder(request).then(function(result){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_CLOSEOUT_SENT),$timeout(function(){$scope.current.checkout_token=result.token,$scope.options.step=$scope.STEP_RECEIPT})},function(e){Logger.debug("Order payment error: "+JSON.stringify(e)),DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})}var resetSignature=function(){$timeout(function(){$scope.current.signature_token=void 0;var signature=$("#checkout-signature-input");signature.empty(),signature.jSignature("init",{color:"#000","background-color":"#fff","decor-color":"#fff",width:"100%",height:"200px"})},300)};$scope.signatureSubmit=function(){var signature=$("#checkout-signature-input");if(0!==signature.jSignature("getData","native").length){var job=DialogManager.startJob(),sig=signature.jSignature("getData","image");OrderManager.uploadSignature(sig[1]).then(function(token){DialogManager.endJob(job),$timeout(function(){$scope.current.signature_token=token,completeCheckout()})},function(e){Logger.debug("Signature upload error: "+JSON.stringify(e)),DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})}},$scope.signatureCancel=function(){resetSignature()};var step=$scope.$watchAsProperty("options.step");step.skipDuplicates().subscribe(function(value){value.value&&value.value()===$scope.STEP_SIGNATURE&&resetSignature()})}]),angular.module("SNAP.controllers").controller("CheckoutSplitCtrl",["$scope","$timeout","OrderManager",function($scope,$timeout,OrderManager){$scope.splitCheck=function(type){var i,data=[];if(type===$scope.CHECK_SPLIT_NONE)data.push({items:OrderManager.model.orderCheck}),$scope.options.guest_count=1,$scope.options.step=$scope.STEP_TIPPING;else if(type===$scope.CHECK_SPLIT_EVENLY){var check=OrderManager.model.orderCheck,subtotal=OrderManager.calculateTotalPrice(check),tax=OrderManager.calculateTax(check);for(i=0;i<$scope.options.guest_count;i++)data.push({subtotal:Math.round(subtotal/$scope.options.guest_count*100)/100,tax:Math.round(tax/$scope.options.guest_count*100)/100});$scope.options.step=$scope.STEP_TIPPING}else if(type===$scope.CHECK_SPLIT_BY_ITEMS){for(i=0;i<$scope.options.guest_count;i++)data.push({items:[]});$scope.split_items=OrderManager.copyItems(OrderManager.model.orderCheck)}$scope.$parent.data=data,$scope.options.check_split=type},$scope.addToCheck=function(entry){$scope.split_items=$scope.split_items.map(function(item){return item.request!==entry.request?item:item.quantity>1?(item.quantity--,item.clone()):null}).filter(function(item){return null!==item});var exists=!1;if($scope.current.items=$scope.current.items.map(function(item){return item.request===entry.request?(exists=!0,item.quantity++,item.clone()):item}),!exists){var clone=entry.clone();clone.quantity=1,$scope.current.items.push(clone)}},$scope.removeFromCheck=function(entry){$scope.current.items=$scope.current.items.map(function(item){return item.request!==entry.request?item:item.quantity>1?(item.quantity--,item.clone()):null}).filter(function(item){return null!==item});var exists=!1;if($scope.split_items=$scope.split_items.map(function(item){return item.request===entry.request?(exists=!0,item.quantity++,item.clone()):item}),!exists){var clone=entry.clone();clone.quantity=1,$scope.split_items.push(clone)}},$scope.addAllToCheck=function(){$scope.split_items.forEach($scope.addToCheck),$scope.split_items.forEach(function(item){$scope.current.items.forEach(function(newitem){newitem.request===item.request&&(newitem.quantity+=item.quantity)})}),$scope.split_items=[]},$scope.removeAllFromCheck=function(){$scope.current.items.forEach($scope.removeFromCheck),$scope.current.items.forEach(function(item){$scope.split_items.forEach(function(newitem){newitem.request===item.request&&(newitem.quantity+=item.quantity)})}),$scope.current.items=[]},$scope.splitNextCheck=function(){return $scope.options.index<$scope.options.count-1&&$scope.split_items.length>0?void $scope.options.index++:($scope.split_items.length>0&&$scope.addAllToCheck(),void $timeout(function(){$scope.$parent.data=$scope.$parent.data.filter(function(check){return check.items.length>0}),$scope.options.step=$scope.STEP_TIPPING}))};var step=$scope.$watchAsProperty("options.step");step.skipDuplicates().subscribe(function(value){value.value&&value.value()===$scope.STEP_CHECK_SPLIT&&$timeout(function(){$scope.options.check_split=$scope.CHECK_SPLIT_NONE})})}]),angular.module("SNAP.controllers").controller("CheckoutTipCtrl",["$scope","$timeout","OrderManager",function($scope,$timeout,OrderManager){$scope.tipEditorOpen=!1,$scope.data={tipAmount:0},$scope.addTip=function(amount){amount>=0&&($scope.data.tipAmount=amount,$scope.current.tip=Math.round($scope.current.subtotal*amount*100)/100)},$scope.applyTip=function(){$scope.options.step=$scope.STEP_PAYMENT,$scope.tipEditorOpen=!1},$scope.editTip=function(){$scope.tipEditorOpen=!0,$scope.addTip(.2)},$scope.cancelEditTip=function(){$scope.tipEditorOpen=!1,$scope.addTip(0)},$scope.$watchAsProperty("data.tipAmount").skipDuplicates().subscribe(function(value){if(value.value){var amount=parseFloat(value.value());amount>=0&&$scope.addTip(amount)}})}]),angular.module("SNAP.controllers").factory("CommandBoot",["AuthenticationManager","LocationManager",function(AuthenticationManager,LocationManager){function loadLocation(){return LocationManager.loadConfig().then(function(){return LocationManager.loadSeats()})}return function(){return AuthenticationManager.validate().then(function(authorized){return authorized===!1?AuthenticationManager.authorize().then(function(){return loadLocation()}):loadLocation()})}}]),angular.module("SNAP.controllers").factory("CommandCloseTable",["ManagementService",function(ManagementService){return function(){return ManagementService.loadReset()}}]),angular.module("SNAP.controllers").factory("CommandCustomerGuestLogin",["AuthenticationManager","CustomerManager",function(AuthenticationManager,CustomerManager){return function(){return CustomerManager.guestLogin()}}]),angular.module("SNAP.controllers").factory("CommandCustomerLogin",["AuthenticationManager","CustomerManager",function(AuthenticationManager,CustomerManager){return function(credentials){return AuthenticationManager.customerLoginRegular(credentials).then(function(){return CustomerManager.login(credentials)})}}]),angular.module("SNAP.controllers").factory("CommandCustomerSignup",["AuthenticationManager","CustomerManager",function(AuthenticationManager,CustomerManager){return function(registration){return CustomerManager.signUp(registration).then(function(){var credentials={login:registration.username,password:registration.password};return AuthenticationManager.customerLoginRegular(credentials).then(function(){return CustomerManager.login(credentials)})})}}]),angular.module("SNAP.controllers").factory("CommandCustomerSocialLogin",["AuthenticationManager","CustomerManager","SocialManager",function(AuthenticationManager,CustomerManager,SocialManager){function doLogin(auth){return AuthenticationManager.customerLoginSocial(auth).then(function(){return CustomerManager.loginSocial(auth)})}return{facebook:function(){return SocialManager.loginFacebook().then(doLogin)},googleplus:function(){return SocialManager.loginGooglePlus().then(doLogin)},twitter:function(){return SocialManager.loginTwitter().then(doLogin)}}}]),angular.module("SNAP.controllers").factory("CommandFlipScreen",["ManagementService",function(ManagementService){return function(){ManagementService.rotateScreen()}}]),angular.module("SNAP.controllers").factory("CommandReset",["AnalyticsManager","ChatManager","CustomerManager","OrderManager","SessionManager","SurveyManager","ManagementService","Logger",function(AnalyticsManager,ChatManager,CustomerManager,OrderManager,SessionManager,SurveyManager,ManagementService,Logger){return function(){return new Promise(function(resolve,reject){Q.all([AnalyticsManager.initialize(),SessionManager.initialize()]).then(function(){SessionManager.endSession().then(function(){Q.allSettled([AnalyticsManager.submit(),OrderManager.reset(),SurveyManager.reset(),CustomerManager.reset(),ChatManager.reset()]).spread(function(){Logger.debug("Reset completed successfully.")},function(e){Logger.warn("Unable to reset properly: "+e)}).then(resolve,reject)},reject)},reject)})}}]),angular.module("SNAP.controllers").factory("CommandStartup",["Logger","AnalyticsManager","ChatManager","ShellManager","CustomerManager","DataManager","NavigationManager","SessionManager","SurveyManager","SNAPLocation",function(Logger,AnalyticsManager,ChatManager,ShellManager,CustomerManager,DataManager,NavigationManager,SessionManager,SurveyManager,SNAPLocation){return function(){return new Promise(function(result,reject){Q.allSettled([AnalyticsManager.initialize(),ChatManager.initialize(),CustomerManager.initialize(),NavigationManager.initialize(),ShellManager.initialize(),SessionManager.initialize(),SurveyManager.initialize()]).then(function(){CustomerManager.model.isEnabled?CustomerManager.model.isAuthenticated||(NavigationManager.location={type:"signin"}):CustomerManager.guestLogin(),DataManager.initialize()},reject)})}}]),angular.module("SNAP.controllers").factory("CommandSubmitOrder",["DialogManager","LocationModel","OrderManager",function(DialogManager,LocationModel,OrderManager){return function(options){if(!LocationModel.seat||!LocationModel.seat.token)return void DialogManager.alert(ALERT_ERROR_NO_SEAT);var job=DialogManager.startJob();options=options||0,OrderManager.submitCart(options).then(function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_ORDER_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})}}]),angular.module("SNAP.controllers").controller("DialogCtrl",["$scope","$timeout","ActivityMonitor","DialogManager",function($scope,$timeout,ActivityMonitor,DialogManager){function updateVisibility(isBusy,showAlert,showConfirm){$timeout(function(){$scope.isBusy=void 0!==isBusy?isBusy:$scope.isBusy,$scope.showAlert=void 0!==showAlert?showAlert:$scope.showAlert,$scope.showConfirm=void 0!==showConfirm?showConfirm:$scope.showConfirm,$scope.visible=$scope.isBusy||$scope.showAlert||$scope.showConfirm})}function showNextAlert(){alertTimer&&$timeout.cancel(alertTimer);var alert=alertStack[alertIndex];return alert&&alert.resolve&&alert.resolve(),alertIndex++,alertIndex===alertStack.length?(updateVisibility(void 0,!1),alertStack=[],void(alertIndex=-1)):($timeout(function(){$scope.alertTitle=alertStack[alertIndex].title,$scope.alertText=alertStack[alertIndex].message,updateVisibility(void 0,!0)}),void(alertTimer=$timeout(showNextAlert,1e4)))}function showNextConfirm(){return confirmIndex++,confirmIndex===confirmStack.length?(updateVisibility(void 0,void 0,!1),confirmStack=[],void(confirmIndex=-1)):void $timeout(function(){$scope.confirmText=confirmStack[confirmIndex].message,updateVisibility(void 0,void 0,!0)})}function getMessage(message){if("string"!=typeof message)switch(message){case ALERT_GENERIC_ERROR:message="Oops! My bits are fiddled. Our request system has been disconnected. Please notify a server.";break;case ALERT_REQUEST_SUBMIT_ERROR:message="Oops! My bits are fiddled. Our request system has been disconnected. Please notify a server.";break;case ALERT_REQUEST_ASSISTANCE_SENT:message="Call Server request was sent successfully.";break;case ALERT_REQUEST_ASSISTANCE_RECEIVED:message="Your request for server assistance has been seen, and accepted.";break;case ALERT_REQUEST_CLOSEOUT_SENT:message="Request check request was sent successfully.";break;case ALERT_REQUEST_CLOSEOUT_RECEIVED:message="Your check request has been seen, and accepted.";break;case ALERT_REQUEST_ORDER_SENT:message="Order sent! You will be notified when your waiter accepts the order.";break;case ALERT_REQUEST_ORDER_RECEIVED:message="Your order has been successfully accepted.";break;case ALERT_SIGNIN_REQUIRED:message="You must be logged into SNAP to access this page.";break;case ALERT_TABLE_ASSISTANCE:message="Are you sure you want to call the waiter?";break;case ALERT_TABLE_CLOSEOUT:message="Are you sure you want to request your check?";break;case ALERT_TABLE_RESET:message="Are you sure you want to reset?";break;case ALERT_DELET_CARD:message="Are you sure you want to remove this payment method?";break;case ALERT_PASSWORD_RESET_COMPLETE:message="A link to change your password has been emailed.";break;case ALERT_SOFTWARE_OUTDATED:message="A software update is available. Please restart the application.";break;case ALERT_CARDREADER_ERROR:message="Unable to read the card data. Please try again.";break;case ALERT_ERROR_NO_SEAT:message="Device is not assigned to any table.";break;case ALERT_ERROR_STARTUP:message="Unable to start the application."}return message}function alertRequested(message,title,resolve,reject){message=getMessage(message),alertStack.push({title:title,message:message,resolve:resolve,reject:reject}),$scope.showAlert||$timeout(showNextAlert)}function confirmRequested(message,resolve,reject){message=getMessage(message),confirmStack.push({message:message,resolve:resolve,reject:reject}),$scope.showConfirm||$timeout(showNextConfirm)}function jobStarted(){document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur(),updateVisibility(!0)}var alertTimer,alertStack=[],confirmStack=[],alertIndex=-1,confirmIndex=-1;$scope.visible=!1,$scope.isBusy=!1,$scope.showAlert=!1,$scope.showConfirm=!1,$scope.closeAlert=function(){ActivityMonitor.activityDetected(),showNextAlert()},$scope.closeConfirm=function(confirmed){ActivityMonitor.activityDetected();var confirm=confirmStack[confirmIndex];confirm&&(confirmed?confirm.resolve&&confirm.resolve():confirm.reject&&confirm.reject()),showNextConfirm()},DialogManager.alertRequested.add(alertRequested),DialogManager.confirmRequested.add(confirmRequested),DialogManager.jobStarted.add(jobStarted),DialogManager.jobEnded.add(function(){updateVisibility(!1)}),DialogManager.jobs>0&&jobStarted()}]),angular.module("SNAP.controllers").controller("FlashCtrl",["$timeout","FlashStarter","NavigationManager","ShellManager",function($timeout,FlashStarter,NavigationManager,ShellManager){$timeout(function(){var url=ShellManager.getMediaUrl({token:NavigationManager.getQueryParameter("media"),mime_type:"application/x-shockwave-flash"});FlashStarter.start("media-container",url,NavigationManager.getQueryParameter("width"),NavigationManager.getQueryParameter("height"))},1e3)}]),angular.module("SNAP.controllers").controller("GalaxiesAdvertisementCtrl",["$scope","$timeout","ActivityMonitor","AnalyticsModel","ShellManager","DataManager","DataModel","DialogManager","NavigationManager","CommandFlipScreen","ShellManager","WebBrowser","SNAPEnvironment",function($scope,$timeout,ActivityMonitor,AnalyticsModel,hellManager,DataManager,DataModel,DialogManager,NavigationManager,CommandFlipScreen,ShellManager,WebBrowser,SNAPEnvironment){$scope.visible=!1,$scope.advertisementClick=function(item){return CustomerManager.model.isEnabled&&!CustomerManager.model.isAuthenticated?void DialogManager.alert(ALERT_SIGNIN_REQUIRED):(AnalyticsModel.logAdvertisement({token:item.token,type:"click"}),void(item.href&&WebBrowser.open(item.href.url)))},$scope.advertisementImpression=function(item){ActivityMonitor.active&&$scope.visible&&AnalyticsModel.logAdvertisement({token:item.token,type:"impression"})},$scope.advertisements=[],DataModel.advertisements().then(function(data){$timeout(function(){$scope.advertisements=data.main.map(function(ad){return{src:ShellManager.getMediaUrl(ad.src,970,90),href:ad.href,type:ShellManager.getMediaType(ad.src),token:ad.token}})})}),NavigationManager.locationChanging.add(function(location){$scope.visible="home"===location.type,$timeout(function(){return $scope.$apply()})})}]),angular.module("SNAP.controllers").controller("GalaxiesCartCtrl",["$scope","$timeout","$sce","CustomerManager","ShellManager","NavigationManager","OrderManager","DialogManager","CartModel","LocationModel","ChatManager",function($scope,$timeout,$sce,CustomerManager,ShellManager,NavigationManager,OrderManager,DialogManager,CartModel,LocationModel,ChatManager){$scope.STATE_CART=CartModel.STATE_CART,$scope.STATE_HISTORY=CartModel.STATE_HISTORY,$scope.getMediaUrl=function(media,width,height,extension){return ShellManager.getMediaUrl(media,width,height,extension)},$scope.formatPrice=function(value){return ShellManager.formatPrice(value)},$scope.options={},$scope.currency=ShellManager.model.currency,ShellManager.model.currencyChanged.add(function(currency){return $timeout(function(){return $scope.currency=currency})}),$scope.state=CartModel.cartState,CartModel.cartStateChanged.add(function(state){return $timeout(function(){return $scope.state=state})}),$scope.editableItem=CartModel.editableItem,CartModel.editableItemChanged.add(function(item){return $timeout(function(){return $scope.editableItem=item})}),$scope.currentOrder=OrderManager.model.orderCart,OrderManager.model.orderCartChanged.add(function(value){return $scope.currentOrder=value}),$scope.totalOrder=OrderManager.model.orderCheck,OrderManager.model.orderCheckChanged.add(function(value){return $scope.totalOrder=value}),$scope.giftSeat=LocationModel.getSeat(ChatManager.model.giftSeat),ChatManager.model.giftSeatChanged.add(function(token){$timeout(function(){return $scope.giftSeat=LocationModel.getSeat(token)})}),$scope.customerName=CustomerManager.customerName,CustomerManager.model.profileChanged.add(function(){$timeout(function(){return $scope.customerName=CustomerManager.customerName})}),$scope.checkoutEnabled=CustomerManager.model.isEnabled,$scope.visible=CartModel.isCartOpen,NavigationManager.locationChanging.add(function(location){"category"!==location.type&&(CartModel.isCartOpen=!1,CartModel.closeEditor())}),CartModel.isCartOpenChanged.add(function(value){$scope.showCart(),$scope.visible=value}),$scope.seat_name=LocationModel.seat?LocationModel.seat.name:"Table",LocationModel.seatChanged.add(function(seat){return $scope.seat_name=seat?seat.name:"Table"});var refreshAssistanceRequest=function(){$scope.requestAssistanceAvailable=null===OrderManager.model.assistanceRequest},refreshCloseoutRequest=function(){$scope.requestCloseoutAvailable=null===OrderManager.model.closeoutRequest};OrderManager.model.assistanceRequestChanged.add(refreshAssistanceRequest),OrderManager.model.closeoutRequestChanged.add(refreshCloseoutRequest),$scope.requestAssistanceAvailable=null===OrderManager.model.assistanceRequest,$scope.requestCloseoutAvailable=null===OrderManager.model.closeoutRequest,$scope.getModifiers=function(entry){return entry.modifiers?entry.modifiers.reduce(function(result,category){var modifiers=category.modifiers.filter(function(modifier){return modifier.isSelected});return result=result.concat(modifiers)},[]):[]},$scope.calculatePrice=function(entry){return OrderManager.calculatePrice(entry)},$scope.calculateTotalPrice=function(entries){return OrderManager.calculateTotalPrice(entries)},$scope.editItem=function(entry){return CartModel.openEditor(entry,!1)},$scope.updateModifiers=function(category,modifier){1===category.data.selection?angular.forEach(category.modifiers,function(m){return m.isSelected=m===modifier}):modifier.isSelected=!modifier.isSelected},$scope.removeFromCart=function(entry){return $scope.currentOrder=OrderManager.removeFromCart(entry)},$scope.reorderItem=function(entry){return $scope.currentOrder=OrderManager.addToCart(entry.clone())},$scope.submitCart=function(){var job=DialogManager.startJob(),options=$scope.options.toGo?2:0;OrderManager.submitCart(options).then(function(){DialogManager.endJob(job),$scope.$apply(function(){$scope.currentOrder=OrderManager.model.orderCart,$scope.totalOrder=OrderManager.model.orderCheck,$scope.options.toGo=!1}),DialogManager.alert(ALERT_REQUEST_ORDER_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})},$scope.clearCart=function(){$scope.options.toGo=!1,$scope.currentOrder=OrderManager.clearCart()},$scope.closeEditor=function(){CartModel.closeEditor()},$scope.closeCart=function(){CartModel.isCartOpen=!1,CartModel.state=CartModel.STATE_CART},$scope.showHistory=function(){return CartModel.state=CartModel.STATE_HISTORY},$scope.showCart=function(){return CartModel.state=CartModel.STATE_CART},$scope.payCheck=function(){return NavigationManager.location={type:"checkout"}},$scope.requestAssistance=function(){$scope.requestAssistanceAvailable&&DialogManager.confirm(ALERT_TABLE_ASSISTANCE).then(function(){var job=DialogManager.startJob();OrderManager.requestAssistance().then(function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_ASSISTANCE_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})})},$scope.requestCloseout=function(){if($scope.requestCloseoutAvailable){var job=DialogManager.startJob();OrderManager.requestCloseout().then(function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_CLOSEOUT_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})}}}]),angular.module("SNAP.controllers").controller("GalaxiesCategoryCtrl",["$scope","$timeout","DataManager","NavigationManager","ShellManager",function($scope,$timeout,DataManager,NavigationManager,ShellManager){$scope.goBack=function(){return NavigationManager.goBack()};var CategoryList=React.createClass({displayName:"CategoryList",render:function(){var rows=this.props.tiles.map(function(tile,i){var background=ShellManager.getMediaUrl(tile.image,470,410);return React.DOM.td({className:"tile tile-regular",key:i},React.DOM.a({onClick:function(e){e.preventDefault(),NavigationManager.location=tile.destination},style:{backgroundImage:background?'url("'+background+'")':null}},React.DOM.span(null,tile.title)))}).reduce(function(result,value,i){return result[i%2].push(value),result},[[],[]]).map(function(row,i){return React.DOM.tr({key:i},row)});return React.DOM.table({className:"tile-table"},rows)}});DataManager.categoryChanged.add(function(category){if(!category)return $timeout(function(){return $scope.category=null});var items=category&&category.items?category.items:[],categories=category&&category.categories?category.categories:[],tiles=categories.concat(items).map(function(item){return{title:item.title,image:item.image,url:"#"+NavigationManager.getPath(item.destination),destination:item.destination}}),element=document.getElementById("page-category-content");element&&React.render(React.createElement(CategoryList,{tiles:tiles}),element),$scope.category=category,$timeout(function(){return $scope.$apply()})}),NavigationManager.locationChanging.add(function(location){return"item"===location.type?void($scope.showModal=!0):($scope.showModal=!1,DataManager.category="category"===location.type?location.token:void 0,$scope.visible=Boolean(DataManager.category),void $timeout(function(){var container=document.getElementById("page-category-content-container");container&&(container.scrollLeft=0),$scope.$apply()}))})}]),angular.module("SNAP.controllers").controller("GalaxiesCheckoutSplitCtrl",["$scope","$timeout","CustomerManager","OrderManager",function($scope,$timeout,CustomerManager,OrderManager){var originalData;$scope.editGuestCount=function(type){(type===$scope.CHECK_SPLIT_EVENLY||type===$scope.CHECK_SPLIT_BY_ITEMS)&&(originalData=$scope.$parent.data,$scope.options.guest_count=$scope.options.guest_count_min),$scope.guestEditorType=type},$scope.cancelEditGuestCount=function(){$scope.guestEditorType=void 0,originalData=void 0},$scope.splitCheck=function(type){var i,data=[];if(type===$scope.CHECK_SPLIT_NONE)data.push({items:OrderManager.model.orderCheck}),$scope.options.guest_count=1,$scope.doneSplitting();else if(type===$scope.CHECK_SPLIT_EVENLY){var check=OrderManager.model.orderCheck,subtotal=OrderManager.calculateTotalPrice(check),tax=OrderManager.calculateTax(check);for(i=0;i<$scope.options.guest_count;i++)data.push({name:"Check 0"+(i+1),subtotal:Math.round(subtotal/$scope.options.guest_count*100)/100,tax:Math.round(tax/$scope.options.guest_count*100)/100});$scope.doneSplitting()}else if(type===$scope.CHECK_SPLIT_BY_ITEMS){for(i=0;i<$scope.options.guest_count;i++)data.push({name:"Check 0"+(i+1),items:[]});$scope.split_items=OrderManager.copyItems(OrderManager.model.orderCheck).reduce(function(result,item){for(;item.quantity>0;){var subitem=item.clone();subitem.quantity=1,result.push(subitem),item.quantity--}return result},[]),$scope.split_items.forEach(function(item){return item.check=data[0]}),data[0].items=data[0].items.concat($scope.split_items)}$scope.$parent.data=data,$scope.options.check_split=type,$scope.guestEditorType=void 0},$scope.getModifiers=function(entry){return entry.modifiers?entry.modifiers.reduce(function(result,category){var modifiers=category.modifiers.filter(function(modifier){return modifier.isSelected});return result=result.concat(modifiers)},[]):[]},$scope.calculateChecks=function(){$scope.$parent.data.forEach(function(check){check.items=$scope.split_items.filter(function(item){return item.check===check})})},$scope.cancelSplitting=function(){$scope.guestEditorType=$scope.options.check_split=void 0,$scope.$parent.data=originalData,originalData=void 0},$scope.doneSplitting=function(){$scope.$parent.data=$scope.$parent.data.filter(function(check){return check.subtotal>0||check.items&&check.items.length>0}),$scope.options.step=$scope.STEP_TIPPING}}]),angular.module("SNAP.controllers").controller("GalaxiesHomeCtrl",["$scope","$timeout","DataManager","NavigationManager","ShellManager","SNAPLocation",function($scope,$timeout,DataManager,NavigationManager,ShellManager,SNAPLocation){var HomeMenu=React.createClass({displayName:"HomeMenu",render:function(){var rows=[],home=this.props.home;Boolean(home.intro)&&rows.push(React.DOM.td({className:"tile tile-info",key:"intro"},React.DOM.div({},[React.DOM.h1({key:"intro-title"},home.intro.title||"Welcome to "+SNAPLocation.location_name),React.DOM.p({key:"intro-text"},home.intro.text)])));var tiles=this.props.tiles.map(function(tile,i){var background=ShellManager.getMediaUrl(tile.image,470,410);return React.DOM.td({className:"tile tile-regular",key:i},React.DOM.a({onClick:function(e){e.preventDefault(),NavigationManager.location=tile.destination},style:{backgroundImage:background?'url("'+background+'")':null}},React.DOM.span(null,tile.title)))});return rows=rows.concat(tiles).reduce(function(result,value){return result[0].push(value),result},[[]]).map(function(row,i){return React.DOM.tr({key:i},row)}),React.DOM.table({className:"tile-table"},rows)}});DataManager.homeChanged.add(function(home){if(home){var tiles=home.menus.map(function(menu){var destination={type:"menu",token:menu.token};return{title:menu.title,image:menu.image,url:"#"+NavigationManager.getPath(destination),destination:destination}}),element=document.getElementById("page-home-menu");
element&&React.render(React.createElement(HomeMenu,{tiles:tiles,home:home}),element)}}),NavigationManager.locationChanging.add(function(location){$scope.visible=Boolean("home"===location.type),$timeout(function(){var container=document.getElementById("page-home-menu-container");container&&(container.scrollLeft=0),$scope.$apply(),DataManager.home=$scope.visible})})}]),angular.module("SNAP.controllers").controller("GalaxiesItemCtrl",["$scope","$timeout","DataManager","NavigationManager","OrderManager","ShellManager","WebBrowser","CommandSubmitOrder",function($scope,$timeout,DataManager,NavigationManager,OrderManager,ShellManager,WebBrowser,CommandSubmitOrder){function onClose(){"item"===NavigationManager.location.type&&$timeout(function(){return $scope.goBack()})}$scope.goBack=function(){return NavigationManager.goBack()},DataManager.itemChanged.add(function(item){if(!item)return $timeout(function(){$scope.entry=$scope.entries=null,$scope.type=1,$scope.step=0,$scope.entryIndex=0});var type=item.type;if(2===type&&item.website)WebBrowser.open(item.website.url).then(function(browser){return browser.onExit.addOnce(onClose)});else if(3===type&&item.flash){var url=WebBrowser.getFlashUrl(item.flash.media.token,item.flash.width,item.flash.height);WebBrowser.open(url).then(function(browser){return browser.onExit.addOnce(onClose)})}$timeout(function(){1===type&&($scope.entry=new app.CartItem(item,1)),$scope.type=type,$scope.step=0,$scope.entryIndex=0})}),$scope.getMediaUrl=function(media,w,h,extension){return ShellManager.getMediaUrl(media,w,h,extension)},$scope.formatPrice=function(value){return value?ShellManager.formatPrice(value):0},$scope.nextStep=function(){0===$scope.step?$scope.entry.hasModifiers?($scope.entries=$scope.entry.cloneMany(),$scope.currentEntry=$scope.entries[$scope.entryIndex=0],$scope.step=1):(OrderManager.addToCart($scope.entry),$scope.step=2):1===$scope.step&&($scope.entryIndex===$scope.entries.length-1?($scope.entries.forEach(function(entry){return OrderManager.addToCart(entry)}),$scope.step=2):$scope.currentEntry=$scope.entries[++$scope.entryIndex])},$scope.previousStep=function(){1===$scope.step&&$scope.entryIndex>0?$scope.currentEntry=$scope.entries[--$scope.entryIndex]:0===$scope.step?$scope.goBack():$scope.step--},$scope.updateModifiers=function(category,modifier){1===category.data.selection?angular.forEach(category.modifiers,function(m){return m.isSelected=m===modifier}):modifier.isSelected=!modifier.isSelected},$scope.submitOrder=function(){CommandSubmitOrder(),$scope.goBack()},NavigationManager.locationChanging.add(function(location){DataManager.item="item"===location.type?location.token:void 0,$scope.visible=Boolean(DataManager.item),$timeout(function(){return $scope.$apply()})})}]),angular.module("SNAP.controllers").controller("GalaxiesItemEditCtrl",["$scope","ShellManager","NavigationManager","OrderManager","CartModel","CommandSubmitOrder",function($scope,ShellManager,NavigationManager,OrderManager,CartModel,CommandSubmitOrder){$scope.getMediaUrl=function(media,width,height,extension){return ShellManager.getMediaUrl(media,width,height,extension)},$scope.formatPrice=function(value){return ShellManager.formatPrice(value)};var currentIndex=-1,refreshNavigation=function(){$scope.entry&&$scope.entry.hasModifiers&&($scope.hasNextCategory=$scope.entry.modifiers.length>1&&currentIndex<$scope.entry.modifiers.length-1,$scope.hasPreviousCategory=currentIndex>0,$scope.category=$scope.entry.modifiers[currentIndex],$scope.canExit=CartModel.editableItemNew,$scope.canDone=!0)};NavigationManager.locationChanging.add(function(location){"menu"!==location.type&&"category"!==location.type&&$scope.exit()}),CartModel.isCartOpenChanged.add(function(value){value&&$scope.exit()});var init=function(value){$scope.entry=value,$scope.visible=null!==$scope.entry,currentIndex=0,refreshNavigation()};init(CartModel.editableItem),CartModel.editableItemChanged.add(function(value){init(value)}),$scope.getModifierTitle=function(modifier){return modifier.data.title+(modifier.data.price>0?" (+"+ShellManager.formatPrice(modifier.data.price)+")":"")},$scope.leftButtonClick=function(){currentIndex>0?$scope.previousCategory():$scope.exit()},$scope.leftButtonText=function(){return currentIndex>0?"Back":"Exit"},$scope.showLeftButton=function(){return currentIndex>0},$scope.rightButtonClick=function(){if(1===$scope.entry.modifiers[currentIndex].data.selection){var numSelected=0;if(angular.forEach($scope.entry.modifiers[currentIndex].modifiers,function(m){m.isSelected&&numSelected++}),1!==numSelected)return}$scope.hasNextCategory?$scope.nextCategory():$scope.done()},$scope.rightButtonText=function(){return $scope.hasNextCategory?"Next":"Done"},$scope.showRightButton=function(){return $scope.hasNextCategory},$scope.previousCategory=function(){currentIndex--,refreshNavigation()},$scope.nextCategory=function(){currentIndex++,refreshNavigation()},$scope.updateModifiers=function(category,modifier){modifier.isSelected=!modifier.isSelected,modifier.isSelected&&1===category.data.selection&&angular.forEach(category.modifiers,function(m){m.isSelected=m===modifier})},$scope.submitChanges=function(){OrderManager.removeFromCart($scope.entry),OrderManager.addToCart($scope.entry),$scope.exit()},$scope.done=function(){CartModel.editableItemNew&&OrderManager.addToCart(CartModel.editableItem),$scope.exit(),CartModel.isCartOpen=!0},$scope.exit=function(){CartModel.closeEditor()}}]),angular.module("SNAP.controllers").controller("GalaxiesMenuCtrl",["$scope","$timeout","DataManager","NavigationManager","ShellManager",function($scope,$timeout,DataManager,NavigationManager,ShellManager){$scope.goBack=function(){return NavigationManager.goBack()};var MenuList=React.createClass({displayName:"MenuList",render:function(){var rows=this.props.tiles.map(function(tile,i){var background=ShellManager.getMediaUrl(tile.image,470,410);return React.DOM.td({className:"tile tile-regular",key:i},React.DOM.a({onClick:function(e){e.preventDefault(),NavigationManager.location=tile.destination},style:{backgroundImage:background?'url("'+background+'")':null}},React.DOM.span(null,tile.title)))}).reduce(function(result,value,i){return result[i%2].push(value),result},[[],[]]).map(function(row,i){return React.DOM.tr({key:i},row)});return React.DOM.table({className:"tile-table"},rows)}});DataManager.menuChanged.add(function(menu){if(!menu)return $timeout(function(){return $scope.menu=null});var tiles=menu.categories.map(function(category){var destination={type:"category",token:category.token};return{title:category.title,image:category.image,url:"#"+NavigationManager.getPath(destination),destination:destination}}),element=document.getElementById("page-menu-content");element&&React.render(React.createElement(MenuList,{tiles:tiles}),element),$scope.menu=menu,$timeout(function(){return $scope.$apply()})}),NavigationManager.locationChanging.add(function(location){DataManager.menu="menu"===location.type?location.token:void 0,$scope.visible=Boolean(DataManager.menu),$timeout(function(){var container=document.getElementById("page-menu-content-container");container&&(container.scrollLeft=0),$scope.$apply()})})}]),angular.module("SNAP.controllers").controller("GalaxiesNavigationCtrl",["$scope","$timeout","ActivityMonitor","CustomerManager","AnalyticsModel","CartModel","ShellManager","DataManager","DataModel","DialogManager","LocationModel","ManagementService","NavigationManager","OrderManager","CommandCloseTable","CommandSubmitOrder","CommandFlipScreen","SNAPEnvironment","WebBrowser",function($scope,$timeout,ActivityMonitor,CustomerManager,AnalyticsModel,CartModel,ShellManager,DataManager,DataModel,DialogManager,LocationModel,ManagementService,NavigationManager,OrderManager,CommandCloseTable,CommandSubmitOrder,CommandFlipScreen,SNAPEnvironment,WebBrowser){$scope.menus=[],$scope.showVolume=$scope.showBrightness="web"!==SNAPEnvironment.platform,$scope.showRotate="web"!==SNAPEnvironment.platform,DataModel.home().then(function(response){if(response){var location=NavigationManager.location,limit="desktop"===SNAPEnvironment.platform?4:3;$scope.menus=response.menus.filter(function(menu){return"desktop"===SNAPEnvironment.platform||3!==menu.type}).filter(function(menu,i){return limit>i}).map(function(menu){var destination={type:"menu",token:menu.token};return{token:menu.token,title:menu.title,url:"#"+NavigationManager.getPath(destination),destination:destination,selected:"menu"===location.type&&menu.token===location.token}})}}),$scope.advertisementClick=function(item){item.href&&WebBrowser.open(item.href.url)},$scope.currentAdvertisement=null,$scope.advertisementImpression=function(item){$scope.currentAdvertisement=item,ActivityMonitor.active&&$scope.menuOpen&&AnalyticsModel.logAdvertisement({token:item.token,type:"impression"})},$scope.advertisements=[],DataModel.advertisements().then(function(data){$timeout(function(){$scope.advertisements=data.misc.map(function(ad){return{src:ShellManager.getMediaUrl(ad.src,300,250),href:ad.href,type:ShellManager.getMediaType(ad.src),token:ad.token}})})}),$scope.navigateHome=function(){ActivityMonitor.activityDetected(),$scope.settingsOpen=!1,NavigationManager.location={type:"home"}},$scope.navigateBack=function(){ActivityMonitor.activityDetected(),$scope.settingsOpen=!1,NavigationManager.goBack()},$scope.rotateScreen=function(){ActivityMonitor.activityDetected(),$scope.settingsOpen=!1,CommandFlipScreen()},$scope.openCart=function(){ActivityMonitor.activityDetected(),$scope.settingsOpen=!1,CartModel.isCartOpen=!CartModel.isCartOpen},$scope.seatName=LocationModel.seat?LocationModel.seat.name:"Table",LocationModel.seatChanged.add(function(value){return $timeout(function(){return $scope.seatName=value?value.name:"Table"})}),$scope.resetTable=function(){ActivityMonitor.activityDetected(),$scope.settingsOpen=!1,DialogManager.confirm(ALERT_TABLE_RESET).then(function(){var job=DialogManager.startJob();CommandCloseTable().then(function(){return DialogManager.endJob(job)})})},$scope.menuOpen=!1,$scope.toggleMenu=function(){ActivityMonitor.activityDetected(),$scope.menuOpen=!$scope.menuOpen,$scope.currentAdvertisement&&$scope.menuOpen&&(AnalyticsModel.logAdvertisement({token:$scope.currentAdvertisement.token,type:"impression"}),$scope.currentAdvertisement=null)},$scope.settingsOpen=!1,$scope.toggleSettings=function(){ActivityMonitor.activityDetected(),$scope.settingsOpen=!$scope.settingsOpen},$scope.elements=ShellManager.model.elements,ShellManager.model.elementsChanged.add(function(value){$timeout(function(){return $scope.elements=value})}),$scope.cartCount=OrderManager.model.orderCart.length,OrderManager.model.orderCartChanged.add(function(cart){$timeout(function(){return $scope.cartCount=cart.length})}),$scope.checkoutEnabled=CustomerManager.model.isEnabled,$scope.totalOrder=OrderManager.model.orderCheck,OrderManager.model.orderCheckChanged.add(function(value){$timeout(function(){return $scope.totalOrder=value})}),$scope.requestAssistance=function(){$scope.requestAssistanceAvailable&&(ActivityMonitor.activityDetected(),$scope.settingsOpen=!1,DialogManager.confirm(ALERT_TABLE_ASSISTANCE).then(function(){var job=DialogManager.startJob();OrderManager.requestAssistance().then(function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_ASSISTANCE_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})}))};var refreshAssistanceRequest=function(){$scope.requestAssistanceAvailable=!Boolean(OrderManager.model.assistanceRequest)};OrderManager.model.assistanceRequestChanged.add(refreshAssistanceRequest),refreshAssistanceRequest(),$scope.submitOrder=function(){ActivityMonitor.activityDetected(),$scope.settingsOpen=!1,CommandSubmitOrder()},$scope.viewOrder=function(){return ActivityMonitor.activityDetected(),$scope.settingsOpen=!1,CustomerManager.model.isEnabled&&!CustomerManager.model.isAuthenticated?void DialogManager.alert(ALERT_SIGNIN_REQUIRED):(CartModel.cartState=CartModel.STATE_CART,void(CartModel.isCartOpen=!0))},$scope.payBill=function(){return ActivityMonitor.activityDetected(),$scope.settingsOpen=!1,CustomerManager.model.isEnabled&&!CustomerManager.model.isAuthenticated?void DialogManager.alert(ALERT_SIGNIN_REQUIRED):(CartModel.cartState=CartModel.STATE_HISTORY,void(CartModel.isCartOpen=!0))},$scope.customerName=CustomerManager.customerName||"Guest",CustomerManager.model.profileChanged.add(function(){$timeout(function(){return $scope.customerName=CustomerManager.customerName||"Guest"})}),$scope.settings={displayBrightness:100,soundVolume:100},$scope.showVolume&&ManagementService.getSoundVolume().then(function(value){return $timeout(function(){$scope.settings.soundVolume=value,$scope.$watch("settings.soundVolume",function(value,old){value&&value!==old&&(value=parseInt(value),ActivityMonitor.activityDetected(),ManagementService.setSoundVolume(value))})})},function(e){}),$scope.showBrightness&&ManagementService.getDisplayBrightness().then(function(value){return $timeout(function(){$scope.settings.displayBrightness=value,$scope.$watch("settings.displayBrightness",function(value,old){value&&value!==old&&(value=parseInt(value),ActivityMonitor.activityDetected(),ManagementService.setDisplayBrightness(value))})})},function(e){}),$scope.navigate=function(destination){return NavigationManager.location=destination},NavigationManager.locationChanging.add(function(location){$scope.visible="signin"!==location.type,$timeout(function(){return $scope.$apply()})}),NavigationManager.locationChanged.add(function(location){$timeout(function(){"category"!==location.type&&"item"!==location.type&&$scope.menus.forEach(function(menu){menu.selected="menu"===location.type&&menu.token===location.token}),$scope.menuOpen=!1,$scope.settingsOpen=!1})})}]),angular.module("SNAP.controllers").controller("HomeBaseCtrl",["$scope","$timeout","DataManager","NavigationManager",function($scope,$timeout,DataManager,NavigationManager){}]),angular.module("SNAP.controllers").controller("HomeCtrl",["$scope","$timeout","ChatManager","DataModel","ShellManager","CustomerManager","OrderManager","DialogManager","NavigationManager","LocationModel","SurveyManager","SNAPLocation","SNAPEnvironment","CommandCloseTable",function($scope,$timeout,ChatManager,DataModel,ShellManager,CustomerManager,OrderManager,DialogManager,NavigationManager,LocationModel,SurveyManager,SNAPLocation,SNAPEnvironment,CommandCloseTable){var HomeMenu=React.createClass({displayName:"HomeMenu",render:function(){var result=[React.DOM.td({key:-1})],rows=this.props.tiles.map(function(tile,i){return React.DOM.td({className:"home-menu-item",key:i},React.DOM.a({onClick:function(e){e.preventDefault(),NavigationManager.location=tile.destination}},React.DOM.img({src:ShellManager.getMediaUrl(tile.image,160,160)})))});return result=result.concat(rows),result.push(React.DOM.td({key:result.length})),React.DOM.table(null,result)}});DataModel.home().then(function(response){if(response){var tiles=[];response.menus.filter(function(menu){return"desktop"===SNAPEnvironment.platform||3!==menu.type}).reduce(function(tiles,menu){if(menu.promos&&menu.promos.length>0)menu.promos.filter(function(promo){return"desktop"===SNAPEnvironment.platform||3!==promo.type}).forEach(function(promo){tiles.push({title:promo.title,image:promo.image,url:"#"+NavigationManager.getPath(promo.destination),destination:promo.destination})});else{var destination={type:"menu",token:menu.token};tiles.push({title:menu.title,image:menu.image,url:"#"+NavigationManager.getPath(destination),destination:destination})}return tiles},tiles),$timeout(function(){React.render(React.createElement(HomeMenu,{tiles:tiles}),document.getElementById("home-menu-main"))},1e3)}}),NavigationManager.locationChanging.add(function(location){$scope.visible="home"===location.type,$timeout(function(){$scope.$apply()})}),$scope.preload=function(destination){NavigationManager.location=destination},$scope.getMediaUrl=function(media,width,height,extension){return ShellManager.getMediaUrl(media,width,height,extension)},$scope.predicateEven=ShellManager.predicateEven,$scope.predicateOdd=ShellManager.predicateOdd,$scope.seat_name=LocationModel.seat?LocationModel.seat.name:"Table",LocationModel.seatChanged.add(function(value){$timeout(function(){$scope.seat_name=value?value.name:"Table"})}),$scope.customer_name=CustomerManager.customerName,CustomerManager.model.profileChanged.add(function(){$timeout(function(){return $scope.customer_name=CustomerManager.customerName})}),$scope.elements=ShellManager.model.elements,ShellManager.model.elementsChanged.add(function(value){$timeout(function(){return $scope.elements=value})});var refreshAssistanceRequest=function(){$scope.requestAssistanceAvailable=!Boolean(OrderManager.model.assistanceRequest)},refreshCloseoutRequest=function(){$scope.requestCloseoutAvailable=!Boolean(OrderManager.model.closeoutRequest)},refreshSurvey=function(){$scope.surveyAvailable=SurveyManager.model.isEnabled&&SurveyManager.model.feedbackSurvey&&!SurveyManager.model.feedbackSurveyComplete};OrderManager.model.assistanceRequestChanged.add(refreshAssistanceRequest),OrderManager.model.closeoutRequestChanged.add(refreshCloseoutRequest),SurveyManager.model.feedbackSurveyChanged.add(refreshSurvey),SurveyManager.model.surveyCompleted.add(refreshSurvey),refreshAssistanceRequest(),refreshCloseoutRequest(),refreshSurvey(),$scope.chatAvailable=Boolean(SNAPLocation.chat),$scope.requestAssistance=function(){$scope.requestAssistanceAvailable&&DialogManager.confirm(ALERT_TABLE_ASSISTANCE).then(function(){var job=DialogManager.startJob();OrderManager.requestAssistance().then(function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_ASSISTANCE_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})})},$scope.requestCloseout=function(){$scope.requestCloseoutAvailable&&DialogManager.confirm(ALERT_TABLE_CLOSEOUT).then(function(){var job=DialogManager.startJob();OrderManager.requestCloseout().then(function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_CLOSEOUT_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})})},$scope.openSurvey=function(){$scope.surveyAvailable&&(NavigationManager.location={type:"survey"})},$scope.seatClicked=function(){DialogManager.confirm(ALERT_TABLE_RESET).then(function(){var job=DialogManager.startJob();CommandCloseTable().then(function(){return DialogManager.endJob(job)})})},$scope.customerClicked=function(){CustomerManager.model.isEnabled&&(CustomerManager.model.isAuthenticated&&!CustomerManager.model.isGuest?NavigationManager.location={type:"account"}:DialogManager.alert(ALERT_SIGNIN_REQUIRED))},$scope.openChat=function(){NavigationManager.location={type:"chat"}}}]),angular.module("SNAP.controllers").controller("ItemBaseCtrl",["$scope",function($scope){}]),angular.module("SNAP.controllers").controller("ItemCtrl",["$scope","$timeout","AnalyticsModel","CustomerModel","DataManager","DialogManager","NavigationManager","OrderManager","CartModel","LocationModel","ShellManager","SNAPEnvironment","ChatManager",function($scope,$timeout,AnalyticsModel,CustomerModel,DataManager,DialogManager,NavigationManager,OrderManager,CartModel,LocationModel,ShellManager,SNAPEnvironment,ChatManager){var ItemImage=React.createClass({displayName:"ItemImage",render:function(){return React.DOM.img({src:ShellManager.getMediaUrl(this.props.media,600,600)})}});NavigationManager.locationChanging.add(function(location){DataManager.item="item"===location.type?location.token:void 0,$scope.visible=Boolean(DataManager.item),$timeout(function(){$scope.$apply()})}),DataManager.itemChanged.add(function(response){if(response||!$scope.websiteUrl&&!$scope.flashUrl||WebBrowser.close(),$scope.websiteUrl=null,$scope.flashUrl=null,!response)return $scope.entry=null,1===$scope.type&&(document.getElementById("item-photo").innerHTML=""),$scope.type=1,void $timeout(function(){return $scope.$apply()});var type=response.type;if(2===type&&response.website)$scope.websiteUrl=response.website.url,WebBrowser.open($scope.websiteUrl);else if(3===type&&response.flash){var url=WebBrowser.getFlashUrl(response.flash.media.token,response.flash.width,response.flash.height);$scope.flashUrl=url,WebBrowser.open($scope.flashUrl)}else 1===type&&($scope.entry=new app.CartItem(response,1),React.render(React.createElement(ItemImage,{media:$scope.entry.item.image}),document.getElementById("item-photo")));$scope.type=type,$timeout(function(){$scope.$apply()})}),$scope.getMediaUrl=function(media,width,height,extension){return ShellManager.getMediaUrl(media,width,height,extension)},$scope.formatPrice=function(value){return value?ShellManager.formatPrice(value):0},$scope.addToCart=function(){if(CustomerModel.isEnabled&&!CustomerModel.isAuthenticated)return void DialogManager.alert(ALERT_SIGNIN_REQUIRED);var entry=$scope.entry;entry.hasModifiers?CartModel.openEditor(entry,!0):(OrderManager.addToCart(entry),CartModel.isCartOpen=!0),NavigationManager.goBack()},$scope.cancelGift=function(){return ChatManager.cancelGift()},$scope.giftSeat=LocationModel.getSeat(ChatManager.model.giftSeat),ChatManager.model.giftSeatChanged.add(function(token){$timeout(function(){return $scope.giftSeat=LocationModel.getSeat(token)})})}]),angular.module("SNAP.controllers").controller("ItemEditCtrl",["$scope","ShellManager","NavigationManager","OrderManager","CartModel",function($scope,ShellManager,NavigationManager,OrderManager,CartModel){$scope.getMediaUrl=function(media,width,height,extension){return ShellManager.getMediaUrl(media,width,height,extension)},$scope.formatPrice=function(value){return ShellManager.formatPrice(value)};var currentIndex=-1,refreshNavigation=function(){$scope.entry&&$scope.entry.hasModifiers&&($scope.hasNextCategory=$scope.entry.modifiers.length>1&&currentIndex<$scope.entry.modifiers.length-1,$scope.hasPreviousCategory=currentIndex>0,$scope.category=$scope.entry.modifiers[currentIndex],$scope.canExit=CartModel.editableItemNew,$scope.canDone=!0)};NavigationManager.locationChanging.add(function(location){"menu"!==location.type&&"category"!==location.type&&$scope.exit()}),CartModel.isCartOpenChanged.add(function(value){value&&$scope.exit()});var init=function(value){$scope.entry=value,$scope.visible=null!==$scope.entry,currentIndex=0,refreshNavigation()};init(CartModel.editableItem),CartModel.editableItemChanged.add(function(value){init(value)}),$scope.getModifierTitle=function(modifier){return modifier.data.title+(modifier.data.price>0?" (+"+ShellManager.formatPrice(modifier.data.price)+")":"")},$scope.leftButtonClick=function(){currentIndex>0?$scope.previousCategory():$scope.exit()},$scope.leftButtonText=function(){return currentIndex>0?"Back":"Exit"},$scope.rightButtonClick=function(){if(1===$scope.entry.modifiers[currentIndex].data.selection){var numSelected=0;if(angular.forEach($scope.entry.modifiers[currentIndex].modifiers,function(m){m.isSelected&&numSelected++}),1!==numSelected)return}$scope.hasNextCategory?$scope.nextCategory():$scope.done()},$scope.rightButtonText=function(){return $scope.hasNextCategory?"Next":"Done"},$scope.previousCategory=function(){currentIndex--,refreshNavigation()},$scope.nextCategory=function(){currentIndex++,refreshNavigation()},$scope.updateModifiers=function(category,modifier){modifier.isSelected=!modifier.isSelected,modifier.isSelected&&1===category.data.selection&&angular.forEach(category.modifiers,function(m){m.isSelected=m===modifier})},$scope.done=function(){CartModel.editableItemNew&&OrderManager.addToCart(CartModel.editableItem),$scope.exit(),CartModel.isCartOpen=!0},$scope.exit=function(){CartModel.closeEditor()}}]),angular.module("SNAP.controllers").controller("MainAuxCtrl",["$scope","CommandStartup",function($scope,CommandStartup){CommandStartup()}]),angular.module("SNAP.controllers").controller("MainSnapCtrl",["$scope","$timeout","CustomerManager","ActivityMonitor","ChatManager","ShellManager","DataManager","DialogManager","OrderManager","LocationModel","NavigationManager","SoftwareManager","SNAPLocation","CommandStartup",function($scope,$timeout,CustomerManager,ActivityMonitor,ChatManager,ShellManager,DataManager,DialogManager,OrderManager,LocationModel,NavigationManager,SoftwareManager,SNAPLocation,CommandStartup){CommandStartup(),$scope.touch=function(){return ActivityMonitor.activityDetected()},OrderManager.model.orderRequestChanged.add(function(item){item&&item.promise.then(function(){return DialogManager.alert(ALERT_REQUEST_ORDER_RECEIVED)})}),OrderManager.model.assistanceRequestChanged.add(function(item){item&&item.promise.then(function(){return DialogManager.alert(ALERT_REQUEST_ASSISTANCE_RECEIVED)})}),OrderManager.model.closeoutRequestChanged.add(function(item){item&&item.promise.then(function(){return DialogManager.alert(ALERT_REQUEST_CLOSEOUT_RECEIVED)})}),ChatManager.model.chatRequestReceived.add(function(token){DialogManager.confirm(ChatManager.getDeviceName(token)+" would like to chat with you.").then(function(){ChatManager.approveDevice(token),NavigationManager.location={type:"chat"}},function(){return ChatManager.declineDevice(token)})}),ChatManager.model.giftRequestReceived.add(function(token,description){DialogManager.confirm(ChatManager.getDeviceName(token)+" would like to gift you a "+description).then(function(){ChatManager.acceptGift(token)},function(){return ChatManager.declineGift(token)})}),ChatManager.model.messageReceived.add(function(message){var device=LocationModel.getDevice(message.device);device&&(message.status===ChatManager.MESSAGE_STATUSES.CHAT_REQUEST_DECLINED?DialogManager.alert("Chat with "+ChatManager.getDeviceName(device.token)+' was declined. To stop recieving chat requests, open the chat screen and touch the "Chat on/off" button.'):message.status===ChatManager.MESSAGE_STATUSES.CHAT_REQUEST_ACCEPTED?DialogManager.alert("Your chat request to "+ChatManager.getDeviceName(device.token)+" was accepted."):message.status===ChatManager.MESSAGE_STATUSES.GIFT_REQUEST_ACCEPTED?DialogManager.alert(ChatManager.getDeviceName(device.token)+" has accepted your gift. The item will be added to your check."):message.status===ChatManager.MESSAGE_STATUSES.GIFT_REQUEST_DECLINED&&DialogManager.alert(ChatManager.getDeviceName(device.token)+" has declined your gift. The item will NOT be added to your check."),"chat"!==NavigationManager.location.type&&(message.status===ChatManager.MESSAGE_STATUSES.CHAT_CLOSED?DialogManager.notification(ChatManager.getDeviceName(device.token)+" has closed the chat"):!message.status&&message.to_device&&DialogManager.notification("New message from "+ChatManager.getDeviceName(device.token))))}),ChatManager.model.giftReady.add(function(){ChatManager.sendGift(OrderManager.model.orderCart),NavigationManager.location={type:"chat"}}),ChatManager.model.giftAccepted.add(function(status){if(status&&ChatManager.model.giftDevice){var job=DialogManager.startJob();OrderManager.submitCart().then(function(){DialogManager.endJob(job),NavigationManager.location={type:"chat"}},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR),ChatManager.endGift(),NavigationManager.location={type:"chat"}})}else ChatManager.model.giftSeat=null})}]),angular.module("SNAP.controllers").controller("MenuBaseCtrl",["$scope","$timeout","DataManager","NavigationManager",function($scope,$timeout,DataManager,NavigationManager){}]),angular.module("SNAP.controllers").controller("MenuCtrl",["$scope","$timeout","DataManager","NavigationManager","ShellManager",function($scope,$timeout,DataManager,NavigationManager,ShellManager){var MenuList=React.createClass({displayName:"MenuList",render:function(){var tileClassName=ShellManager.tileStyle,rows=this.props.tiles.map(function(tile,i){return React.DOM.td({className:tileClassName,key:i},React.DOM.a({onClick:function(e){e.preventDefault(),NavigationManager.location=tile.destination},style:{backgroundImage:"url("+ShellManager.getMediaUrl(tile.image,370,370)+")"}},React.DOM.span(null,tile.title)))}).reduce(function(result,value,i){return result[i%2].push(value),result},[[],[]]).map(function(row,i){return React.DOM.tr({key:i},row)});return React.DOM.table({className:"tile-table"},rows)}});NavigationManager.locationChanging.add(function(location){DataManager.menu="menu"===location.type?location.token:void 0,$scope.visible=Boolean(DataManager.menu),$timeout(function(){$scope.$apply()})}),DataManager.menuChanged.add(function(menu){menu&&(menu.categories.forEach(function(tile){tile.url="#"+NavigationManager.getPath(tile.destination)}),React.render(React.createElement(MenuList,{tiles:menu.categories}),document.getElementById("content-menu")))})}]),angular.module("SNAP.controllers").controller("NavigationCtrl",["$scope","$timeout","ActivityMonitor","CustomerManager","AnalyticsModel","CartModel","ShellManager","DataManager","DataModel","DialogManager","NavigationManager","OrderManager","CommandCloseTable","CommandFlipScreen","WebBrowser","SNAPEnvironment",function($scope,$timeout,ActivityMonitor,CustomerManager,AnalyticsModel,CartModel,ShellManager,DataManager,DataModel,DialogManager,NavigationManager,OrderManager,CommandCloseTable,CommandFlipScreen,WebBrowser,SNAPEnvironment){$scope.menus=[],DataModel.home().then(function(response){if(response){var location=NavigationManager.location,limit="desktop"===SNAPEnvironment.platform?4:3;$scope.menus=response.menus.filter(function(menu){return"desktop"===SNAPEnvironment.platform||3!==menu.type}).filter(function(menu,i){return limit>i}).map(function(menu){var destination={type:"menu",token:menu.token};return{token:menu.token,title:menu.title,url:"#"+NavigationManager.getPath(destination),destination:destination,selected:"menu"===location.type&&menu.token===location.token}})}}),$scope.navigateHome=function(){return ActivityMonitor.activityDetected(),CustomerManager.model.isEnabled&&!CustomerManager.model.isAuthenticated?void DialogManager.confirm(ALERT_TABLE_RESET).then(function(){var job=DialogManager.startJob();CommandCloseTable().then(function(){return DialogManager.endJob(job)})}):(NavigationManager.location={type:"home"},void(CartModel.isCartOpen=!1))},$scope.navigateBack=function(){return ActivityMonitor.activityDetected(),CustomerManager.model.isEnabled&&!CustomerManager.model.isAuthenticated?void DialogManager.alert(ALERT_SIGNIN_REQUIRED):(NavigationManager.goBack(),void(CartModel.isCartOpen=!1))},$scope.rotateScreen=function(){ActivityMonitor.activityDetected(),CommandFlipScreen()},$scope.openCart=function(){return ActivityMonitor.activityDetected(),CustomerManager.model.isEnabled&&!CustomerManager.model.isAuthenticated?void DialogManager.alert(ALERT_SIGNIN_REQUIRED):void(CartModel.isCartOpen=!CartModel.isCartOpen)},$scope.openSettings=function(){DialogManager.confirm(ALERT_TABLE_RESET).then(function(){var job=DialogManager.startJob();CommandCloseTable().then(function(){return DialogManager.endJob(job)})})},$scope.menuOpen=!1,$scope.toggleMenu=function(){$scope.menuOpen=!$scope.menuOpen},$scope.advertisementClick=function(item){return CustomerManager.model.isEnabled&&!CustomerManager.model.isAuthenticated?void DialogManager.alert(ALERT_SIGNIN_REQUIRED):(AnalyticsModel.logAdvertisement({token:item.token,type:"click"}),void(item.href&&WebBrowser.open(item.href.url)))},$scope.advertisementImpression=function(item){ActivityMonitor.active&&!$scope.wide&&AnalyticsModel.logAdvertisement({token:item.token,type:"impression"})},$scope.elements=ShellManager.model.elements,ShellManager.model.elementsChanged.add(function(value){$timeout(function(){return $scope.elements=value})}),$scope.advertisementsAll=[],$scope.advertisementsTop=[],$scope.advertisementsBottom=[];var mapAdvertisement=function(ad){return{src:ShellManager.getMediaUrl(ad.src,970,90),href:ad.href,type:ShellManager.getMediaType(ad.src),token:ad.token}};DataModel.advertisements().then(function(response){$timeout(function(){$scope.advertisementsTop=response.top.map(mapAdvertisement),$scope.advertisementsBottom=response.bottom.map(mapAdvertisement),
$scope.advertisementsAll=$scope.advertisementsTop.concat($scope.advertisementsBottom)})}),$scope.cartCount=OrderManager.model.orderCart.length,OrderManager.model.orderCartChanged.add(function(cart){$timeout(function(){return $scope.cartCount=cart.length})}),$scope.requestAssistance=function(){$scope.requestAssistanceAvailable&&DialogManager.confirm(ALERT_TABLE_ASSISTANCE).then(function(){var job=DialogManager.startJob();OrderManager.requestAssistance().then(function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_ASSISTANCE_SENT)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})})};var refreshAssistanceRequest=function(){$scope.requestAssistanceAvailable=!Boolean(OrderManager.model.assistanceRequest)};OrderManager.model.assistanceRequestChanged.add(refreshAssistanceRequest),refreshAssistanceRequest(),$scope.customerName=CustomerManager.customerName,CustomerManager.model.profileChanged.add(function(){$timeout(function(){return $scope.customerName=CustomerManager.customerName})}),$scope.navigate=function(destination){return NavigationManager.location=destination},NavigationManager.locationChanged.add(function(location){$timeout(function(){$scope.menus.forEach(function(menu){})})})}]),angular.module("SNAP.controllers").controller("NotificationCtrl",["$scope","$timeout","DialogManager",function($scope,$timeout,DialogManager){function updateVisibility(isVisible){$timeout(function(){$scope.visible=isVisible})}function hideNext(){for(var messages=[],i=1;i<$scope.messages.length;i++)messages.push($scope.messages[i]);return $scope.messages=messages,0===$scope.messages.length?void updateVisibility(!1):void(timer=$timeout(hideNext,4e3))}var timer;$scope.messages=[],$scope.visible=!1,DialogManager.notificationRequested.add(function(message){$timeout(function(){$scope.messages.push({text:message})}),updateVisibility(!0),timer&&$timeout.cancel(timer),timer=$timeout(hideNext,4e3)})}]),angular.module("SNAP.controllers").controller("ResetCtrl",["$scope","CommandReset","DialogManager","ManagementService","SNAPEnvironment",function($scope,CommandReset,DialogManager,ManagementService,SNAPEnvironment){$scope.version=SNAPEnvironment.version,CommandReset().then(function(){ManagementService.loadStartup()},function(){ManagementService.loadStartup()})}]),angular.module("SNAP.controllers").controller("ScreensaverCtrl",["$scope","$timeout","ShellManager","ActivityMonitor","DataModel",function($scope,$timeout,ShellManager,ActivityMonitor,DataModel){function showImages(values){$timeout(function(){$scope.images=values.map(function(item){return{src:ShellManager.getMediaUrl(item.media,1920,1080,"jpg"),type:ShellManager.getMediaType(item.media)}})})}$scope.visible=!1,showImages(ShellManager.model.screensavers),ShellManager.model.screensaversChanged.add(showImages),ActivityMonitor.activeChanged.add(function(value){$timeout(function(){$scope.visible=value===!1&&$scope.images&&$scope.images.length>0})})}]),angular.module("SNAP.controllers").controller("SignInCtrl",["$scope","$timeout","CommandCustomerLogin","CommandCustomerGuestLogin","CommandCustomerSocialLogin","CommandCustomerSignup","CustomerManager","DialogManager","NavigationManager","SessionManager","SNAPLocation",function($scope,$timeout,CommandCustomerLogin,CommandCustomerGuestLogin,CommandCustomerSocialLogin,CommandCustomerSignup,CustomerManager,DialogManager,NavigationManager,SessionManager,SNAPLocation){function socialLogin(){socialBusyEnd(),$timeout(function(){return $scope.step=STEP_GUESTS})}function socialError(){socialBusyEnd(),DialogManager.alert(ALERT_GENERIC_ERROR)}function socialBusy(){socialBusyEnd(),socialJob=DialogManager.startJob(),socialTimer=$timeout(socialBusyEnd,12e4)}function socialBusyEnd(){socialJob&&(DialogManager.endJob(socialJob),socialJob=null),socialTimer&&($timeout.cancel(socialTimer),socialTimer=null)}function endSignIn(){NavigationManager.location={type:"home"}}var STEP_SPLASH=1,STEP_LOGIN=2,STEP_REGISTRATION=3,STEP_GUESTS=4,STEP_EVENT=5,STEP_RESET=6;$scope.STEP_SPLASH=STEP_SPLASH,$scope.STEP_LOGIN=STEP_LOGIN,$scope.STEP_REGISTRATION=STEP_REGISTRATION,$scope.STEP_GUESTS=STEP_GUESTS,$scope.STEP_EVENT=STEP_EVENT,$scope.STEP_RESET=STEP_RESET,$scope.locationName=SNAPLocation.location_name,$scope.login=function(){$scope.credentials={},$scope.step=STEP_LOGIN},$scope.guestLogin=function(){var job=DialogManager.startJob();CommandCustomerGuestLogin().then(function(){DialogManager.endJob(job),$timeout(function(){return $scope.step=STEP_GUESTS})},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})},$scope.doLogin=function(credentials){var job=DialogManager.startJob();$scope.credentials.username=$scope.credentials.email,CommandCustomerLogin($scope.credentials).then(function(){DialogManager.endJob(job),$timeout(function(){return $scope.step=STEP_GUESTS})},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_GENERIC_ERROR)})},$scope.loginFacebook=function(){socialBusy(),CommandCustomerSocialLogin.facebook().then(socialLogin,socialError)},$scope.loginTwitter=function(){socialBusy(),CommandCustomerSocialLogin.twitter().then(socialLogin,socialError)},$scope.loginGoogle=function(){socialBusy(),CommandCustomerSocialLogin.googleplus().then(socialLogin,socialError)},$scope.register=function(){$scope.registration={},$scope.step=STEP_REGISTRATION},$scope.doRegistration=function(){$scope.registration.username=$scope.registration.email;var job=DialogManager.startJob();CommandCustomerSignup($scope.registration).then(function(){DialogManager.endJob(job),$timeout(function(){return $scope.step=STEP_GUESTS})},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})},$scope.session={guestCount:1,special:!1},$scope.submitGuestCount=function(){$scope.session.guestCount>1?(SessionManager.guestCount=$scope.session.guestCount,$scope.step=STEP_EVENT):endSignIn()},$scope.submitSpecialEvent=function(value){$scope.session.special=SessionManager.specialEvent=Boolean(value),endSignIn()},$scope.resetPassword=function(){$scope.passwordreset={},$scope.step=STEP_RESET},$scope.passwordResetSubmit=function(){var job=DialogManager.startJob();CustomerManager.resetPassword($scope.passwordreset).then(function(){DialogManager.endJob(job),$scope.passwordReset=!1,DialogManager.alert(ALERT_PASSWORD_RESET_COMPLETE)},function(){DialogManager.endJob(job),DialogManager.alert(ALERT_REQUEST_SUBMIT_ERROR)})},$scope.passwordResetCancel=function(){$scope.step=STEP_SPLASH};var socialJob,socialTimer;return $scope.$watchAsProperty("step").skipDuplicates().subscribe(function(value){if(value.value){var step=value.value();step===$scope.STEP_GUESTS&&$scope.submitGuestCount()}}),!CustomerManager.model.isEnabled||CustomerManager.model.isAuthenticated?endSignIn():($scope.initialized=!0,void($scope.step=STEP_SPLASH))}]),angular.module("SNAP.controllers").controller("StartupCtrl",["$scope","$timeout","CommandBoot","DialogManager","LocationModel","ManagementService","SNAPEnvironment",function($scope,$timeout,CommandBoot,DialogManager,LocationModel,ManagementService,SNAPEnvironment){function workflow(){CommandBoot().then(function(){ManagementService.loadApplication(LocationModel.location)},function(e){DialogManager.alert(ALERT_ERROR_STARTUP).then(function(){return workflow()})})}$scope.version=SNAPEnvironment.version,$timeout(function(){return workflow()},1e3)}]),angular.module("SNAP.controllers").controller("SurveyCtrl",["$scope","$timeout","AnalyticsModel","CustomerManager","CustomerModel","DialogManager","NavigationManager","OrderManager","SurveyManager",function($scope,$timeout,AnalyticsModel,CustomerManager,CustomerModel,DialogManager,NavigationManager,OrderManager,SurveyManager){if(!SurveyManager.model.isEnabled||!SurveyManager.model.feedbackSurvey||SurveyManager.model.feedbackSurveyComplete)return void(NavigationManager.location={type:"home"});$scope.comment="",$scope.email="",$scope.had_problems=!1,$scope.pages=[];var pages=$scope.$watchAsProperty("pages");$scope.pageIndex=-1;var pageIndex=$scope.$watchAsProperty("pageIndex");pageIndex.changes().subscribe(function(){$scope.page=$scope.pageIndex>-1?$scope.pages[$scope.pageIndex]:{questions:[]},$timeout(function(){$scope.page.forEach(function(item){1===item.type&&$("#rate-"+item.token).rateit({min:0,max:5,step:1,resetable:!1,backingfld:"#range-"+item.token}).bind("rated",function(event,value){item.feedback=value})})})}),$scope.pageCount=0,pages.changes().subscribe(function(){$scope.pageCount=$scope.pages.length});var generatePassword=function(){for(var length=8,charset="abcdefghknpqrstuvwxyzABCDEFGHKMNPQRSTUVWXYZ23456789",result="",i=0,n=charset.length;length>i;i++)result+=charset.charAt(Math.floor(Math.random()*n));return result},submitFeedback=function(){if($scope.pages.reduce(function(answers,page){return page.reduce(function(answers,question){var value=parseInt(question.feedback);return value>0&&answers.push({survey:SurveyManager.model.feedbackSurvey.token,question:question.token,value:value}),answers},answers)},[]).forEach(function(answer){return AnalyticsModel.logAnswer(answer)}),$scope.comment&&$scope.comment.length>0&&AnalyticsModel.logComment({type:"feedback",text:$scope.comment}),SurveyManager.model.feedbackSurveyComplete=!0,$scope.had_problems&&!OrderManager.model.assistanceRequest&&OrderManager.requestAssistance(),CustomerModel.isGuest&&$scope.email&&$scope.email.length>0){var job=DialogManager.startJob(),password=generatePassword();CustomerManager.login({email:$scope.email,password:password}).then(function(){CustomerManager.login({login:$scope.email,password:password}).then(function(){DialogManager.endJob(job),NavigationManager.location={type:"home"}},function(){DialogManager.endJob(job),NavigationManager.location={type:"home"}})},function(){DialogManager.endJob(job),NavigationManager.location={type:"home"}})}else NavigationManager.location={type:"home"}};$scope.previousPage=function(){$scope.pageIndex>0&&$scope.pageIndex--},$scope.nextPage=function(){$scope.pageIndex<$scope.pageCount-1?$scope.pageIndex++:$scope.nextStep()},$scope.nextStep=function(){CustomerModel.isGuest&&$scope.step<3?$scope.step++:!CustomerModel.isGuest&&$scope.step<2?$scope.step++:submitFeedback()},$scope.submitProblem=function(status){$scope.had_problems=Boolean(status),$scope.nextStep()},$scope.exit=function(){$scope.step>0&&submitFeedback(),NavigationManager.location={type:"home"}},function(){function buildSurvey(){SurveyManager.model.feedbackSurvey.questions.forEach(function(item){1===item.type&&((!page||page.length>4)&&(page=[],$scope.pages.push(page)),item.feedback=0,page.push(item))})}var page;$scope.has_email=CustomerModel.hasCredentials,SurveyManager.model.isEnabled&&SurveyManager.model.feedbackSurvey&&buildSurvey(),SurveyManager.model.feedbackSurveyChanged.add(function(){return buildSurvey()}),$scope.pageIndex=0,$scope.step=0}()}]),angular.module("SNAP.controllers").controller("WebCtrl",["$scope","$timeout","ActivityMonitor","NavigationManager","WebBrowser",function($scope,$timeout,ActivityMonitor,NavigationManager,WebBrowser){$scope.close=function(){return WebBrowser.close()},$scope.url="",WebBrowser.onOpened.add(function(reference){switch(ActivityMonitor.enabled=!1,$timeout(function(){$scope.browserUrl=WebBrowser.isPrivateUrl(reference.url)?"":reference.url,$scope.type=reference.type,$scope.visible=!0}),reference.type){case"iframe":reference.attach(document.getElementById("page-web-iframe"));break;case"webview":reference.attach(document.getElementById("page-web-webview"))}reference.onNavigated.add(function(url){return $timeout(function(){return $scope.browserUrl=WebBrowser.isPrivateUrl(url)?"":url})})}),WebBrowser.onClosed.add(function(){ActivityMonitor.enabled=!0,$timeout(function(){$scope.url="",$scope.visible=!1})}),NavigationManager.locationChanging.add(function(location){WebBrowser.close(),$timeout(function(){$scope.wide="home"!==location.type&&"signin"!==location.type,$scope.fullscreen="signin"===location.type})})}]),angular.module("SNAP.directives",["angular-bacon"]),angular.module("SNAP.directives").directive("email",["$timeout","ShellManager",function($timeout,ShellManager){return{restrict:"E",replace:!0,transclude:!0,scope:{disabled:"=?",ngModel:"=",placeholder:"@"},templateUrl:ShellManager.getPartialUrl("input-email")}}]),angular.module("SNAP.directives").directive("gallery",["ActivityMonitor","ShellManager","$timeout",function(ActivityMonitor,ShellManager,$timeout){var slider,settings={mode:"fade",wrapperClass:"photo-gallery"};return{restrict:"E",replace:!1,scope:{images:"=",imagewidth:"=?",imageheight:"=?"},templateUrl:ShellManager.getPartialUrl("gallery"),link:function(scope,elem,attrs){elem.ready(function(){slider=$(".bxslider",elem).bxSlider(settings)}),scope.$watch("images",function(){scope.medias=(scope.images||[]).map(function(image){return ShellManager.getMediaUrl(image,attrs.imagewidth,attrs.imageheight)}),settings.pager=scope.medias.length>1,$timeout(function(){return slider.reloadSlider(settings)})})}}}]),angular.module("SNAP.directives").directive("onIframeLoad",function(){return{restrict:"A",scope:{callback:"&onIframeLoad"},link:function(scope,element,attrs){element.bind("load",function(e){"function"==typeof scope.callback&&scope.callback({event:e})})}}}),angular.module("SNAP.directives").directive("onKeydown",function(){return{restrict:"A",link:function(scope,elem,attrs){var functionToCall=scope.$eval(attrs.onKeydown);elem.on("keydown",function(e){functionToCall(e.which)})}}}),angular.module("SNAP.directives").directive("quantity",["$timeout","ShellManager",function($timeout,ShellManager){return{restrict:"E",replace:!0,scope:{quantity:"=",min:"=",max:"="},link:function(scope,elem){scope.min=scope.min||1,scope.max=scope.max||9,scope.data={min:scope.min,max:scope.max,quantity:parseInt(scope.quantity)},scope.decrease=function(){scope.quantity=scope.data.quantity=scope.data.quantity>scope.data.min?scope.data.quantity-1:scope.data.min},scope.increase=function(){scope.quantity=scope.data.quantity=scope.data.quantity<scope.data.max?scope.data.quantity+1:scope.data.max}},templateUrl:ShellManager.getPartialUrl("input-quantity")}}]),angular.module("SNAP.directives").directive("scroller",["ActivityMonitor","SNAPEnvironment",function(ActivityMonitor,SNAPEnvironment){return{restrict:"C",replace:!1,link:function(scope,elem){"desktop"===SNAPEnvironment.platform&&$(elem).kinetic({y:!1,stopped:function(){ActivityMonitor.activityDetected()}})}}}]),angular.module("SNAP.directives").directive("scrollglue",["$parse",function($parse){function unboundState(initValue){var activated=initValue;return{getValue:function(){return activated},setValue:function(value){activated=value}}}function oneWayBindingState(getter,scope){return{getValue:function(){return getter(scope)},setValue:function(){}}}function twoWayBindingState(getter,setter,scope){return{getValue:function(){return getter(scope)},setValue:function(value){value!==getter(scope)&&scope.$apply(function(){setter(scope,value)})}}}function createActivationState(attr,scope){if(""!==attr){var getter=$parse(attr);return void 0!==getter.assign?twoWayBindingState(getter,getter.assign,scope):oneWayBindingState(getter,scope)}return unboundState(!0)}return{priority:1,restrict:"A",link:function(scope,$el,attrs){function scrollToBottom(){el.scrollTop=el.scrollHeight}function onScopeChanges(){activationState.getValue()&&!shouldActivateAutoScroll()&&scrollToBottom()}function shouldActivateAutoScroll(){return el.scrollTop+el.clientHeight+1>=el.scrollHeight}function onScroll(){activationState.setValue(shouldActivateAutoScroll())}var el=$el[0],activationState=createActivationState(attrs.scrollglue,scope);scope.$watch(onScopeChanges),$el.bind("scroll",onScroll)}}}]),angular.module("SNAP.directives").directive("slider",["$timeout","ShellManager",function($timeout,ShellManager){return{restrict:"AE",replace:!0,scope:{source:"=",slideclick:"=",slideshow:"=",timeout:"="},link:function(scope,elem){var timeout=scope.timeout||5e3;scope.source=scope.source||[],scope.currentIndex=-1;var changeImage=function(){if(0!==scope.source.length&&!scope.disabled){$timeout.cancel(timer),scope.source.forEach(function(entry,i){entry.visible=!1});var entry=scope.source[scope.currentIndex];if(entry.visible=!0,scope.slideshow&&scope.slideshow(entry),"video"===entry.type){var v=$("video",elem);v.attr("src",entry.src);var video=v.get(0);if(!video)return void(timer=$timeout(sliderFunc,300));var onVideoEnded=function onVideoEnded(){video.removeEventListener("ended",onVideoEnded,!1),$timeout(function(){scope.next()})},onVideoError=function onVideoError(error){video.removeEventListener("error",onVideoError,!1),$timeout(function(){scope.next()})};video.addEventListener("ended",onVideoEnded,!1),video.addEventListener("error",onVideoError,!1);try{video.load(),video.play()}catch(e){console.error("Unable to play video: "+e)}}else timer=$timeout(sliderFunc,timeout)}};scope.next=function(){scope.currentIndex<scope.source.length-1?scope.currentIndex++:scope.currentIndex=0,changeImage()},scope.prev=function(){scope.currentIndex>0?scope.currentIndex--:scope.currentIndex=scope.source.length-1,changeImage()};var timer,sliderFunc=function(){0===scope.source.length||scope.disabled||scope.next()};scope.$watch("source",function(){scope.currentIndex=-1,sliderFunc()}),scope.$watch("disabled",function(){scope.currentIndex=-1,sliderFunc()}),sliderFunc(),scope.$on("$destroy",function(){$timeout.cancel(timer)})},templateUrl:ShellManager.getPartialUrl("slider")}}]),angular.module("SNAP.directives").directive("switch",["$timeout","ShellManager",function($timeout,ShellManager){return{restrict:"E",replace:!0,scope:{disabled:"=?",selected:"=?"},link:function(scope,elem){scope.disabled=Boolean(scope.disabled),scope.selected=Boolean(scope.selected),scope.data={disabled:Boolean(scope.disabled),selected:Boolean(scope.selected),changed:!1},scope.toggle=function(){scope.disabled||(scope.selected=scope.data.selected=!scope.data.selected,scope.data.changed=!0)}},templateUrl:ShellManager.getPartialUrl("input-switch")}}]),angular.module("SNAP.filters",[]),angular.module("SNAP.filters").filter("partial",["ShellManager",function(ShellManager){return function(name){return ShellManager.getPartialUrl(name)}}]),angular.module("SNAP.filters").filter("thumbnail",["ShellManager",function(ShellManager){return function(media,width,height,extension){return ShellManager.getMediaUrl(media,width,height,extension)}}]),angular.module("SNAP.filters").filter("trustUrl",["$sce",function($sce){return function(val){return $sce.trustAsResourceUrl(val)}}]),angular.module("SNAP.services",["ngResource","SNAP.configs"]).factory("FlashStarter",["Logger","SNAPHosts",function(Logger,SNAPHosts){return new app.FlashStarter(Logger,SNAPHosts)}]).factory("Logger",["SNAPEnvironment",function(SNAPEnvironment){return new app.Logger(SNAPEnvironment)}]).factory("$exceptionHandler",["Logger",function(Logger){return function(exception,cause){throw Logger.fatal(exception.stack,cause,exception),exception}}]).factory("CardReader",["ManagementService","SNAPEnvironment",function(ManagementService,SNAPEnvironment){var reader;switch(SNAPEnvironment.platform){case"mobile":reader=new app.CordovaCardReader;break;default:reader=new app.CardReader(ManagementService)}return window.SnapCardReader=reader,reader}]).factory("DtsApi",["SNAPHosts","SessionModel",function(SNAPHosts,SessionModel){return new app.BackendApi(SNAPHosts,SessionModel)}]).factory("ManagementService",["SNAPEnvironment",function(SNAPEnvironment){switch(SNAPEnvironment.platform){case"desktop":return new app.GenericManagementService;case"mobile":return new app.CordovaManagementService;default:return new app.GenericManagementService}}]).factory("SocketClient",["SessionModel","SNAPHosts","Logger",function(SessionModel,SNAPHosts,Logger){return new app.SocketClient(SessionModel,SNAPHosts,Logger)}]).factory("TelemetryService",["$resource",function($resource){return new app.TelemetryService($resource)}]).factory("WebBrowser",["AnalyticsModel","ManagementService","SNAPEnvironment","SNAPHosts",function(AnalyticsModel,ManagementService,SNAPEnvironment,SNAPHosts){return window.SnapWebBrowser=new app.WebBrowser(AnalyticsModel,ManagementService,SNAPEnvironment,SNAPHosts),window.SnapWebBrowser}]).factory("AnalyticsModel",["StorageProvider","HeatMap","Logger",function(StorageProvider,HeatMap,Logger){return new app.AnalyticsModel(StorageProvider,HeatMap,Logger)}]).factory("CartModel",function(){return new app.CartModel}).factory("ChatModel",["SNAPLocation","SNAPEnvironment","StorageProvider",function(SNAPLocation,SNAPEnvironment,StorageProvider){return new app.ChatModel(SNAPLocation,SNAPEnvironment,StorageProvider)}]).factory("CustomerModel",["SNAPLocation","StorageProvider",function(SNAPLocation,StorageProvider){return new app.CustomerModel(SNAPLocation,StorageProvider)}]).factory("DataModel",["SNAPLocation","DtsApi","StorageProvider",function(SNAPLocation,DtsApi,StorageProvider){return new app.DataModel(SNAPLocation,DtsApi,StorageProvider)}]).factory("HeatMap",function(){return new app.HeatMap(document.body)}).factory("LocationModel",["DtsApi","SNAPEnvironment","SNAPLocation","StorageProvider",function(DtsApi,SNAPEnvironment,SNAPLocation,StorageProvider){return new app.LocationModel(DtsApi,SNAPEnvironment,SNAPLocation,StorageProvider)}]).factory("OrderModel",["StorageProvider",function(StorageProvider){return new app.OrderModel(StorageProvider)}]).factory("ShellModel",function(){return new app.ShellModel}).factory("SurveyModel",["SNAPLocation","StorageProvider",function(SNAPLocation,StorageProvider){return new app.SurveyModel(SNAPLocation,StorageProvider)}]).factory("SessionModel",["StorageProvider",function(StorageProvider){return new app.SessionModel(StorageProvider)}]).factory("StorageProvider",["Logger","SNAPEnvironment",function(Logger,SNAPEnvironment){return function(id){switch(SNAPEnvironment.platform){case"mobile":return new app.CordovaLocalStorageStore(id,Logger);default:return new app.LocalStorageStore(id)}}}]).factory("ActivityMonitor",["$rootScope","$timeout","SNAPEnvironment",function($rootScope,$timeout,SNAPEnvironment){var monitor=new app.ActivityMonitor($rootScope,$timeout);return monitor.timeout=3e4,SNAPEnvironment.debug&&(monitor.timeout*=9e3),monitor}]).factory("AnalyticsManager",["TelemetryService","AnalyticsModel","Logger",function(TelemetryService,AnalyticsModel,Logger){return new app.AnalyticsManager(TelemetryService,AnalyticsModel,Logger)}]).factory("AuthenticationManager",["DtsApi","SessionModel","SNAPEnvironment","WebBrowser","Logger",function(DtsApi,SessionModel,SNAPEnvironment,WebBrowser,Logger){return new app.AuthenticationManager(DtsApi,SessionModel,SNAPEnvironment,WebBrowser,Logger)}]).factory("CustomerManager",["DtsApi","CustomerModel","SessionModel","Logger","SNAPEnvironment",function(DtsApi,CustomerModel,SessionModel,Logger,SNAPEnvironment){return new app.CustomerManager(DtsApi,CustomerModel,SessionModel,Logger,SNAPEnvironment)}]).factory("ChatManager",["AnalyticsModel","ChatModel","CustomerModel","LocationModel","SocketClient","Logger",function(AnalyticsModel,ChatModel,CustomerModel,LocationModel,SocketClient,Logger){return new app.ChatManager(AnalyticsModel,ChatModel,CustomerModel,LocationModel,SocketClient,Logger)}]).factory("DataManager",["DataModel","Logger","SNAPEnvironment",function(DataModel,Logger,SNAPEnvironment){return new app.DataManager(DataModel,Logger,SNAPEnvironment)}]).factory("DialogManager",["Logger",function(Logger){return new app.DialogManager(Logger)}]).factory("LocationManager",["DataModel","DtsApi","LocationModel","Logger",function(DataModel,DtsApi,LocationModel,Logger){return new app.LocationManager(DataModel,DtsApi,LocationModel,Logger)}]).factory("NavigationManager",["$rootScope","$location","$window","AnalyticsModel","Logger",function($rootScope,$location,$window,AnalyticsModel,Logger){return new app.NavigationManager($rootScope,$location,$window,AnalyticsModel,Logger)}]).factory("OrderManager",["ChatModel","CustomerModel","DtsApi","OrderModel","Logger",function(ChatModel,CustomerModel,DtsApi,OrderModel,Logger){return new app.OrderManager(ChatModel,CustomerModel,DtsApi,OrderModel,Logger)}]).factory("SessionManager",["SNAPEnvironment","AnalyticsModel","CustomerModel","LocationModel","OrderModel","SurveyModel","StorageProvider","Logger",function(SNAPEnvironment,AnalyticsModel,CustomerModel,LocationModel,OrderModel,SurveyModel,StorageProvider,Logger){return new app.SessionManager(SNAPEnvironment,AnalyticsModel,CustomerModel,LocationModel,OrderModel,SurveyModel,StorageProvider,Logger)}]).factory("ShellManager",["DataModel","LocationModel","ShellModel","SNAPLocation","SNAPEnvironment","SNAPHosts","Logger",function(DataModel,LocationModel,ShellModel,SNAPLocation,SNAPEnvironment,SNAPHosts,Logger){var manager=new app.ShellManager(DataModel,LocationModel,ShellModel,SNAPLocation,SNAPEnvironment,SNAPHosts,Logger);return DataModel._getMediaUrl=function(media,width,height,extension){return manager.getMediaUrl(media,width,height,extension)},manager}]).factory("SocialManager",["SNAPEnvironment","DtsApi","WebBrowser","Logger",function(SNAPEnvironment,DtsApi,WebBrowser,Logger){return new app.SocialManager(SNAPEnvironment,DtsApi,WebBrowser,Logger)}]).factory("SoftwareManager",["SNAPEnvironment",function(SNAPEnvironment){return new app.SoftwareManager(SNAPEnvironment)}]).factory("SurveyManager",["DataModel","SurveyModel","Logger",function(DataModel,SurveyModel,Logger){return new app.SurveyManager(DataModel,SurveyModel,Logger)}]);
//# sourceMappingURL=snap.min.js.map